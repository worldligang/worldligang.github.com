
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
      <meta name="baidu-site-verification" content="X93tJz3pCq" />
  <title>刚刚在线</title>
  <meta name="author" content="李刚">
  <meta name="uyan_auth" content="d1112891bb" />
  <meta name="baidu-tc-verification" content="7acda2305fabbf1ddd9f83e385ddd899" />
      
  
  <meta name="description" content="2年iOS开发站长，优秀iOS开发博客之一。关注iOS开发、swift开发、iOSDevTip、移动互联网、自媒体、Cocoapods、Xcode、iOS，刚刚在线博客是一个值得收藏的网站！">
  <meta name="keywords" content="iOS,iOS开发,cocoapods,code,iOS代码, 源代码, 刚刚在线,iOS李刚, pointInside, 刚刚, hitTest, Objective-c,李刚博客">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.superqq.com/posts/12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="刚刚在线" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://cdn.staticfile.org/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->


  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">刚刚在线</a></h1>
  
    <h2>分享iOS开发技术经验的自媒体网站</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://zhannei.superqq.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.superqq.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">全部文章</a></li>
  <li><a href="/blog/categories/ioskai-fa/">iOS开发</a></li>
  <li><a href="/blog/categories/swiftkai-fa">swift开发</a></li>
  <li><a href="/blog/categories/cheng-xu-yuan/">程序员</a></li>
  <li><a href="/blog/categories/yuan-dai-ma/">源代码</a></li>
  <li><a href="/blog/categories/sdkfu-wu/">sdk服务</a></li>
  <li><a href="/blog/categories/tui-jian/">推荐</a></li>
  <li><a href="/about">赞助作者</a></li>
  <li><a href="http://www.90159.com/" target="_blank" title=头条>头条</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/10/ios-she-ji-mo-shi-xi-lie-:kai-pian/">iOS 设计模式系列：开篇</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-10T15:10:13+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:10 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>原文地址：<a href="http://www.raywenderlich.com/46988/ios-design-patterns">iOS Design Patterns</a></p>

<p>原文作者：Eli Ganem</p>

<blockquote><p>有些专业词汇很难翻译准确，就不翻译了。如果英文阅读没有障碍，还是鼓励大家都读原作。</p></blockquote>

<p>iOS 设计模式 – 你大概经常听过这样的术语，但是你知道它的真正意思吗？虽然大部分开发者都同意设计模式很重要，但是关于这方面的文章却很少，开发者在写代码的时候，有时候并不会去花很多时间去考虑设计模式。</p>

<p>设计模式的功能是在软件设计当中是解决一些重复的公共问题。他们是一些模板来帮助你更容易的书写代码和复用你的代码。他们还可能帮助你创建低耦合的代码，你可以很轻松的修改和替换其中的组件。</p>

<p>如果你已经很熟习设计模式了，我这里有一些好的建议。首先，你已经使用了大量由 Cocoa 创建 iOS 设计模式，同时最好的练习就是去使用她们。第二，这个教程将带给你全面了解所有最新的 iOS 设计模式，她们一般都是由 Cocoa 编写的。</p>

<p>这个教程被分成几个小节。在每一个小节里， 你都能在下面读到说明：</p>

<ul>
<li>什么是设计模式</li>
<li>为什么你应该用她</li>
<li>怎么用，在哪里用，在使用当中如何注意一些常见的陷阱</li>
</ul>


<p>在这个教程中，你将要创建一个音乐库的 APP，它能够显示你的音乐专辑和一些相关信息。</p>

<p>在开发这个 APP 的过程当中，你将会了解到很多常见的 Cocoa 设计模式。</p>

<ul>
<li>创建 (Creational)：单例 (Singleton)和抽象工厂 (Abstract Factory)</li>
<li>结构 (Structural)：MVC，装饰器 (Decorator)，适配器 （Adapter)，外观 (Facade)和复合器 (Composite)</li>
<li>行为 (Behavioral)：观察者 (Observer)，备忘录 (Memento)，责任链 (Chain of Responsibility)和命令 (Command)</li>
</ul>


<p>不要被带偏了，这只是一篇理论文章；你将会在你的音乐 APP 中使用很多的设计模式。在这个教程的最后，你的 APP 看来应该是像这个样子的：</p>

<p><img src="http://cdn1.raywenderlich.com/wp-content/uploads/2013/07/finalapp-180x320.png" alt="icon" /></p>

<h3>入门指南</h3>

<p>下载 <a href="http://cdn2.raywenderlich.com/wp-content/uploads/2013/07/BlueLibrary-Starter.zip" target="_blank" title="启动项目">启动项目</a>，从 ZIP 文件中提取文件，用 Xcode 打开 BlueLibrary.xcodeproj。</p>

<p>这没有多少文件，仅仅只有一个默认的 ViewController 文件和一个空的可执行的简单 HTTP 客户端。</p>

<pre><code>提示：你知道吗，当你创建一个新的 Xcode 项目的时候，你的代码已经使用被设计模式？MVC，代理，协议，单例模式 ─ 这些你都能免费得到！:]
</code></pre>

<p>在你开始研究第一个设计模式时，你必须创建两个类用于存储和显示专集数据。</p>

<p>从”File\New\File…”（或者使用快捷键 Command + N）。选择 iOS > Cocoa Touch，然后选择 Objective-C class 后点击 Next。设置类的名称为 Album，子类为 NSObject。点击 Next 创建。</p>

<p>打开 Album.h 文件，在 @interface 和 @end 这间添加下面的属性和方法原型：</p>

<pre><code>@propery (nonatomic, copy, readonly) NSString *title, *artist, * genre, *coverUrl, *year;
- (id)initWithTitle:(NSString *)title artist:(NSString *)artist coverUrl:(NSString *)coverUrl year:(NSString *)year;
</code></pre>

<p>注意这里的所有属性都是 readonly，Album 对象被创建后是不能够被修改的。</p>

<p>这个方法是用来初始化对象的。当你创建一个新专辑时，需要提供专辑名称，作者，封面 URL 和年份。</p>

<p>现在打开 Album.m 文件然后在 @implementation 和 @end 之间加入如下代码：</p>

<pre><code>- (id)initWithTitle:(NSString*)title artist:(NSString*)artist coverUrl:(NSString*)coverUrl
{
    self = [super init];
    _title = title;
    _artist = artist;
    _coverUrl = coverUrl;
    _year = year;
    _genre = @"Pop";
    return self;
}
</code></pre>

<p>这里没有什么复杂的，只是一个简单的创建 Album 实例的初始化方法。</p>

<p>现次从菜单 File\New\File 选择中 Cocoa Touch，然后选择 Object-C class，点击 Next。设置类的名称为 AlbumView，子类为 UIView。点击 Next 创建文件。</p>

<pre><code>提示：如果你会使用快捷键，创建这些会更容易，Command+N 创建新文件，Command+Option+N 创建新的文件夹，Command+B 创建新项目，Command+R 运行项目。
</code></pre>

<p>打开 AlbumView.h，在 @interface 和 @end 中 添加一个方法原型</p>

<pre><code>- (id)initWithFrame:(CGRect)fram albumCover:(NSString*)albumCover;
</code></pre>

<p>现在打开 AlbumView.m 文件，用下面代码替换 @implementaton 后面的所有代码：</p>

<pre><code>@implementation AlbumView
{
    UIImageView *coverImage;
    UIActivityIndicatorView *indicator;
}

- (id)initWithFrame:(CGRect)frame albumCover:(NSString*)albumCover
{
    self = [super initWithFrame:frame];
    if (self) {
        self.backgroundColor = [UIColor blackColor];
        // the coverImage has a 5 pixels margin from its frame
        coverImage = [[UIImageView alloc] initWithFrame:CGRectMake(5, 5, frame.size.width-10, frame.size.height-10)];
        [self addSubview:coverImage];

        indicator = [[UIActivityIndicatorView alloc] init];
        indicator.center = self.center;
        indicator.activityIndicatorViewStyle = UIActivityIndicatorViewStyleWhiteLarge;
        [indicator startAnimating];
        [self addSubview:indicator];
        }
    return self;
}

@end
</code></pre>

<p>第一个需要注意的地方是 coverImage 是一个实例变量。这个变量代表专集的封面图片。第二个变量是一个提示器，在封面图片开始下载的时候提示用户正在下载。</p>

<p>在初始化的过程中你需要设置背景为黑色，创建一个比封面图片大 5px 的图片视图，再创建和添加一个活动指示器。</p>

<pre><code>提示：为什么私有变量定义在执行文件而不是定义在接口文件？这是因为其它外部类不需要知道 AlbumView 类里的这些变量，这些变量只会在这个类的内部方法中使用到。如果你要开发一些库或者框架给别的开发者使用，遵守这个习俗是非常重要的。
</code></pre>

<p>Build 你的项目确保所有代码都能构运行。没有问题？你的第一个设计模式已经准备好了。</p>

<p><strong>设计模式系列文章</strong>：</p>

<p><a href="http://www.superqq.com/blog/2015/06/10/ios-she-ji-mo-shi-xi-lie-:kai-pian/">iOS 设计模式系列：开篇</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/11/ios-she-ji-mo-shi-xi-lie-:mvc-she-ji-mo-shi-zhong-de-guo-wang/">iOS 设计模式系列：MVC – 设计模式中的国王</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/13/ios-she-ji-mo-shi-xi-lie-:singleton-dan-li-mo-shi/">iOS 设计模式系列：Singleton – 单例模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/15/ios-she-ji-mo-shi-xi-lie-:facade-wai-guan-mo-shi/">iOS 设计模式系列：Facade – 外观模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/16/ios-she-ji-mo-shi-xi-lie-:decorator-zhuang-shi-qi-mo-shi/">iOS 设计模式系列：Decorator – 装饰器模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/17/ios-she-ji-mo-shi-xi-lie-:adapter-gua-pei-qi-mo-shi/">iOS 设计模式系列：Adapter – 适配器模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/18/ios-she-ji-mo-shi-xi-lie-:observer-guan-cha-zhe-mo-shi/">iOS 设计模式系列：Observer – 观察者模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/19/ios-she-ji-mo-shi-xi-lie-:memento-bei-wang-lu-mo-shi/">iOS 设计模式系列：Memento – 备忘录模式</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/20/ios-she-ji-mo-shi-xi-lie-:archiving-gui-dang-mo-shi/">iOS 设计模式系列：Archiving – 归档模式</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/09/sdwebimagejia-zai-tu-pian-huan-cun-tu-pian/">SDWebImage加载图片缓存图片</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-09T17:47:31+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:47 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>关注公众号iOS开发：<strong>iOSDevTip</strong> 获取更多源代码。</li>
</ul>


<p> <a href="https://github.com/rs/SDWebImage.git"target="_blank"title="源代码">源代码</a></p>

<h1> Web Image</h1>

<p><a href="https://travis-ci.org/rs/SDWebImage"><img src="http://img.shields.io/travis/rs/SDWebImage/master.svg?style=flat" alt="Build Status" /></a>
<a href="http://cocoadocs.org/docsets/SDWebImage/"><img src="http://img.shields.io/cocoapods/v/SDWebImage.svg?style=flat" alt="Pod Version" /></a>
<a href="http://cocoadocs.org/docsets/SDWebImage/"><img src="http://img.shields.io/cocoapods/p/SDWebImage.svg?style=flat" alt="Pod Platform" /></a>
<a href="https://www.apache.org/licenses/LICENSE-2.0.html"><img src="http://img.shields.io/cocoapods/l/SDWebImage.svg?style=flat" alt="Pod License" /></a>
<a href="https://www.versioneye.com/objective-c/sdwebimage/3.3"><img src="https://www.versioneye.com/objective-c/sdwebimage/3.3/badge.svg?style=flat" alt="Dependency Status" /></a>
<a href="https://www.versioneye.com/objective-c/sdwebimage/references"><img src="https://www.versioneye.com/objective-c/sdwebimage/reference_badge.svg?style=flat" alt="Reference Status" /></a>
<a href="https://github.com/rs/SDWebImage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible" /></a></p>

<p>This library provides a category for UIImageView with support for remote images coming from the web.</p>

<p>It provides:</p>

<ul>
<li>An UIImageView category adding web image and cache management to the Cocoa Touch framework</li>
<li>An asynchronous image downloader</li>
<li>An asynchronous memory + disk image caching with automatic cache expiration handling</li>
<li>Animated GIF support</li>
<li>WebP format support</li>
<li>A background image decompression</li>
<li>A guarantee that the same URL won&rsquo;t be downloaded several times</li>
<li>A guarantee that bogus URLs won&rsquo;t be retried again and again</li>
<li>A guarantee that main thread will never be blocked</li>
<li>Performances!</li>
<li>Use GCD and ARC</li>
<li>Arm64 support</li>
</ul>


<p>NOTE: The version 3.0 of SDWebImage isn&rsquo;t fully backward compatible with 2.0 and requires iOS 5.1.1
minimum deployement version. If you need iOS &lt; 5.0 support, please use the last <a href="https://github.com/rs/SDWebImage/tree/2.0-compat">2.0 version</a>.</p>

<p><a href="https://github.com/rs/SDWebImage/wiki/How-is-SDWebImage-better-than-X%3F">How is SDWebImage better than X?</a></p>

<h2>Who Use It</h2>

<p>Find out <a href="https://github.com/rs/SDWebImage/wiki/Who-Uses-SDWebImage">who uses SDWebImage</a> and add your app to the list.</p>

<h2>How To Use</h2>

<p>API documentation is available at <a href="http://cocoadocs.org/docsets/SDWebImage/">CocoaDocs - SDWebImage</a></p>

<h3>Using UIImageView+WebCache category with UITableView</h3>

<p>Just #import the UIImageView+WebCache.h header, and call the sd_setImageWithURL:placeholderImage:
method from the tableView:cellForRowAtIndexPath: UITableViewDataSource method. Everything will be
handled for you, from async downloads to caching management.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &lt;SDWebImage/UIImageView+WebCache.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="bp">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nl">tableView</span><span class="p">:(</span><span class="bp">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="n">tableView</span> <span class="nl">cellForRowAtIndexPath</span><span class="p">:(</span><span class="bp">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="n">indexPath</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="bp">NSString</span> <span class="o">*</span><span class="n">MyIdentifier</span> <span class="o">=</span> <span class="s">@&quot;MyIdentifier&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">UITableViewCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nl">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="n">MyIdentifier</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">cell</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">cell</span> <span class="o">=</span> <span class="p">[[[</span><span class="bp">UITableViewCell</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithStyle</span><span class="p">:</span><span class="n">UITableViewCellStyleDefault</span>
</span><span class='line'>                                       <span class="nl">reuseIdentifier</span><span class="p">:</span><span class="n">MyIdentifier</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Here we use the new provided sd_setImageWithURL: method to load the web image</span>
</span><span class='line'>    <span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">imageView</span> <span class="nl">sd_setImageWithURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://www.domain.com/path/to/image.jpg&quot;</span><span class="p">]</span>
</span><span class='line'>                      <span class="nl">placeholderImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;placeholder.png&quot;</span><span class="p">]];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cell</span><span class="p">.</span><span class="n">textLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">@&quot;My Text&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using blocks</h3>

<p>With blocks, you can be notified about the image download progress and whenever the image retrival
has completed with success or not:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="c1">// Here we use the new provided sd_setImageWithURL: method to load the web image</span>
</span><span class='line'><span class="p">[</span><span class="n">cell</span><span class="p">.</span><span class="n">imageView</span> <span class="nl">sd_setImageWithURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://www.domain.com/path/to/image.jpg&quot;</span><span class="p">]</span>
</span><span class='line'>                      <span class="nl">placeholderImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;placeholder.png&quot;</span><span class="p">]</span>
</span><span class='line'>                             <span class="nl">completed</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">SDImageCacheType</span> <span class="n">cacheType</span><span class="p">,</span> <span class="bp">NSURL</span> <span class="o">*</span><span class="n">imageURL</span><span class="p">)</span> <span class="p">{...</span> <span class="n">completion</span> <span class="n">code</span> <span class="n">here</span> <span class="p">...}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note: neither your success nor failure block will be call if your image request is canceled before completion.</p>

<h3>Using SDWebImageManager</h3>

<p>The SDWebImageManager is the class behind the UIImageView+WebCache category. It ties the
asynchronous downloader with the image cache store. You can use this class directly to benefit
from web image downloading with caching in another context than a UIView (ie: with Cocoa).</p>

<p>Here is a simple example of how to use SDWebImageManager:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">SDWebImageManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">SDWebImageManager</span> <span class="n">sharedManager</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">manager</span> <span class="nl">downloadImageWithURL</span><span class="p">:</span><span class="n">imageURL</span>
</span><span class='line'>                      <span class="nl">options</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>                     <span class="nl">progress</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSInteger</span> <span class="n">receivedSize</span><span class="p">,</span> <span class="bp">NSInteger</span> <span class="n">expectedSize</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                         <span class="c1">// progression tracking code</span>
</span><span class='line'>                     <span class="p">}</span>
</span><span class='line'>                     <span class="nl">completed</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">SDImageCacheType</span> <span class="n">cacheType</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">finished</span><span class="p">,</span> <span class="bp">NSURL</span> <span class="o">*</span><span class="n">imageURL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                         <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                             <span class="c1">// do something with image</span>
</span><span class='line'>                         <span class="p">}</span>
</span><span class='line'>                     <span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using Asynchronous Image Downloader Independently</h3>

<p>It&rsquo;s also possible to use the async image downloader independently:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[</span><span class="n">SDWebImageDownloader</span><span class="p">.</span><span class="n">sharedDownloader</span> <span class="nl">downloadImageWithURL</span><span class="p">:</span><span class="n">imageURL</span>
</span><span class='line'>                                                    <span class="nl">options</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>                                                   <span class="nl">progress</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSInteger</span> <span class="n">receivedSize</span><span class="p">,</span> <span class="bp">NSInteger</span> <span class="n">expectedSize</span><span class="p">)</span>
</span><span class='line'>                                                   <span class="p">{</span>
</span><span class='line'>                                                       <span class="c1">// progression tracking code</span>
</span><span class='line'>                                                   <span class="p">}</span>
</span><span class='line'>                                                   <span class="nl">completed</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)</span>
</span><span class='line'>                                                   <span class="p">{</span>
</span><span class='line'>                                                       <span class="k">if</span> <span class="p">(</span><span class="n">image</span> <span class="o">&amp;&amp;</span> <span class="n">finished</span><span class="p">)</span>
</span><span class='line'>                                                       <span class="p">{</span>
</span><span class='line'>                                                           <span class="c1">// do something with image</span>
</span><span class='line'>                                                       <span class="p">}</span>
</span><span class='line'>                                                   <span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using Asynchronous Image Caching Independently</h3>

<p>It is also possible to use the async based image cache store independently. SDImageCache
maintains a memory cache and an optional disk cache. Disk cache write operations are performed
asynchronous so it doesn&rsquo;t add unnecessary latency to the UI.</p>

<p>The SDImageCache class provides a singleton instance for convenience but you can create your own
instance if you want to create separated cache namespace.</p>

<p>To lookup the cache, you use the <code>queryDiskCacheForKey:done:</code> method. If the method returns nil, it means the cache
doesn&rsquo;t currently own the image. You are thus responsible for generating and caching it. The cache
key is an application unique identifier for the image to cache. It is generally the absolute URL of
the image.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">SDImageCache</span> <span class="o">*</span><span class="n">imageCache</span> <span class="o">=</span> <span class="p">[[</span><span class="n">SDImageCache</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithNamespace</span><span class="p">:</span><span class="s">@&quot;myNamespace&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">imageCache</span> <span class="nl">queryDiskCacheForKey</span><span class="p">:</span><span class="n">myCacheKey</span> <span class="nl">done</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">// image is not nil if image was found</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>By default SDImageCache will lookup the disk cache if an image can&rsquo;t be found in the memory cache.
You can prevent this from happening by calling the alternative method <code>imageFromMemoryCacheForKey:</code>.</p>

<p>To store an image into the cache, you use the storeImage:forKey: method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">SDImageCache</span> <span class="n">sharedImageCache</span><span class="p">]</span> <span class="nl">storeImage</span><span class="p">:</span><span class="n">myImage</span> <span class="nl">forKey</span><span class="p">:</span><span class="n">myCacheKey</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>By default, the image will be stored in memory cache as well as on disk cache (asynchronously). If
you want only the memory cache, use the alternative method storeImage:forKey:toDisk: with a negative
third argument.</p>

<h3>Using cache key filter</h3>

<p>Sometime, you may not want to use the image URL as cache key because part of the URL is dynamic
(i.e.: for access control purpose). SDWebImageManager provides a way to set a cache key filter that
takes the NSURL as input, and output a cache key NSString.</p>

<p>The following example sets a filter in the application delegate that will remove any query-string from
the URL before to use it as a cache key:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">application:</span><span class="p">(</span><span class="bp">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">SDWebImageManager</span><span class="p">.</span><span class="n">sharedManager</span><span class="p">.</span><span class="n">cacheKeyFilter</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">url</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSURL</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithScheme</span><span class="p">:</span><span class="n">url</span><span class="p">.</span><span class="n">scheme</span> <span class="nl">host</span><span class="p">:</span><span class="n">url</span><span class="p">.</span><span class="n">host</span> <span class="nl">path</span><span class="p">:</span><span class="n">url</span><span class="p">.</span><span class="n">path</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">[</span><span class="n">url</span> <span class="n">absoluteString</span><span class="p">];</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Your app init code...</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Common Problems</h2>

<h3>Using dynamic image size with UITableViewCell</h3>

<p>UITableView determines the size of the image by the first image set for a cell. If your remote images
don&rsquo;t have the same size as your placeholder image, you may experience strange anamorphic scaling issue.
The following article gives a way to workaround this issue:</p>

<p><a href="http://www.wrichards.com/blog/2011/11/sdwebimage-fixed-width-cell-images/">http://www.wrichards.com/blog/2011/11/sdwebimage-fixed-width-cell-images/</a></p>

<h3>Handle image refresh</h3>

<p>SDWebImage does very aggressive caching by default. It ignores all kind of caching control header returned by the HTTP server and cache the returned images with no time restriction. It implies your images URLs are static URLs pointing to images that never change. If the pointed image happen to change, some parts of the URL should change accordingly.</p>

<p>If you don&rsquo;t control the image server you&rsquo;re using, you may not be able to change the URL when its content is updated. This is the case for Facebook avatar URLs for instance. In such case, you may use the <code>SDWebImageRefreshCached</code> flag. This will slightly degrade the performance but will respect the HTTP caching control headers:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[</span><span class="n">imageView</span> <span class="nl">sd_setImageWithURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;https://graph.facebook.com/olivier.poitrey/picture&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="nl">placeholderImage</span><span class="p">:[</span><span class="bp">UIImage</span> <span class="nl">imageNamed</span><span class="p">:</span><span class="s">@&quot;avatar-placeholder.png&quot;</span><span class="p">]</span>
</span><span class='line'>                          <span class="nl">options</span><span class="p">:</span><span class="n">SDWebImageRefreshCached</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Add a progress indicator</h3>

<p>See this category: <a href="https://github.com/JJSaccolo/UIActivityIndicator-for-SDWebImage">https://github.com/JJSaccolo/UIActivityIndicator-for-SDWebImage</a></p>

<h2>Installation</h2>

<p>There are three ways to use SDWebImage in your project:
- using Cocoapods
- copying all the files into your project
- importing the project as a static library</p>

<h3>Installation with CocoaPods</h3>

<p><a href="http://cocoapods.org/">CocoaPods</a> is a dependency manager for Objective-C, which automates and simplifies the process of using 3rd-party libraries in your projects. See the <a href="http://cocoapods.org/#get_started">Get Started</a> section for more details.</p>

<h4>Podfile</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="nl">platform</span> <span class="p">:</span><span class="n">ios</span><span class="p">,</span> <span class="err">&#39;</span><span class="mf">6.1</span><span class="err">&#39;</span>
</span><span class='line'><span class="n">pod</span> <span class="err">&#39;</span><span class="n">SDWebImage</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">~&gt;</span><span class="mf">3.7</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installation with Carthage (iOS 8+)</h3>

<p><a href="https://github.com/Carthage/Carthage">Carthage</a> is a lightweight dependency manager for Swift and Objective-C. It leverages CocoaTouch modules and ins less invasive than CocoaPods.</p>

<p>To install with carthage, follow the instruction on <a href="https://github.com/Carthage/Carthage">Carthage</a></p>

<h4>Cartfile</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">github</span> <span class="s">&quot;rs/SDWebImage&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Usage</h4>

<p>Swift</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">import</span> <span class="n">WebImage</span>
</span></code></pre></td></tr></table></div></figure>


<p>Objective-C</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">@</span><span class="n">import</span> <span class="n">WebImage</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installation by cloning the repository</h3>

<p>In order to gain access to all the files from the repository, you should clone it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/rs/SDWebImage.git</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Add the SDWebImage project to your project</h3>

<ul>
<li>Download and unzip the last version of the framework from the <a href="https://github.com/rs/SDWebImage/releases">download page</a></li>
<li>Right-click on the project navigator and select &ldquo;Add Files to &#8220;Your Project&rdquo;:</li>
<li>In the dialog, select SDWebImage.framework:</li>
<li>Check the &ldquo;Copy items into destination group&rsquo;s folder (if needed)&rdquo; checkbox</li>
</ul>


<h3>Add dependencies</h3>

<ul>
<li>In you application project app’s target settings, find the &ldquo;Build Phases&rdquo; section and open the &ldquo;Link Binary With Libraries&rdquo; block:</li>
<li>Click the &ldquo;+&rdquo; button again and select the &ldquo;ImageIO.framework&rdquo;, this is needed by the progressive download feature:</li>
</ul>


<h3>Add Linker Flag</h3>

<p>Open the &ldquo;Build Settings&rdquo; tab, in the &ldquo;Linking&rdquo; section, locate the &ldquo;Other Linker Flags&rdquo; setting and add the &ldquo;-ObjC&rdquo; flag:</p>

<p><img src="http://dl.dropbox.com/u/123346/SDWebImage/10_other_linker_flags.jpg" alt="Other Linker Flags" /></p>

<p>Alternatively, if this causes compilation problems with frameworks that extend optional libraries, such as Parse,  RestKit or opencv2, instead of the -ObjC flag use:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">-</span><span class="nf">force_load</span> <span class="n">SDWebImage</span><span class="p">.</span><span class="n">framework</span><span class="o">/</span><span class="n">Versions</span><span class="o">/</span><span class="n">Current</span><span class="o">/</span><span class="n">SDWebImage</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re using Cocoa Pods and have any frameworks that extend optional libraries, such as Parsen RestKit or opencv2, instead of the -ObjC flag use:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">-</span><span class="nf">force_load</span> <span class="err">$</span><span class="p">(</span><span class="n">TARGET_BUILD_DIR</span><span class="p">)</span><span class="o">/</span><span class="n">libPods</span><span class="p">.</span><span class="n">a</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Import headers in your source files</h3>

<p>In the source files where you need to use the library, import the header file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="cp">#import &lt;SDWebImage/UIImageView+WebCache.h&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Build Project</h3>

<p>At this point your workspace should build without error. If you are having problem, post to the Issue and the
community can help you solve it.</p>

<h2>Future Enhancements</h2>

<ul>
<li>LRU memory cache cleanup instead of reset on memory warning</li>
</ul>


<h2>Licenses</h2>

<p>All source code is licensed under the <a href="https://raw.github.com/rs/SDWebImage/master/LICENSE">MIT License</a>.</p>

<p><strong>更多源代码：</strong></p>

<p><a href="http://www.superqq.com/blog/2015/01/15/objective-cxiang-guan-categoryde-shou-ji/">Objective-C相关Category的收集</a></p>

<p><a href="http://www.superqq.com/blog/2015/01/07/paperfold-for-ios/">PaperFold-for-iOS</a></p>

<p><a href="http://www.superqq.com/blog/2015/01/07/dkcirclebutton/">DKCircleButton</a></p>

<p><a href="http://www.superqq.com/blog/2015/01/07/twittercover/">TwitterCover</a></p>

<p><a href="http://www.superqq.com/blog/2015/01/07/hackernews/">HackerNews</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/06/ios-kvcxiang-xi-jiang-jie/">iOS KVC详细讲解</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-06T09:20:27+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>9:20 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>欢迎大家提供面试题目，我们一起来讲解，以备不时之需。</p></blockquote>

<h2>什么是KVC？</h2>

<p>KVC即<strong>NSKeyValueCoding</strong>，就是键-值编码的意思。一个非正式的 Protocol，是一种间接访问对象的属性使用字符串来标识属性，而不是通过调用存取方法，直接或通过实例变量访问的机制。</p>

<p>以上就是KVC的理论，面试时，如实回答就可以啦！</p>

<h2>使用KVC说明</h2>

<ul>
<li>KVC间接修改对象属性时，会自动判断对象属性的类型，完成相应的转换。</li>
<li>KVC按键值路径取值时，如果对象不包含指定的键值，那么就会自动进入对象内部，查找对象属性。</li>
<li>KVC可以嵌套按照键值路径取值。</li>
</ul>


<h2>KVC和KVO有什么区别？</h2>

<p>上一篇文章我们讲了<a href="http://www.superqq.com/blog/2015/06/05/ios-kvogai-shu-yu-shi-jian/">iOS KVO概述</a>，有兴趣的可以看看。面试过程中，面试官问：KVC和KVO有什么区别？</p>

<p>听到这个问题真的很（dan）疼，真特么想回一句，我怎么知道什么区别？当然，如果你像这么回答，面试估计到此结束啦。</p>

<p>那KVC和KVO到底有什么区别呢？</p>

<p>KVO是建立在KVC之上的，KVO能够观察一个对象的KVC key-path值的变化。</p>

<p>iOS面试汇总：</p>

<p><a href="http://www.superqq.com/blog/2015/06/04/mian-shi-guan-wen-xian-zai-gong-zi-shi-duo-shao-gai-zen-yao-hui-da/">面试官问现在工资是多少该怎么回答?</a></p>

<p><a href="http://www.superqq.com/blog/2015/06/05/ios-kvogai-shu-yu-shi-jian/">iOS KVO概述</a></p>

<ul>
<li>关注公众号iOS开发：<strong>iOSDevTip</strong> 获取更多面试技巧。</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/05/ios-kvogai-shu-yu-shi-jian/">iOS KVO概述</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-05T11:06:59+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:06 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>面试中经常会被问到：什么是KVO？这个问题既然出现概率这么大，那么我们就来详细讲一讲到底什么是KVO。下次再有面试官问你的时候，你就可以娓娓道来，以彰显高逼格</p></blockquote>

<h2>概述</h2>

<p>问：什么是KVO？</p>

<p>答：KVO是Key-Value Observing的缩写。它提供一种机制，当指定的对象的属性被修改后，则对象就会接受到通知。简单的说就是每次指定的被观察的对象的属性被修改后，KVO就会自动通知相应的观察者了。</p>

<p>如果你能这样回答，面试官一定不会说你错的，这就是KVO的原理。但是如果你能说出KVO的好处，那一定能赢得面试官的刮目相看。比如：</p>

<ul>
<li>使用KVO最直接的好处就是可以减少代码量。</li>
<li>KVO是<strong>观察者</strong>设计模式中的一种，有利于业务逻辑于视图控制之间的解耦。</li>
</ul>


<p>更深刻的了解KVO，你可以动手写一个小demo思路如下：</p>

<ul>
<li>定义一个对象People，分别有name和age属性</li>
<li>监听People的age属性</li>
<li>定义一个UIButton，在button的点击方法里面，去改变People的age。</li>
<li>你就可以收到age改变时发出来的通知</li>
<li>在对象销毁的时候，移除通知。</li>
</ul>


<p>iOS面试汇总：</p>

<p><a href="http://www.superqq.com/blog/2015/06/04/mian-shi-guan-wen-xian-zai-gong-zi-shi-duo-shao-gai-zen-yao-hui-da/">面试官问现在工资是多少该怎么回答?</a></p>

<ul>
<li>关注公众号iOS开发：<strong>iOSDevTip</strong> 获取更多面试技巧。</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/06/04/mian-shi-guan-wen-xian-zai-gong-zi-shi-duo-shao-gai-zen-yao-hui-da/">面试官问现在工资是多少该怎么回答?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-06-04T10:36:30+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:36 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>经常面试别人，也被别人面试的人来答。</p>

<p>面试官有此问，一是打听市场价，二是盘算以怎样的代价可以挖动你;猎头有此问，也许会帮你，也许会坑你。你回答的目的，是帮自己争取到最有利的薪资和福利。</p>

<p>　　</p>

<p>非常关键的一点，大家应该留意：问你的人具体是谁?</p>

<p>　　初面面试官(HR 部门的人，可能是招聘主管或经理人力资源总监、HRBP*)：他们在最初的用意往往是想打听市场行情，在用人部门确定后，往往是想能省点就省一点，到底也算自己的业绩呢;</p>

<p>　　</p>

<p>终面面试官(用人部门主管或经理、总监，直至公司老总、副总等)：他们比 HR 单纯一些，只要在部门预算之内，还能用得起，就愿意挑最好的人用;</p>

<p>　　</p>

<p>猎头顾问：虽然她们不是面试官，但可帮你可坑你，情况复杂，我放在后面讲。</p>

<p>　　</p>

<p>*HRBP 在大型外企很厉害哦，如果面试遇到，敬请留心。</p>

<p>　　</p>

<h3>下面根据不同的场合，我提一些建议：</h3>

<p>　　</p>

<p>如果你是通过直接应聘走到面试环节</p>

<p>　　</p>

<p>有的雇主会进行薪资验证(税单、劳动合同、原公司盖章的薪资证明)，有的不会。即使你已知不会，我建议你也不要虚报，说谎会有麻烦;应对大体上可分两种：</p>

<p>　　</p>

<p>实话实说：可展开各项福利和软硬环境、前景等等，不是光是薪资。这种回答很稳妥，如果对方要你，不出意外的话，开给你的薪水会按市价适当加成(我的了解，大致范围在 15%~35%)。</p>

<p>　　</p>

<p>拒不回答：我说过，你和面试官在合同签订之前是完全平等的所以，问是他的权利，拒绝或回答也是你的权利。需要提醒的是，你可以强势，但不能生硬，而且应以其他的有效反馈或者引导来替代。我举三个例子：</p>

<p>　　</p>

<p>1、我以自己为例，曾经有一场和总经理的面试，结尾是这样的：</p>

<p>　　&ndash; 你现在的薪水是多少?</p>

<p>　　&ndash; 很低，不好意思说。因为之前公司给我出学费念了书，签了两年 service contract，前后被拴了四年，工资被压低了。</p>

<p>　　&ndash; 那你为什么觉得我该付给你很多薪水?</p>

<p>　　&ndash; 因为工作性质改变了，也因为我改变了。</p>

<p>　　&ndash; 那你有什么要求吗?</p>

<p>　　&ndash; 我只请您考虑一件事：北京租房真是不便宜，所以我搬家过来需要一定决心。</p>

<p>　　</p>

<p>结果，一周后，我看到 offer 上的数字，是我当时在上海工作的 4 倍。</p>

<p>　　</p>

<p>2、以我朋友为例，他前几年在职时也曾经四处面试，他也经常被问这个问题，大多是电话面试时 HR 来问，“因为他们看得很死，最多就只肯给你涨 30%，要看之前的薪水。”而他本人在原公司的薪酬是最低的一档(同等学历，同等经验，同等职位的比较结果)，如果就死死地盯着这不公平的基数，加 30%实在嫌少。我教他一个办法，你直接告诉她你的期望薪水，因为你认为你给她公司创造的价值高过这个 20 倍(不要说约数，说数字，而且你要确实分析过，有信心对此数字负责)，如果她认为不值得，请她不要聘用你。</p>

<p>　　</p>

<p>他当时觉得很有用。当然，后来的四五次面试中他用了没有我不得而知，但他现在的公司在入职时给了他 50%的涨幅。</p>

<p>　　</p>

<p>补充:看到有人说&#8221;排名第一的说涨幅超过 50%，这个一般来说肯定不是高端岗位，从 3000-6000，涨幅 100%呢，也不难吧。&#8221;于是想简单介绍我这个朋友的情况，那时候他是某 500 强的中国区总部的财务部经理(部门总监最得力的下属)，留英硕士，DBA 在读(也是公司出的学费)，最后进入的是竞争对手的亚太区总部的战略部(偏财务方向)，两年后升任该部门总经理(没办法，他们就这么叫)。可能您做的客户比较高端，这些都不算啥了。下次请多提供点具体信息，我们可以取长补短，请务必@我哦。</p>

<p>　　</p>

<p>这种拒绝正面回答的对策，适用于你目前薪酬低于平均薪酬的水平时。因为面试官无法判断到底多少，只能取行业平均值来推测，然后结合你的面试表现来决定，相对来说，结果对你最为公平。</p>

<p>　　</p>

<p>当然，采取这种策略本身就需要一定的底气，如果你给面试官的印象是在畏畏缩缩地回避，那基本就是前功尽弃，你还不如老老实实招了吧。</p>

<p>　　</p>

<h3>如果你是通过猎头公司走到面试环节</h3>

<p>　　</p>

<h3>目前分三种情况：</h3>

<p>　　</p>

<p>对于此空缺职位，猎头公司只要给你提供候选人，雇主进行面试了，即便不满意也要付钱。这种猎头公司，在欧洲和北美能见到，而且仅仅在招聘 C-Suites(CEO,COO,CFO)，MD 这个级别的高管时才会出马，只要您是合适的人才，后面包满意哦，亲;唉，你我是这辈子遇不上喽。</p>

<p>　　</p>

<p>对于此空缺职位，猎头公司拿的是浮动报酬(比如，候选人三个月的薪水)，那她是希望帮你的，因为只要还在客户的预算内，每多帮你争取 1 块钱的月薪，猎头公司就多赚 3 块钱，而猎头顾问本人就多一份提成(比例不详，但一般都是拿提成的)。目前，对于多数中小客户，猎头都是以这样的形式取得报酬。这种时候，你可以尽量试探客户的预算，包括其他候选人的情况(对于面试废了的候选人，她们会很合作地榨取一切情报以利于下一位可能成功的候选人)。</p>

<p>　　</p>

<p>对于此空缺职位，猎头公司拿的是固定报酬(无论招到的人多少薪水，猎头公司报酬不变)，那她会倾向于压低你的薪水，因为每压低 1 块钱，她为客户节约的价值就体现出来了，而能和猎头顾问谈这样合同的公司，基本都是 500 强中的强势公司，很可能和该猎头公司有长期合作，甚至全球合同。这时候你就有点无奈了，她们一般不会有耐心听你的陈述和理由，反而会以自己公司成功入职的平均涨幅来打压你，并且和雇主企业沆瀣一气来对付候选人。</p>

<p>　　</p>

<p>不幸的是，近三四年，随着经济的低迷，招聘活动的减少(喂，别老怨别人，你不是也不敢轻易跳槽了吗)，第三种情况正越来越多;而猎头公司为了生存，正被迫接受这种方式;再不客气地讲，猎头公司的人员素质近几年也在下滑，Michael Page, Robert Walters 等从早先的非欧美名校、对口专业(细分至对应各行业)不招，到国外留学即可，到现在的国内 985 即可，顾问们根本无法承担深度挖掘候选人潜力、提升自己业绩和谈判能力等重担，公司也只能顺水推舟了。</p>

<p>　　</p>

<p>通常，猎头公司在第一次给你电话时，就会问你这个问题。(这也好理解：万一她的客户提供的薪酬还不如你现在的高，那她后面不是白费工夫吗?)问完之后，有一半的可能性会马上告诉雇主。</p>

<p>　　</p>

<p>那我怎么办呢，能在猎头公司那里虚报吗?我依然不建议你这样做，说谎话总有麻烦的。</p>

<p>　　</p>

<p>但是，我可以按自己的经验来告诉你风险等级是怎样的。如果面对 Michael Page，Robert Walters 这样程度的猎头，你万一穿帮，后面麻烦不小(虽然他们在中国也不如原先高大上了，但是人家还是有一样东西叫做全球共享数据库&hellip;&hellip;);Randstad 反正也乱得很，没空管你;本土中小猎头你看着办，反正一锤子买卖。自己的经历有限，不一定准确，欢迎各位知友批评补充。</p>

<p>　　</p>

<p>你唯一能做的，就是利用猎头在雇主面前的专业性(其实我看她们多数真不太懂什么业务，对行业知识往往一知半解，但是很无奈，人家比你懂得如何打动雇主)，在猎头面前强调自己相对其他候选人的优势和价值，让她们写入推荐报告中了。</p>

<p>　　</p>

<h3>&ndash; 下面是我的吐槽时间 &ndash;</h3>

<p>　　</p>

<p>顺便说一句，有人认为进行薪资验证的公司往往“招聘制度成熟”。这种想法不能说错，毕竟可以保障公司不吃大亏，不少外企都是这么做的。但我认为，这是人力资源部无能而推诿责任的表现，是大公司病的一种典型表现：</p>

<p>　　</p>

<p>你作为 HR，简历看过了、人也见过了，却无法作出独立判断他值多少钱;</p>

<p>　　</p>

<p>你不了解该职位的市场价，所以一定要依据前公司的薪水来定现在的薪水;</p>

<p>　　</p>

<p>你不想负责任，所以用人部门要的话，你就相应地加成来挖人，潜台词是“谁让你看中他了呢，我这就按你的意思办;这样还挖不成，那肯定是预算不够”;</p>

<p>　　</p>

<p>判断失误可能打击你在公司的专业形象;不谙市场价格可能是种失职;HR 加薪挖人有如 Sales 降价促销般容易——那公司要你来做什么?</p>

<p>来源：知乎 作者：显微无间</p>

<ul>
<li>关注公众号iOS开发：<strong>iOSDevTip</strong> 获取更多面试技巧。</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/29/macxia-dot-gitconfigpei-zhi-bie-ming-alias/">mac下.gitconfig配置别名alias</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-29T13:01:00+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:01 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>在多人协作开发时，一般用git来进行代码管理。git有一些命令如：git pull 、 git push等等，这些命令可以设置alias，也就是缩写。如：git pull 是 git pl， git push 是 git ps。可以根据个人习惯进行修改。</p>

<p>修改别名alias步骤如下：</p>

<h4>1,进入根目录</h4>

<pre><code>$ cd
</code></pre>

<h4>2,查看根目录下面的文件</h4>

<pre><code>$ ls -la
</code></pre>

<p>查看一下有没有.gitconfig文件。</p>

<h4>3，编辑.gitconfig</h4>

<pre><code>$ vi .gitconfig
</code></pre>

<p>添加如下：</p>

<pre><code>[alias]
co = checkout
ci = commit
st = status
pl = pull
ps = push
dt = difftool
l = log --stat
cp = cherry-pick
ca = commit -a
b = branch
</code></pre>

<p>具体可以根据个人习惯进行添加修改。</p>

<blockquote><p>关注公众号iOS开发：iOSDevTip</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/22/iosxie-yi-li-mian-ke-yi-ding-yi-cheng-yuan-bian-liang-he-shu-xing-ma-%3F/">iOS协议里面可以定义成员变量和属性吗？</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-22T11:08:18+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>11:08 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>关注iOS开发：iOSDevTip</p></blockquote>

<p>在CSDN上看到有人提的问题，觉得很有价值，先看代码：</p>

<pre><code>@protocol CAMediaTiming

/* The begin time of the object, in relation to its parent object, if
 * applicable. Defaults to 0. */

@property CFTimeInterval beginTime;

/* The basic duration of the object. Defaults to 0. */

@property CFTimeInterval duration;

/* The rate of the layer. Used to scale parent time to local time, e.g.
 * if rate is 2, local time progresses twice as fast as parent time.
 * Defaults to 1. */

@property float speed;

/* Additional offset in active local time. i.e. to convert from parent
 * time tp to active local time t: t = (tp - begin) * speed + offset.
 * One use of this is to "pause" a layer by setting `speed' to zero and
 * `offset' to a suitable value. Defaults to 0. */

@property CFTimeInterval timeOffset;

/* The repeat count of the object. May be fractional. Defaults to 0. */

@property float repeatCount;

/* The repeat duration of the object. Defaults to 0. */

@property CFTimeInterval repeatDuration;

/* When true, the object plays backwards after playing forwards. Defaults
 * to NO. */

@property BOOL autoreverses;

/* Defines how the timed object behaves outside its active duration.
 * Local time may be clamped to either end of the active duration, or
 * the element may be removed from the presentation. The legal values
 * are `backwards', `forwards', `both' and `removed'. Defaults to
 * `removed'. */

@property(copy) NSString *fillMode;

@end
</code></pre>

<h3>问题：</h3>

<p>上面那个协议时苹果自带的，为什么里面定义了成员变量呢？</p>

<h3>网友回答：</h3>

<p>这只是在头文件中声明，编译器是不会自动生成实例变量的，也就是说你可以用一个对象去实现这个协议，但是你不自己存储的话实例变量的话，访问同样会崩溃：
self.fillModel = @&ldquo;test&rdquo;; // unrecognized selector</p>

<h3>追问</h3>

<p>你好，也就是说我需要这样：</p>

<pre><code>@interface MyClass : NSObject &lt; CAMediaTiming &gt;
@property CFTimeInterval beginTime;
@end
</code></pre>

<p>这样才可以么？
也就是@protocol能声明，不能定义变量么？</p>

<h3>网友回答</h3>

<p>协议声明出来的是方法，虽然看起来是属性，其实只有 getter、setter 这两个方法，内部是没有实例变量的，并且你不能去重定义它，只能在 getter、setter 里处理
​</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/14/iosdi-tu-ding-wei-shi-yong-xiao-ji-qiao/">iOS地图定位使用几个小功能</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-14T10:16:30+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>10:16 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>iOS系统自带的定位服务可以实现很多需求。比如：获取当前经纬度，获取当前位置信息等等。</p>

<h4>获取当前经纬度</h4>

<p>首先导入#import &lt;CoreLocation/CoreLocation.h>，定义CLLocationManager的实例，实现CLLocationManagerDelegate。</p>

<pre><code>@interface ViewController ()&lt;CLLocationManagerDelegate&gt;
{
    CLLocationManager *_locationManager;
}

@end
</code></pre>

<p>开始定位的方法：</p>

<pre><code>- (void)startLocating
{
    if([CLLocationManager locationServicesEnabled])
    {
        _locationManager = [[CLLocationManager alloc] init];
        //设置定位的精度
        [_locationManager setDesiredAccuracy:kCLLocationAccuracyBest];
        _locationManager.distanceFilter = 100.0f;
        _locationManager.delegate = self;
        if ([[[UIDevice currentDevice] systemVersion] floatValue] &gt; 8.0)
        {
            [_locationManager requestAlwaysAuthorization];
            [_locationManager requestWhenInUseAuthorization];
        }
        //开始实时定位
        [_locationManager startUpdatingLocation];
    }
}
</code></pre>

<p>实现代理方法：</p>

<pre><code>-(void)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status
{
    NSLog(@"Longitude = %f", manager.location.coordinate.longitude);
    NSLog(@"Latitude = %f", manager.location.coordinate.latitude);
    [_locationManager stopUpdatingLocation];
}
</code></pre>

<h4>获取当前位置信息</h4>

<p>在上面的代理方法中</p>

<pre><code>-(void)locationManager:(CLLocationManager *)manager didChangeAuthorizationStatus:(CLAuthorizationStatus)status
{
    NSLog(@"Longitude = %f", manager.location.coordinate.longitude);
    NSLog(@"Latitude = %f", manager.location.coordinate.latitude);
    [_locationManager stopUpdatingLocation];

    CLGeocoder * geoCoder = [[CLGeocoder alloc] init];
    [geoCoder reverseGeocodeLocation:manager.location completionHandler:^(NSArray *placemarks, NSError *error) {
        for (CLPlacemark * placemark in placemarks) {
            NSDictionary *test = [placemark addressDictionary];
            //  Country(国家)  State(城市)  SubLocality(区)
            NSLog(@"%@", [test objectForKey:@"Country"]);
            NSLog(@"%@", [test objectForKey:@"State"]);
            NSLog(@"%@", [test objectForKey:@"SubLocality"]);
            NSLog(@"%@", [test objectForKey:@"Street"]);
        }
    }];

}
</code></pre>

<p>这样就很简单获取了当前位置的详细信息。</p>

<h4>获取某一个地点的经纬度</h4>

<pre><code>- (void)getLongitudeAndLatitudeWithCity:(NSString *)city
{
    //city可以为中文
    NSString *oreillyAddress = city;
    CLGeocoder *myGeocoder = [[CLGeocoder alloc] init];
    [myGeocoder geocodeAddressString:oreillyAddress completionHandler:^(NSArray *placemarks, NSError *error) {
        if ([placemarks count] &gt; 0 &amp;&amp; error == nil)
        {
            NSLog(@"Found %lu placemark(s).", (unsigned long)[placemarks count]);
            CLPlacemark *firstPlacemark = [placemarks objectAtIndex:0];
            NSLog(@"Longitude = %f", firstPlacemark.location.coordinate.longitude);
            NSLog(@"Latitude = %f", firstPlacemark.location.coordinate.latitude);
        }
        else if ([placemarks count] == 0 &amp;&amp; error == nil)
        {
            NSLog(@"Found no placemarks.");
        }
        else if (error != nil)
        {
            NSLog(@"An error occurred = %@", error);
        }
    }];
}
</code></pre>

<h4>计算两个地点之间的距离</h4>

<pre><code>- (double)distanceByLongitude:(double)longitude1 latitude:(double)latitude1 longitude:(double)longitude2 latitude:(double)latitude2{
    CLLocation* curLocation = [[CLLocation alloc] initWithLatitude:latitude1 longitude:longitude1];
    CLLocation* otherLocation = [[CLLocation alloc] initWithLatitude:latitude2 longitude:longitude2];
    double distance  = [curLocation distanceFromLocation:otherLocation];//单位是m
    return distance;
}
</code></pre>

<p>首先我们可以用上面的getLongitudeAndLatitudeWithCity方法获取某一个地点的经纬度。比如我们获取北京和上海的经纬度分别为：北京Longitude = 116.405285，Latitude = 39.904989 上海Longitude = 121.472644， Latitude = 31.231706, 那么北京和上海之间的距离就是：</p>

<pre><code>double distance = [self distanceByLongitude:116.405285 latitude:39.904989 longitude:121.472644 latitude:31.231706];
NSLog(@"Latitude = %f", distance);
</code></pre>

<p>计算的是大概的距离，可能没有那么精准。输入结果为：</p>

<pre><code>distance = 1066449.749194
</code></pre>

<p>代码下载地址:<a href="https://github.com/worldligang/MapDistanceMaster.git"target="_blank"title="MapDistanceMaster">MapDistanceMaster</a></p>

<p>更多iOS技术请关注微信iOS开发</p>

<pre><code>iOSDevTip
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/25/iosdiao-yong-xi-tong-fa-duan-xin-gong-neng-xiang-jie/">iOS调用系统发短信功能详解</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-25T11:36:33+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:36 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>iOS调用系统的发短信功能可以分为两种：1，程序外调用系统发短信。2，程序内调用系统发短信。第二种的好处是用户发短信之后还可以回到app。这对app来说非常重要。</p>

<h3>程序外调用系统发短信</h3>

<p>这个方法其实很简单，直接调用openURL即可：</p>

<pre><code>[[UIApplication sharedApplication]openURL:[NSURL URLWithString:@"sms://13888888888"]];
</code></pre>

<h3>程序内调用系统发短信</h3>

<h5>1）导入MessageUI.framework，并引入头文件：</h5>

<pre><code>#import &lt;MessageUI/MessageUI.h&gt;
</code></pre>

<h5>2）实现代理方法MFMessageComposeViewControllerDelegate</h5>

<pre><code>    -(void)messageComposeViewController:(MFMessageComposeViewController *)controller didFinishWithResult:(MessageComposeResult)result
{
    [self dismissViewControllerAnimated:YES completion:nil];
    switch (result) {
        case MessageComposeResultSent:
            //信息传送成功

            break;
        case MessageComposeResultFailed:
            //信息传送失败

            break;
        case MessageComposeResultCancelled:
            //信息被用户取消传送

            break;
        default:
            break;
    }
}
</code></pre>

<h5>3）发送短信</h5>

<pre><code>    -(void)showMessageView:(NSArray *)phones title:(NSString *)title body:(NSString *)body
{
    if( [MFMessageComposeViewController canSendText] )
    {
        MFMessageComposeViewController * controller = [[MFMessageComposeViewController alloc] init];
        controller.recipients = phones;
        controller.navigationBar.tintColor = [UIColor redColor];
        controller.body = body;
        controller.messageComposeDelegate = self;
        [self presentViewController:controller animated:YES completion:nil];
        [[[[controller viewControllers] lastObject] navigationItem] setTitle:title];//修改短信界面标题
    }
    else
    {
        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"提示信息"
                                                        message:@"该设备不支持短信功能"
                                                       delegate:nil
                                              cancelButtonTitle:@"确定"
                                              otherButtonTitles:nil, nil];
        [alert show];
    }
}
</code></pre>

<p>参数phones：发短信的手机号码的数组，数组中是一个即单发,多个即群发。</p>

<h5>4）调用发短信的方法</h5>

<pre><code>    [self showMessageView:[NSArray arrayWithObjects:@"13888888888",@"13999999999", nil] title:@"test" body:@"你是土豪么，么么哒"];
</code></pre>

<p>我的微信iOS开发：iOSDevTip</p>

<p>代码下载地址:<a href="https://github.com/worldligang/SendMsgMaster.git"target="_blank"title="SendMsgMaster">SendMsgMaster</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/23/iosyong-hu-dian-ji-shi-jian-chu-li/">hitTest和pointInside如何响应用户点击事件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-23T16:05:20+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2015</span></span> <span class='time'>4:05 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h3>处理机制</h3>

<p>iOS事件处理，首先应该是找到能处理点击事件的视图，然后在找到的这个视图里处理这个点击事件。</p>

<p>处理原理如下：</p>

<p>• 当用户点击屏幕时，会产生一个触摸事件，系统会将该事件加入到一个由UIApplication管理的事件队列中</p>

<p>• UIApplication会从事件队列中取出最前面的事件进行分发以便处理，通常，先发送事件给应用程序的主窗口(UIWindow)</p>

<p>• 主窗口会调用hitTest:withEvent:方法在视图(UIView)层次结构中找到一个最合适的UIView来处理触摸事件</p>

<p>(hitTest:withEvent:其实是UIView的一个方法，UIWindow继承自UIView，因此主窗口UIWindow也是属于视图的一种)</p>

<p>• hitTest:withEvent:方法大致处理流程是这样的：</p>

<p>首先调用当前视图的pointInside:withEvent:方法判断触摸点是否在当前视图内：</p>

<p>▶ 若pointInside:withEvent:方法返回NO，说明触摸点不在当前视图内，则当前视图的hitTest:withEvent:返回nil</p>

<p>▶ 若pointInside:withEvent:方法返回YES，说明触摸点在当前视图内，则遍历当前视图的所有子视图(subviews)，调用子视图的hitTest:withEvent:方法重复前面的步骤，子视图的遍历顺序是从top到bottom，即从subviews数组的末尾向前遍历，直到有子视图的hitTest:withEvent:方法返回非空对象或者全部子视图遍历完毕：</p>

<p>▷ 若第一次有子视图的hitTest:withEvent:方法返回非空对象,则当前视图的hitTest:withEvent:方法就返回此对象，处理结束</p>

<p>▷ 若所有子视图的hitTest:withEvent:方法都返回nil，则当前视图的hitTest:withEvent:方法返回当前视图自身(self)</p>

<p>• 最终，这个触摸事件交给主窗口的hitTest:withEvent:方法返回的视图对象去处理。我的微信号iOS开发：iOSDevTip</p>

<h3>案列分析</h3>

<p>在UIViewController的self.view上加载一个LGFirstView</p>

<p>LGFirstView上面有一个UIButton我们叫它buttonFirst</p>

<p>然后，self.view上加载一个LGSecondView，刚好盖在LGFirstView上面</p>

<p>LGSecondView上面也有一个UIButton我们叫它buttonSecond</p>

<h5>正常情况下：</h5>

<p>用户点击LGSecondView（点击的点不在buttonSecond上，但是在buttonFirst撒很难过吗），事件处理流程如下：</p>

<p>1）调用UIWindow的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在UIWindow上面。</p>

<p>2）去遍历UIWindow上面的子视图，也就是self.view。同样也是调用self.view的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在self.view上面。</p>

<p>3）去遍历self.view上的子视图，也就是LGFirstView和LGSecondView。（注意：子视图的遍历顺序是从top到bottom，即从subviews数组的末尾向前遍历）。</p>

<p>4）所以先调用LGSecondView的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在LGSecondView上面。（此时不会再去遍历LGFirstView，所以正如你所愿buttonFirst的点击事件也不会被调用）</p>

<p>5）还没有结束，接着回去遍历LGSecondView上的所有子视图，结果所有子视图的hitTest:withEvent:方法都返回nil，因为LGSecondView上面只有secondButton，而点击的点不在secondButton。</p>

<p>6）最终hitTest:withEvent:方法返回当前视图自身(self)，而LGSecondView没有事件要处理。整个过程结束。</p>

<h5>如果我们想让buttonFirst也响应点击事件怎么办？</h5>

<h5>方法一：</h5>

<p>我们在LGSecondView加入如下代码：</p>

<pre><code>#pragma mark - 方法一
-(id)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    UIView *hitView = [super hitTest:point withEvent:event];
    if (hitView == self)
    {
        return nil;
    }
    else
    {
        return hitView;
    }
}
</code></pre>

<p>我们再来分析一下：</p>

<p>还是这个场景，用户点击LGSecondView（点击的点不在buttonSecond上，但是在buttonFirst撒很难过吗），事件处理流程如下：</p>

<p>1）调用UIWindow的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在UIWindow上面。</p>

<p>2）去遍历UIWindow上面的子视图，也就是self.view。同样也是调用self.view的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在self.view上面。</p>

<p>3）去遍历self.view上的子视图，也就是LGFirstView和LGSecondView。（注意：子视图的遍历顺序是从top到bottom，即从subviews数组的末尾向前遍历）。</p>

<p>4）所以先调用LGSecondView的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在LGSecondView上面。</p>

<p>5)但是，注意了，这里有个但是， UIView *hitView = [super hitTest:point withEvent:event];就是这句代码发挥了作用。如果hitView是LGSecondView的话，就不处理点击事件。（这跟userInteractionEnabled=NO是不一样的，userInteractionEnabled=NO，LGSecondView上的buttonSecond也不会响应点击事件了。）</p>

<p>6)这个时候会去调用LGFirstView的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在LGFirstView上面。</p>

<p>7）再去遍历LGFirstView上面的子视图，也就是buttonFirst，调用buttonFirst的hitTest:withEvent:方法，hitTest:withEvent:方法会调用pointInside:withEvent:方法。此时pointInside:withEvent:返回YES，说明触摸事件在buttonFirst上面。</p>

<p>8）再去遍历buttonFirst上的所有子视图，结果所有子视图的hitTest:withEvent:方法都返回nil，说明点击就在buttonFirst，buttonFirst就用响应的点击方法。</p>

<h5>方法二</h5>

<p>在LGSecondView.m</p>

<pre><code>@interface LGSecondView ()

@property (nonatomic, strong) NSMutableArray *subControlsArray;

@end

@implementation LGSecondView


- (id)initWithFrame:(CGRect)frame
{
    if (self = [super initWithFrame:frame]) {
        self.subControlsArray = [NSMutableArray array];
    }
    return self;
}


#pragma mark - 方法二

- (void)addSubview:(UIView *)view{
    [super addSubview:view];
    if ([view isKindOfClass:[UIControl class]]) {
        [self.subControlsArray addObject:view];
    }
}

//set self not response action and self subviews response action
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event;
{
    BOOL toNext = YES;
    for (UIView *view in _subControlsArray) {
        if (CGRectContainsPoint(view.frame, point)) {
            toNext = NO;
            break;
        }
    }
    return !toNext;
}
</code></pre>

<p>具体原理就不在累述了，大家自己推一下，也可以把你的思路写下来发给我。</p>

<p>还有很多方法也欢迎你把思路写下来发给我。我的微信号iOS开发：iOSDevTip</p>

<p>代码下载地址:<a href="https://github.com/worldligang/HitTestMaster.git"target="_blank"title="HitTestMaster">HitTestMaster</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/13">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/11">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>2016年值得关注的公众号</h1>
        <br/>
        <br/><strong>公众号iOS开发：iOSDevTip</strong> 
        <br/>
        <br/><img width="220px" src="http://images.90159.com/icon/iOSDevTip.jpg" />
        <br/>
        <br/><strong>公众号猿圈：CodePush</strong>
        <br/>
        <br/><img width="220px" src="http://images.90159.com/icon/codepush.jpg" />
        <br/>
        <br/><strong>Android开发精选：AndroidPush</strong> 
        <br/>
        <br/><img width="220px" src="http://images.90159.com/icon/AndroidPush.jpg" />
        <br/>
        <br/><strong>公众号Python开发：PythonPush</strong> 
        <br/>
        <br/><img width="220px" src="http://images.90159.com/icon/PythonPush.jpg" />
        </p>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/03/04/test/">Test</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/02/ggteach-learn-ios-simply/">刚刚在线-让学习iOS开发更简单</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/01/female-coder-dream-reply/">女程序员做了个梦，众网友的神回复</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/01/31/xmpp-client-login-dev/">XMPP客户端登录开发详解</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/15/ios-dev-interview/">推荐：iOS开发面试题整理（一）</a>
      </li>
    
  </ul>
</section>
</section>
<section>
    <h1>About Me</h1>
    <br/>
    <p> 李刚：百度百家专栏作者，刚刚在线站长，iOS工程师非著名自媒体人，微信公众号iOS开发：iOSDevTip运营者<br/>
    <br/><strong>出师未捷名已落</strong>
    <br/>
    <br/>新浪微博: <a href='http://weibo.com/ligangnc' target='_blank'>李刚移动</a>
    <br/>
    <br/>个人微信: <strong>chinaligang</strong> 欢迎调戏
    <br/>
    <br/>iOS群: <strong>218822587</strong>
  <br/>
</section>

   
 <section>
    <h1>友情链接</h1>
    <ul>
       <li>
           <a href="http://www.ggteach.com" target="_blank" title="刚刚在线教育">刚刚在线教育</a>
       </li>
       <li>
           <a href="http://www.superqq.com" target="_blank" title="刚刚在线">刚刚在线</a>
       </li>
       <li>
           <a href="http://www.90159.com" target="_blank" title="程序员头条">程序员头条</a>
       </li>
       <li>
           <a href="http://www.iswifting.com" target="_blank" title=“swift开发”>swift开发</a>
       </li>
       <li>
           <a href="http://www.aswifter.com/" target="_blank" title="APP开发者">APP开发者</a>
       </li>
       <li>
        <a href="http://www.codefunny.com" target="_blank" title="程序员的那些事">程序员的那些事</a>
      </li>
      <li>
        <a href="http://www.androidwonder.com" target="_blank" title="Android开发精选">Android开发精选</a>
      </li>
      <li>
        <a href="http://www.pythonpush.com" target="_blank" title="Python开发中文网">Python开发中文网</a>
      </li>
      <li>
        <a href="http://www.linuxpush.com" target="_blank" title="Linux开发中文网">Linux开发中文网</a>
      </li>
      <li>
        <a href="http://www.phpush.com" target="_blank" title="PHP开发中文网">PHP开发中文网</a>
      </li>
      <li>
        <a href="http://www.javawonder.com" target="_blank" title="Java开发中文网">Java开发中文网</a>
      </li>
      <li>
        <a href="http://www.websofun.com" target="_blank" title="WEB开发中文网">WEB开发中文网</a>
      </li>
      <li>
        <a href="http://www.htmlpush.com" target="_blank" title="HTML开发中文网">HTML开发中文网</a>
      </li>
        <li>
           <a href="http://www.boxingjiaoyu.com/" target="_blank" title="程序员聚合平台">程序员聚合平台</a>
       </li>
        <li>
           <a href="http://droidyue.com/" target="_blank" title="技术小黑屋">技术小黑屋</a>
       </li>
        <li>
           <a href="http://www.olinone.com/" target="_blank" title="庞海礁的个人空间">庞海礁的个人空间</a>
       </li>
       <li>
           <a href="http://www.5ibc.net" target="_blank" title="PHP教程">PHP教程</a>
       </li>
       <li>
           <a href="http://gank.io/" target="_blank" title="干货集中营">干货集中营</a>
       </li>
      <li>
           <a href="http://www.mobile-open.com/" target="_blank" title="阳和移动开发">阳和移动开发</a>
       </li>
       <li>
           <a href="http://www.jq-school.com/" target="_blank" title="jquery教程">jquery教程</a>
       </li>
        <li>
           <a href="http://www.admin10000.com/" target="_blank" title="WEB开发者">WEB开发者</a>
       </li>
       <li>
           <a href="http://www.aichengxu.com/" target="_blank" title="爱程序网">爱程序网</a>
       </li>
       <li>
           <a href="http://www.lai18.com" target="_blank" title="IT技术文章">IT技术文章</a>
       </li>
       <li>
           <a href="http://www.cftea.com/" target="_blank" title="千一网络">千一网络</a>
       </li>
        <li>
           <a href="http://www.bmob.cn/" target="_blank" title="Bmob">Bmob移动后端云</a>
       </li>
       <li>
           <a href="http://www.leichunfeng.com" target="_blank" title="雷纯锋的技术博客">雷纯锋的技术博客</a>
       </li>
       <li>
           <a href="http://cuiqingcai.com/" target="_blank" title="静觅">静觅</a>
       </li>
       <li>
           <a href="http://www.zhangfei.tk/" target="_blank" title="张飞的技术博客">张飞的技术博客</a>
       </li>
       <li>
           <a href="http://letsswift.com/" target="_blank" title="一起Swift">一起Swift</a>
       </li>
       <li>
           <a href="http://www.swiftv.cn/" target="_blank" title="SwiftV课堂">SwiftV课堂</a>
       </li>
        <li>
           <a href="http://q.maiziedu.com/" target="_blank" title="iOS开发">iOS开发</a>
       </li>
       <li>
           <a href="http://www.aptusource.org/" target="_blank" title="AptuSource">AptuSource</a>
       </li>
        <li>
            <a href="http://blog.csdn.net/iosdevtip" target="_blank" title="刚刚在线">CSDN</a>
        </li>
        <li>
            <a href="http://user.qzone.qq.com/1606535851" target="_blank" title="刚刚在线">QQ空间</a>
        </li>
        <li>
            <br/><strong>交换友链：</strong>欢迎各大程序员站点交换友情链接，如需交换，请添加好本站链接后发送邮件至下方邮箱。
            <br/>
            <br/><strong>格式：</strong>（ 友链文字：“ 刚刚在线 ”，链接：“ http://www.superqq.com/ ” ）
            <br/>
            <br/><strong>邮箱：</strong>worldligang@163.com
            <br/>
        </li>
    </ul>
<br/>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
Copyright &copy; 2016 - 李刚 
<span class="credit">Powered by <a href="http://octopress.org" target="_blank">Octopress</a></span>
 <span class="credit">, 感谢 <a href="http://gitcafe.com/signup?invited_by=tangqiaoboy" target="_blank">GitCafe</a> 为本站提供存储空间</span><a href="http://www.miitbeian.gov.cn" target="_blank" title=" 豫ICP备16000765号-3"> 豫ICP备16000765号-2</a> 

</p>

<script language="javascript" type="text/javascript" src="http://js.users.51.la/17443209.js"></script>
<noscript><a href="http://www.51.la/?17443209" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/17443209.asp" style="border:none" /></a></noscript>
</footer>
  











</body>
</html>
