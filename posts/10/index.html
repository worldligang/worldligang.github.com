
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
      <meta name="baidu-site-verification" content="X93tJz3pCq" />
  <title>刚刚在线</title>
  <meta name="author" content="李刚">
  <meta name="uyan_auth" content="d1112891bb" />
  <meta name="baidu-tc-verification" content="7acda2305fabbf1ddd9f83e385ddd899" />
      
  
  <meta name="description" content="2年iOS开发站长，优秀iOS开发博客之一。关注iOS开发、swift开发、iOSDevTip、移动互联网、自媒体、Cocoapods、Xcode、iOS，刚刚在线博客是一个值得收藏的网站！">
  <meta name="keywords" content="iOS,iOS开发,cocoapods,code,iOS代码, 源代码, 刚刚在线,iOS李刚, pointInside, 刚刚, hitTest, Objective-c,李刚博客">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.superqq.com/posts/10">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="刚刚在线" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://cdn.staticfile.org/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->


  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">刚刚在线</a></h1>
  
    <h2>关注iOS开发和移动互联网的自媒体博客</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://zhannei.superqq.com" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.superqq.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">全部文章</a></li>
  <li><a href="/blog/categories/ioskai-fa/">iOS开发</a></li>
  <li><a href="/blog/categories/swiftkai-fa">swift开发</a></li>
  <li><a href="/blog/categories/cheng-xu-yuan/">程序员</a></li>
  <li><a href="/blog/categories/yuan-dai-ma/">源代码</a></li>
  <li><a href="/blog/categories/sdkfu-wu/">sdk服务</a></li>
  <li><a href="/blog/categories/tui-jian/">推荐</a></li>
  <li><a href="/about">赞助作者</a></li>
  <li><a href="http://www.90159.com/" target="_blank" title=头条>头条</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/05/coding-ios/">Coding-iOS</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-05T13:09:26+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:09 pm</span></time>
        
        
          | <a href="/blog/2015/01/05/coding-ios/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<p> <a href="https://coding.net/u/coding"target="_blank"title="源代码">源代码</a></p>

<h3>Coding_iOS客户端项目介绍</h3>

<p><em>编译环境：Xcode-Version 6.1 (6A1052d)</em></p>

<h4>下面介绍一下文件的大概目录先：</h4>

<pre><code>.
├── Coding_iOS
│   ├── Models：数据类
│   ├── Views：视图类
│   │   ├── CCell：所有的CollectionViewCell都在这里
│   │   ├── Cell：所有的TableViewCell都在这里
│   │   └── XXX：ListView（项目、动态、任务、讨论、文档、代码）和InputView（用于聊天和评论的输入框）
│   ├── Controllers：控制器，对应app中的各个页面
│   │   ├── Login：登录页面
│   │   ├── RootControllers：登录后的根页面
│   │   ├── MeSetting：设置信息页面
│   │   └── XXX：其它页面
│   ├── Images：app中用到的所有的图片都在这里
│   ├── Resources：资源文件
│   ├── Util：一些常用控件和Category、Manager之类
│   │   ├── Common
│   │   ├── Manager
│   │   ├── OC_Category
│   │   └── ObjcRuntime
│   └── Vendor：用到的一些第三方类库，一般都有改动
│       ├── AFNetworking
│       ├── AGEmojiKeyboard
│       ├── ASProgressPopUpView
│       ├── ActionSheetPicker
│       ├── FontAwesome+iOS
│       ├── MJPhotoBrowser
│       ├── MLEmojiLabel
│       ├── NSDate+Helper
│       ├── NSStringEmojize
│       ├── PPiAwesomeButton
│       ├── QBImagePickerController
│       ├── RDVTabBarController
│       ├── SMPageControl
│       ├── SVPullToRefresh
│       ├── SWTableViewCell
│       ├── UMENG
│       ├── UMessage_Sdk_1.1.0
│       ├── XGPush
│       ├── XTSegmentControl
│       └── iCarousel
└── Pods：项目使用了[CocoaPods](http://code4app.com/article/cocoapods-install-usage)这个类库管理工具
</code></pre>

<h4>再说下项目的启动流程：</h4>

<p>在AppDelegate的启动方法中，先设置了一下Appearance的样式，然后根据用户的登录状态选择是去加载登录页面LoginViewController，还是登录后的RootTabViewController页面。</p>

<p>RootTabViewController继承自第三方库<a href="https://github.com/robbdimitrov/RDVTabBarController">RDVTabBarController</a>。在RootTabViewController里面依次加载了Project_RootViewController、MyTask_RootViewController、Tweet_RootViewController、Message_RootViewController、Me_RootViewController五个RootViewController，后续的页面跳转都是基于这几个RootViewController引过去的。</p>

<h4>项目里面还有些需要注意的点</h4>

<ul>
<li><p>Coding_NetAPIManager：基本上app的所有请求接口都放在了这里。网络请求使用的是<a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>库，与服务器之间的数据交互格式用的都是json（与<a href="https://coding.net">Coding</a>使用的api一致）。</p></li>
<li><p>关于推送：刚开始是用的<a href="http://www.umeng.com/">友盟推送</a>，后来又改用了<a href="http://xg.qq.com/">腾讯信鸽</a>，因为要兼顾旧版本app的推送，所以服务器是同时保留了两套推送。但是为了确保新版本的app不同时收到双份相同的推送消息，所以当前代码里还存留了友盟的sdk，用于解除推送token与友盟Alias的绑定。</p></li>
<li><p>关于ProjectViewController：这个就是进入到某个项目之后的页面，这里包含了项目的动态、任务、讨论、文档、代码、成员各类信息，而且每类信息里面还可能会有新的分类（如‘任务’里面还分有各个成员的任务）；这个页面相当的臃肿，我对它们做了拆分，都放在视图类Views目录下面。 首先是把数据列表独立成了对应的XXXListView（如ProjectTaskListView）；然后如果需要标签切换的话，会再新建一个XXXsView（如：ProjectTasksView），在这个视图中，上面会放一个切换栏<a href="https://github.com/xushao1990/XTNews">XTSegmentControl</a>显示各个标签，下面放一个<a href="https://github.com/nicklockwood/iCarousel">iCarousel</a>可以滑动显示各个标签的内容；最后这些视图都会存储在ProjectViewController的projectContentDict变量里面，根据顶部导航栏选择的类别，去显示或隐藏对应的视图。</p></li>
<li><p>关于UIMessageInputView：这个是私信聊天的输入框。因为这个输入框好多地方都有用到（冒泡、任务、讨论的评论还有私信），所以这个输入框就写成了一个相对独立的控件，并且直接显示在了keyWindow里面而不是某个视图里。这里的表情键盘用的是<a href="https://github.com/ayushgoel/AGEmojiKeyboard">AGEmojiKeyboard</a>改写了一下。</p></li>
<li><p>关于Emoji：这个，<a href="https://coding.net">Coding</a>站点的emoji都是用的图片，而且服务器是不接受大部分emoji字符的，所以刚开始的时候app一直不能处理emoji表情；又因为没有emoji图片名和emoji code码的对应关系表，所以拖了很久都没能做好转换。直到在github上面找到了<a href="https://github.com/diy/NSStringEmojize">NSStringEmojize</a>这个项目；试了一下，虽然也不能全部解析，但是大部分表情都能正确显示了，不能更感谢。</p></li>
<li><p>关于如何正确显示冒泡的内容：api返回的数据里面，冒泡内容都是html格式，需要做一下预处理；其实私信、讨论里面的内容也是html。解析html的类名是HtmlMediaItem，它是先用<a href="https://github.com/topfunky/hpple">hpple</a>对html进行了解析，然后把对应的media元素和对应的位置做一个存储，显示的时候便可以根据需要来显示了。</p></li>
</ul>


<h4>最后说下<a href="http://code4app.com/article/cocoapods-install-usage">CocoaPods</a>里面用到的第三方类库</h4>

<ul>
<li><a href="https://github.com/rs/SDWebImage">SDWebImage</a>：图片加载</li>
<li><a href="https://github.com/TTTAttributedLabel/TTTAttributedLabel">TTTAttributedLabel</a>：富文本的label，可点击链接</li>
<li><a href="https://github.com/wezm/RegexKitLite">RegexKitLite</a>：正则表达式</li>
<li><a href="https://github.com/topfunky/hpple">hpple</a>：html解析</li>
<li><a href="https://github.com/jdg/MBProgressHUD">MBProgressHUD</a>：hud提示框</li>
<li><a href="https://github.com/Sephiroth87/ODRefreshControl">ODRefreshControl</a>：下拉刷新</li>
<li><a href="https://github.com/michaeltyson/TPKeyboardAvoiding">TPKeyboardAvoiding</a>：有文字输入时，能根据键盘是否弹出来调整自身显示内容的位置</li>
<li><a href="https://github.com/jaydee3/JDStatusBarNotification">JDStatusBarNotification</a>：状态栏提示框</li>
<li><a href="https://github.com/zwaldowski/BlocksKit">BlocksKit</a>：block工具包。将很多需要用delegate实现的方法整合成了block的形式</li>
<li><a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a>：基于响应式编程思想的oc实践（是个好东西呢）</li>
</ul>


<h4>License</h4>

<p>Coding is available under the MIT license. See the LICENSE file for more info.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/05/iosda-shen-matttjie-zuo-afnetworking/">AFNetworking</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-05T12:56:20+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:56 pm</span></time>
        
        
          | <a href="/blog/2015/01/05/iosda-shen-matttjie-zuo-afnetworking/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<p>AFNetworking是一个轻量级的iOS网络通信类库，继ASI类库不在更新之后开发者们有一套不错选择；</p>

<p> <a href="https://github.com/AFNetworking/AFNetworking"target="_blank"title="源代码">源代码</a></p>

<p align="center" >
  <img src="https://raw.github.com/AFNetworking/AFNetworking/assets/afnetworking-logo.png" alt="AFNetworking" title="AFNetworking">
</p>


<p><a href="https://travis-ci.org/AFNetworking/AFNetworking"><img src="https://travis-ci.org/AFNetworking/AFNetworking.svg" alt="Build Status" /></a></p>

<p>AFNetworking is a delightful networking library for iOS and Mac OS X. It&rsquo;s built on top of the <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html">Foundation URL Loading System</a>, extending the powerful high-level networking abstractions built into Cocoa. It has a modular architecture with well-designed, feature-rich APIs that are a joy to use.</p>

<p>Perhaps the most important feature of all, however, is the amazing community of developers who use and contribute to AFNetworking every day. AFNetworking powers some of the most popular and critically-acclaimed apps on the iPhone, iPad, and Mac.</p>

<p>Choose AFNetworking for your next project, or migrate over your existing projects—you&rsquo;ll be happy you did!</p>

<h2>How To Get Started</h2>

<ul>
<li><a href="https://github.com/AFNetworking/AFNetworking/archive/master.zip">Download AFNetworking</a> and try out the included Mac and iPhone example apps</li>
<li>Read the <a href="https://github.com/AFNetworking/AFNetworking/wiki/Getting-Started-with-AFNetworking">&ldquo;Getting Started&rdquo; guide</a>, <a href="https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-FAQ">FAQ</a>, or <a href="https://github.com/AFNetworking/AFNetworking/wiki">other articles on the Wiki</a></li>
<li>Check out the <a href="http://cocoadocs.org/docsets/AFNetworking/">documentation</a> for a comprehensive look at all of the APIs available in AFNetworking</li>
<li>Read the <a href="https://github.com/AFNetworking/AFNetworking/wiki/AFNetworking-2.0-Migration-Guide">AFNetworking 2.0 Migration Guide</a> for an overview of the architectural changes from 1.0.</li>
</ul>


<h2>Communication</h2>

<ul>
<li>If you <strong>need help</strong>, use <a href="http://stackoverflow.com/questions/tagged/afnetworking">Stack Overflow</a>. (Tag &lsquo;afnetworking&rsquo;)</li>
<li>If you&rsquo;d like to <strong>ask a general question</strong>, use <a href="http://stackoverflow.com/questions/tagged/afnetworking">Stack Overflow</a>.</li>
<li>If you <strong>found a bug</strong>, <em>and can provide steps to reliably reproduce it</em>, open an issue.</li>
<li>If you <strong>have a feature request</strong>, open an issue.</li>
<li>If you <strong>want to contribute</strong>, submit a pull request.</li>
</ul>


<h3>Installation with CocoaPods</h3>

<p><a href="http://cocoapods.org">CocoaPods</a> is a dependency manager for Objective-C, which automates and simplifies the process of using 3rd-party libraries like AFNetworking in your projects. See the <a href="https://github.com/AFNetworking/AFNetworking/wiki/Getting-Started-with-AFNetworking">&ldquo;Getting Started&rdquo; guide for more information</a>.</p>

<h4>Podfile</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">platform</span> <span class="ss">:ios</span><span class="p">,</span> <span class="s1">&#39;7.0&#39;</span>
</span><span class='line'><span class="n">pod</span> <span class="s2">&quot;AFNetworking&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 2.0&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Requirements</h2>

<table>
<thead>
<tr>
<th style="text-align:center;"> AFNetworking Version </th>
<th style="text-align:center;"> Minimum iOS Target  </th>
<th style="text-align:center;"> Minimum OS X Target  </th>
<th style="text-align:center;">                                   Notes                                   </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">          2.x         </td>
<td style="text-align:center;">            iOS 6            </td>
<td style="text-align:center;">           OS X 10.8          </td>
<td style="text-align:center;"> Xcode 5 is required. <code>AFHTTPSessionManager</code> requires iOS 7 or OS X 10.9. </td>
</tr>
<tr>
<td style="text-align:center;">          <a href="https://github.com/AFNetworking/AFNetworking/tree/1.x">1.x</a>         </td>
<td style="text-align:center;">            iOS 5            </td>
<td style="text-align:center;">         Mac OS X 10.7        </td>
<td style="text-align:center;">                                                                           </td>
</tr>
<tr>
<td style="text-align:center;">        <a href="https://github.com/AFNetworking/AFNetworking/tree/0.10.x">0.10.x</a>        </td>
<td style="text-align:center;">            iOS 4            </td>
<td style="text-align:center;">         Mac OS X 10.6        </td>
<td style="text-align:center;">                                                                           </td>
</tr>
</tbody>
</table>


<p>(OS X projects must support <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtVersionsPlatforms.html">64-bit with modern Cocoa runtime</a>).</p>

<blockquote><p>Programming in Swift? Try <a href="https://github.com/Alamofire/Alamofire">Alamofire</a> for a more conventional set of APIs.</p></blockquote>

<h2>Architecture</h2>

<h3>NSURLConnection</h3>

<ul>
<li><code>AFURLConnectionOperation</code></li>
<li><code>AFHTTPRequestOperation</code></li>
<li><code>AFHTTPRequestOperationManager</code></li>
</ul>


<h3>NSURLSession <em>(iOS 7 / Mac OS X 10.9)</em></h3>

<ul>
<li><code>AFURLSessionManager</code></li>
<li><code>AFHTTPSessionManager</code></li>
</ul>


<h3>Serialization</h3>

<ul>
<li><code>&lt;AFURLRequestSerialization&gt;</code>

<ul>
<li><code>AFHTTPRequestSerializer</code></li>
<li><code>AFJSONRequestSerializer</code></li>
<li><code>AFPropertyListRequestSerializer</code></li>
</ul>
</li>
<li><code>&lt;AFURLResponseSerialization&gt;</code>

<ul>
<li><code>AFHTTPResponseSerializer</code></li>
<li><code>AFJSONResponseSerializer</code></li>
<li><code>AFXMLParserResponseSerializer</code></li>
<li><code>AFXMLDocumentResponseSerializer</code> <em>(Mac OS X)</em></li>
<li><code>AFPropertyListResponseSerializer</code></li>
<li><code>AFImageResponseSerializer</code></li>
<li><code>AFCompoundResponseSerializer</code></li>
</ul>
</li>
</ul>


<h3>Additional Functionality</h3>

<ul>
<li><code>AFSecurityPolicy</code></li>
<li><code>AFNetworkReachabilityManager</code></li>
</ul>


<h2>Usage</h2>

<h3>HTTP Request Operation Manager</h3>

<p><code>AFHTTPRequestOperationManager</code> encapsulates the common patterns of communicating with a web application over HTTP, including request creation, response serialization, network reachability monitoring, and security, as well as request operation management.</p>

<h4><code>GET</code> Request</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">manager</span> <span class="nl">GET</span><span class="p">:</span><span class="s">@&quot;http://example.com/resources.json&quot;</span> <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;JSON: %@&quot;</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h4><code>POST</code> URL-Form-Encoded Request</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@&quot;foo&quot;</span><span class="o">:</span> <span class="s">@&quot;bar&quot;</span><span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">manager</span> <span class="nl">POST</span><span class="p">:</span><span class="s">@&quot;http://example.com/resources.json&quot;</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;JSON: %@&quot;</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h4><code>POST</code> Multi-Part Request</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@&quot;foo&quot;</span><span class="o">:</span> <span class="s">@&quot;bar&quot;</span><span class="l">}</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">fileURLWithPath</span><span class="p">:</span><span class="s">@&quot;file://path/to/image.png&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">manager</span> <span class="nl">POST</span><span class="p">:</span><span class="s">@&quot;http://example.com/resources.json&quot;</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span> <span class="nl">constructingBodyWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AFMultipartFormData</span><span class="o">&gt;</span> <span class="n">formData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="n">formData</span> <span class="nl">appendPartWithFileURL</span><span class="p">:</span><span class="n">filePath</span> <span class="nl">name</span><span class="p">:</span><span class="s">@&quot;image&quot;</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span> <span class="nl">success</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Success: %@&quot;</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>AFURLSessionManager</h3>

<p><code>AFURLSessionManager</code> creates and manages an <code>NSURLSession</code> object based on a specified <code>NSURLSessionConfiguration</code> object, which conforms to <code>&lt;NSURLSessionTaskDelegate&gt;</code>, <code>&lt;NSURLSessionDataDelegate&gt;</code>, <code>&lt;NSURLSessionDownloadDelegate&gt;</code>, and <code>&lt;NSURLSessionDelegate&gt;</code>.</p>

<h4>Creating a Download Task</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">configuration</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">];</span>
</span><span class='line'><span class="n">AFURLSessionManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFURLSessionManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithSessionConfiguration</span><span class="p">:</span><span class="n">configuration</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://example.com/download.zip&quot;</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">URL</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURLSessionDownloadTask</span> <span class="o">*</span><span class="n">downloadTask</span> <span class="o">=</span> <span class="p">[</span><span class="n">manager</span> <span class="nl">downloadTaskWithRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">progress</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">destination</span><span class="p">:</span><span class="o">^</span><span class="bp">NSURL</span> <span class="o">*</span><span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">targetPath</span><span class="p">,</span> <span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSURL</span> <span class="o">*</span><span class="n">documentsDirectoryURL</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSFileManager</span> <span class="n">defaultManager</span><span class="p">]</span> <span class="nl">URLForDirectory</span><span class="p">:</span><span class="n">NSDocumentDirectory</span> <span class="nl">inDomain</span><span class="p">:</span><span class="n">NSUserDomainMask</span> <span class="nl">appropriateForURL</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">create</span><span class="p">:</span><span class="nb">NO</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">documentsDirectoryURL</span> <span class="nl">URLByAppendingPathComponent</span><span class="p">:[</span><span class="n">response</span> <span class="n">suggestedFilename</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span> <span class="nl">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="bp">NSURL</span> <span class="o">*</span><span class="n">filePath</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;File downloaded to: %@&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="p">[</span><span class="n">downloadTask</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Creating an Upload Task</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">configuration</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">];</span>
</span><span class='line'><span class="n">AFURLSessionManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFURLSessionManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithSessionConfiguration</span><span class="p">:</span><span class="n">configuration</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://example.com/upload&quot;</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">URL</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">fileURLWithPath</span><span class="p">:</span><span class="s">@&quot;file://path/to/image.png&quot;</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURLSessionUploadTask</span> <span class="o">*</span><span class="n">uploadTask</span> <span class="o">=</span> <span class="p">[</span><span class="n">manager</span> <span class="nl">uploadTaskWithRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">fromFile</span><span class="p">:</span><span class="n">filePath</span> <span class="nl">progress</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Success: %@ %@&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="p">[</span><span class="n">uploadTask</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Creating an Upload Task for a Multi-Part Request, with Progress</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSMutableURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestSerializer</span> <span class="n">serializer</span><span class="p">]</span> <span class="nl">multipartFormRequestWithMethod</span><span class="p">:</span><span class="s">@&quot;POST&quot;</span> <span class="nl">URLString</span><span class="p">:</span><span class="s">@&quot;http://example.com/upload&quot;</span> <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">constructingBodyWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AFMultipartFormData</span><span class="o">&gt;</span> <span class="n">formData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">formData</span> <span class="nl">appendPartWithFileURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">fileURLWithPath</span><span class="p">:</span><span class="s">@&quot;file://path/to/image.jpg&quot;</span><span class="p">]</span> <span class="nl">name</span><span class="p">:</span><span class="s">@&quot;file&quot;</span> <span class="nl">fileName</span><span class="p">:</span><span class="s">@&quot;filename.jpg&quot;</span> <span class="nl">mimeType</span><span class="p">:</span><span class="s">@&quot;image/jpeg&quot;</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">AFURLSessionManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFURLSessionManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithSessionConfiguration</span><span class="p">:[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">]];</span>
</span><span class='line'><span class="bp">NSProgress</span> <span class="o">*</span><span class="n">progress</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURLSessionUploadTask</span> <span class="o">*</span><span class="n">uploadTask</span> <span class="o">=</span> <span class="p">[</span><span class="n">manager</span> <span class="nl">uploadTaskWithStreamedRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">progress</span><span class="p">:</span><span class="o">&amp;</span><span class="n">progress</span> <span class="nl">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@ %@&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">uploadTask</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Creating a Data Task</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSURLSessionConfiguration</span> <span class="o">*</span><span class="n">configuration</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLSessionConfiguration</span> <span class="n">defaultSessionConfiguration</span><span class="p">];</span>
</span><span class='line'><span class="n">AFURLSessionManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFURLSessionManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithSessionConfiguration</span><span class="p">:</span><span class="n">configuration</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://example.com/upload&quot;</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">URL</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSURLSessionDataTask</span> <span class="o">*</span><span class="n">dataTask</span> <span class="o">=</span> <span class="p">[</span><span class="n">manager</span> <span class="nl">dataTaskWithRequest</span><span class="p">:</span><span class="n">request</span> <span class="nl">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSURLResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@ %@&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="p">[</span><span class="n">dataTask</span> <span class="n">resume</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Request Serialization</h3>

<p>Request serializers create requests from URL strings, encoding parameters as either a query string or HTTP body.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">URLString</span> <span class="o">=</span> <span class="s">@&quot;http://example.com&quot;</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">parameters</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@&quot;foo&quot;</span><span class="o">:</span> <span class="s">@&quot;bar&quot;</span><span class="p">,</span> <span class="s">@&quot;baz&quot;</span><span class="o">:</span> <span class="l">@[</span><span class="mi">@1</span><span class="p">,</span> <span class="mi">@2</span><span class="p">,</span> <span class="mi">@3</span><span class="l">]}</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Query String Parameter Encoding</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">AFHTTPRequestSerializer</span> <span class="n">serializer</span><span class="p">]</span> <span class="nl">requestWithMethod</span><span class="p">:</span><span class="s">@&quot;GET&quot;</span> <span class="nl">URLString</span><span class="p">:</span><span class="n">URLString</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>GET http://example.com?foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3
</code></pre>

<h4>URL Form Parameter Encoding</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">AFHTTPRequestSerializer</span> <span class="n">serializer</span><span class="p">]</span> <span class="nl">requestWithMethod</span><span class="p">:</span><span class="s">@&quot;POST&quot;</span> <span class="nl">URLString</span><span class="p">:</span><span class="n">URLString</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>POST http://example.com/
Content-Type: application/x-www-form-urlencoded

foo=bar&amp;baz[]=1&amp;baz[]=2&amp;baz[]=3
</code></pre>

<h4>JSON Parameter Encoding</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">AFJSONRequestSerializer</span> <span class="n">serializer</span><span class="p">]</span> <span class="nl">requestWithMethod</span><span class="p">:</span><span class="s">@&quot;POST&quot;</span> <span class="nl">URLString</span><span class="p">:</span><span class="n">URLString</span> <span class="nl">parameters</span><span class="p">:</span><span class="n">parameters</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>POST http://example.com/
Content-Type: application/json

{"foo": "bar", "baz": [1,2,3]}
</code></pre>

<hr />

<h3>Network Reachability Manager</h3>

<p><code>AFNetworkReachabilityManager</code> monitors the reachability of domains, and addresses for both WWAN and WiFi network interfaces.</p>

<h4>Shared Network Reachability</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="p">[[</span><span class="n">AFNetworkReachabilityManager</span> <span class="n">sharedManager</span><span class="p">]</span> <span class="nl">setReachabilityStatusChangeBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFNetworkReachabilityStatus</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Reachability: %@&quot;</span><span class="p">,</span> <span class="n">AFStringFromNetworkReachabilityStatus</span><span class="p">(</span><span class="n">status</span><span class="p">));</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>HTTP Manager Reachability</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">baseURL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://example.com/&quot;</span><span class="p">];</span>
</span><span class='line'><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithBaseURL</span><span class="p">:</span><span class="n">baseURL</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">operationQueue</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="n">operationQueue</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="n">manager</span><span class="p">.</span><span class="n">reachabilityManager</span> <span class="nl">setReachabilityStatusChangeBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFNetworkReachabilityStatus</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFNetworkReachabilityStatusReachableViaWWAN</span><span class="p">:</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFNetworkReachabilityStatusReachableViaWiFi</span><span class="p">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">operationQueue</span> <span class="nl">setSuspended</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="nl">AFNetworkReachabilityStatusNotReachable</span><span class="p">:</span>
</span><span class='line'>        <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="p">[</span><span class="n">operationQueue</span> <span class="nl">setSuspended</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">manager</span><span class="p">.</span><span class="n">reachabilityManager</span> <span class="n">startMonitoring</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>Security Policy</h3>

<p><code>AFSecurityPolicy</code> evaluates server trust against pinned X.509 certificates and public keys over secure connections.</p>

<p>Adding pinned SSL certificates to your app helps prevent man-in-the-middle attacks and other vulnerabilities. Applications dealing with sensitive customer data or financial information are strongly encouraged to route all communication over an HTTPS connection with SSL pinning configured and enabled.</p>

<h4>Allowing Invalid SSL Certificates</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="n">AFHTTPRequestOperationManager</span> <span class="o">*</span><span class="n">manager</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFHTTPRequestOperationManager</span> <span class="n">manager</span><span class="p">];</span>
</span><span class='line'><span class="n">manager</span><span class="p">.</span><span class="n">securityPolicy</span><span class="p">.</span><span class="n">allowInvalidCertificates</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span> <span class="c1">// not recommended for production</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h3>AFHTTPRequestOperation</h3>

<p><code>AFHTTPRequestOperation</code> is a subclass of <code>AFURLConnectionOperation</code> for requests using the HTTP or HTTPS protocols. It encapsulates the concept of acceptable status codes and content types, which determine the success or failure of a request.</p>

<p>Although <code>AFHTTPRequestOperationManager</code> is usually the best way to go about making requests, <code>AFHTTPRequestOperation</code> can be used by itself.</p>

<h4><code>GET</code> with <code>AFHTTPRequestOperation</code></h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSURL</span> <span class="o">*</span><span class="n">URL</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://example.com/resources/123.json&quot;</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURLRequest</span> <span class="nl">requestWithURL</span><span class="p">:</span><span class="n">URL</span><span class="p">];</span>
</span><span class='line'><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">op</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestOperation</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>
</span><span class='line'><span class="n">op</span><span class="p">.</span><span class="n">responseSerializer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFJSONResponseSerializer</span> <span class="n">serializer</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">op</span> <span class="nl">setCompletionBlockWithSuccess</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="kt">id</span> <span class="n">responseObject</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;JSON: %@&quot;</span><span class="p">,</span> <span class="n">responseObject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="nl">failure</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Error: %@&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">op</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Batch of Operations</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='objective-c'><span class='line'><span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">mutableOperations</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="bp">NSURL</span> <span class="o">*</span><span class="n">fileURL</span> <span class="k">in</span> <span class="n">filesToUpload</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSURLRequest</span> <span class="o">*</span><span class="n">request</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestSerializer</span> <span class="n">serializer</span><span class="p">]</span> <span class="nl">multipartFormRequestWithMethod</span><span class="p">:</span><span class="s">@&quot;POST&quot;</span> <span class="nl">URLString</span><span class="p">:</span><span class="s">@&quot;http://example.com/upload&quot;</span> <span class="nl">parameters</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">constructingBodyWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">AFMultipartFormData</span><span class="o">&gt;</span> <span class="n">formData</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">formData</span> <span class="nl">appendPartWithFileURL</span><span class="p">:</span><span class="n">fileURL</span> <span class="nl">name</span><span class="p">:</span><span class="s">@&quot;images[]&quot;</span> <span class="nl">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">AFHTTPRequestOperation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AFHTTPRequestOperation</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithRequest</span><span class="p">:</span><span class="n">request</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">mutableOperations</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">operation</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="bp">NSArray</span> <span class="o">*</span><span class="n">operations</span> <span class="o">=</span> <span class="p">[</span><span class="n">AFURLConnectionOperation</span> <span class="nl">batchOfRequestOperations</span><span class="p">:</span><span class="l">@[</span><span class="p">...</span><span class="l">]</span> <span class="nl">progressBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSUInteger</span> <span class="n">numberOfFinishedOperations</span><span class="p">,</span> <span class="bp">NSUInteger</span> <span class="n">totalNumberOfOperations</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%lu of %lu complete&quot;</span><span class="p">,</span> <span class="n">numberOfFinishedOperations</span><span class="p">,</span> <span class="n">totalNumberOfOperations</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="nl">completionBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">operations</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;All operations in batch complete&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span> <span class="nl">addOperations</span><span class="p">:</span><span class="n">operations</span> <span class="nl">waitUntilFinished</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Unit Tests</h2>

<p>AFNetworking includes a suite of unit tests within the Tests subdirectory. In order to run the unit tests, you must install the testing dependencies via <a href="http://cocoapods.org/">CocoaPods</a>:</p>

<pre><code>$ cd Tests
$ pod install
</code></pre>

<p>Once testing dependencies are installed, you can execute the test suite via the &lsquo;iOS Tests&rsquo; and &lsquo;OS X Tests&rsquo; schemes within Xcode.</p>

<h3>Running Tests from the Command Line</h3>

<p>Tests can also be run from the command line or within a continuous integration environment. The <a href="https://github.com/mneorr/xcpretty"><code>xcpretty</code></a> utility needs to be installed before running the tests from the command line:</p>

<pre><code>$ gem install xcpretty
</code></pre>

<p>Once <code>xcpretty</code> is installed, you can execute the suite via <code>rake test</code>.</p>

<h2>Credits</h2>

<p>AFNetworking was originally created by <a href="https://github.com/sco/">Scott Raymond</a> and <a href="https://github.com/mattt/">Mattt Thompson</a> in the development of <a href="http://en.wikipedia.org/wiki/Gowalla">Gowalla for iPhone</a>.</p>

<p>AFNetworking&rsquo;s logo was designed by <a href="http://www.alandefibaugh.com/">Alan Defibaugh</a>.</p>

<p>And most of all, thanks to AFNetworking&rsquo;s <a href="https://github.com/AFNetworking/AFNetworking/contributors">growing list of contributors</a>.</p>

<h2>Contact</h2>

<p>Follow AFNetworking on Twitter (<a href="https://twitter.com/AFNetworking">@AFNetworking</a>)</p>

<h3>Maintainers</h3>

<ul>
<li><a href="http://github.com/mattt">Mattt Thompson</a> (<a href="https://twitter.com/mattt">@mattt</a>)</li>
</ul>


<h2>License</h2>

<p>AFNetworking is available under the MIT license. See the LICENSE file for more info.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/05/ios-slash-androidkai-fa-yi-dong-duan-xin-sdklie-biao/">iOS/Android开发移动短信SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-05T12:25:55+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:25 pm</span></time>
        
        
          | <a href="/blog/2015/01/05/ios-slash-androidkai-fa-yi-dong-duan-xin-sdklie-biao/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>Mob免费短信验证码</h3>

<p><a href="http://mob.com/sms"target="_blank"title="进入官网">进入官网</a></p>

<p>开发者只需申请账号，APP内植入短信验证码SDK，简单设置后便可完美实现短信验证，同时也可实现通信录好友匹配功能，轻而易举实现短信验证服务。</p>

<h2></br></h2>

<h3>威达手机号码验证</h3>

<p><a href="http://www.yuxin168.com/PNVWebSite/index.html"target="_blank"title="进入官网">进入官网</a></p>

<p>由于短信验证码会遇到发送不成功、到达太迟、易被软件拦截等种种弊端，威尔信达手机号码验证服务是一款不用向用户发送短信验证码，不用用户输入验证码，只要知道用户的手机号码和sim卡号码，通过电信网络自动完成号码验证的服务。</p>

<h2></br></h2>

<h3>新浪SAE短信服务</h3>

<p><a href="http://sae.sina.com.cn"target="_blank"title="进入官网">进入官网</a></p>

<p>新浪无线短信服务是由新浪无线提供的综合性短信服务。通过该服务您可以给指定的手机发短信( 支持中国移动、中国联通、中国电信网络，短信到达率90%以上)；您发送的短信内容字数将不能超过72字(不含签名)。 短信服务属于收费服务，您可以使用付费云豆购买开通使用。</p>

<h2></br></h2>

<h3>电信天翼WEB短信API能力接口</h3>

<p><a href="http://open.189.cn/show-6-88-1.html"target="_blank"title="进入官网">进入官网</a></p>

<p>中国电信天翼开放平台宣布最新推出免费WEB短信API能力接口，向第三方开发者提供免费WEB短信推送的能力。</p>

<h2></br></h2>

<h3>联通Wo短信能力开放接口</h3>

<p><a href="http://open.wo.com.cn/aep/index.html"target="_blank"title="进入官网">进入官网</a></p>

<p>系统提供短信能力开放接口，通过联通能力共享平台，互联网应用能够向终端用户发送短信。</p>

<h2></br></h2>

<h3>飞拓·掌中传媒</h3>

<p><a href="http://www.groupsms.cn/"target="_blank"title="进入官网">进入官网</a></p>

<p>南京飞拓短信验证码接口/订单通知短信专用接口，具有全国全网发送、3-5秒内响应、100%到达、通道稳定免维护等优势。专为网站短信验证码、网站订单通知等互动应用开设。</p>

<h2></br></h2>

<h3>天翼开放平台短消息</h3>

<p><a href="http://open.189.cn/index.php?m=ability&c=index&a=show&id=359"target="_blank"title="进入官网">进入官网</a></p>

<p>天翼短消息包括：模板短信、短信验证码、发送免费web短息。</p>

<h2></br></h2>

<h3>三基时代</h3>

<p><a href="http://www.3gimes.com"target="_blank"title="进入官网">进入官网</a></p>

<p>三基时代（3Gimes）成立于2007年5月，早期专注于移动增值信息服务（SI），是中国移动、联通、电信的高级战略合伙伙伴；目前专注于验证码短信、移动互联网的统一通讯融合平台。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/05/ios-slash-androidkai-fa-ji-shi-tong-xun-sdklie-biao/">iOS/Android开发即时通讯SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-05T12:16:22+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:16 pm</span></time>
        
        
          | <a href="/blog/2015/01/05/ios-slash-androidkai-fa-ji-shi-tong-xun-sdklie-biao/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>环信即时通讯云</h3>

<p><a href="http://www.easemob.com"target="_blank"title="进入官网">进入官网</a></p>

<p>环信即时通讯云是移动即时通讯能力的云计算 PaaS (Platform as a Service, 平台即服务) 平台服务商。移动即时通讯能力是指基于互联网和移动终端的单聊，群聊，富媒体消息，实时语音，实时视频，多人语音视频，流媒体播放及互动等通讯能力。环信将移动即时通讯能力通过云端开放的API 和客户端 SDK 包的方式提供给开发者和企业，帮助合作伙伴在自己的产品中便捷、快速的实现通讯和社交功能。</p>

<h2></br></h2>

<h3>融云即时通讯云</h3>

<p><a href="http://www.rongcloud.cn"target="_blank"title="进入官网">进入官网</a></p>

<p>融云是国内首家专业的即时通讯云服务提供商，专注为互联网、移动互联网开发者提供即时通讯基础能力和云端服务。通过融云平台，开发者不必搭建服务端硬件环境，就可以将即时通讯、实时网络能力快速集成至应用中。融云针对开发者所需的不同场景，提供了一系列产品、技术解决方案，包括：客户端IM组件，客户端IM基础库，服务端REST API，客户端实时网络通讯基础库等。利用这些解决方案，开发者可以直接在自己的应用中构建出即时通讯产品，也可以无限创意出自己的即时通讯场景。</p>

<h2></br></h2>

<h3>容联·云通讯语音服务</h3>

<p><a href="http://www.yuntongxun.com"target="_blank"title="进入官网">进入官网</a></p>

<p>云通讯平台为企业及个人开发者提供各种通讯能力，包括VoIP、视频、会议、呼叫中心/IVR、IM等，开发者通过嵌入云通讯API能够在应用中轻松实现各种通讯功能，包括语音验证码、语音对讲、群组语聊、点击拨号、营销外呼、语音会议、视频通话、云呼叫中心等功能。</p>

<h2></br></h2>

<h3>亲加即时通讯云</h3>

<p><a href="http://www.gotye.com.cn"target="_blank"title="进入官网">进入官网</a></p>

<p>亲加即时通讯云通过向开发者提供SDK和API，帮助开发者实现应用内部的单聊，群聊，聊天室功能。其中 API 提供了完整的聊天室及一对一单聊功能，通过在应用中接入亲加API，能够实现文字、图片以及语音的发送和接收。</p>

<h2></br></h2>

<h3>LeanCloud实时消息</h3>

<p><a href="https://cn.avoscloud.com/features/storage.html#%2Fslide-2"target="_blank"title="进入官网">进入官网</a></p>

<p>LeanCloud实时消息只需几行代码，就可使用户的应用完成移动 IM 的功能添加。IM 系统与当前用户系统完全解耦，无需同步或修改现有用户体系，即可使用；除 iOS、Android 移动开发的原生 SDK 之外，还也支持网页内聊天。</p>

<h2></br></h2>

<h3>云之讯</h3>

<p><a href="http://www.ucpaas.com/product_service/download"target="_blank"title="进入官网">进入官网</a></p>

<p>云之讯融合通讯开放平台为企业及个人开发者提供各种通讯能力，包括VoIP、视频、会议、呼叫中心/IVR、IM等，开发者通过嵌入云通讯API能够在应用中轻松实现各种通讯功能，包括语音验证码、语音对讲、群组语聊、点击拨号、营销外呼、语音会议、视频通话等功能。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/ios-slash-androidkai-fa-ren-lian-shi-bie-sdklie-biao/">iOS/Android开发人脸识别SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T17:57:18+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>5:57 pm</span></time>
        
        
          | <a href="/blog/2015/01/04/ios-slash-androidkai-fa-ren-lian-shi-bie-sdklie-biao/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>Face++人脸识别</h3>

<p><a href="http://www.faceplusplus.com.cn"target="_blank"title="进入官网">进入官网</a></p>

<p>Face++ 致力于研发世界最好的人脸技术，提供免费的API和SDK供企业和开发者调用，更有灵活的定制化服务满足不同需求。已有多家公司使用Face++技术服务，完成包括人脸搜索、定位、识别、智能美化等功能。我们旨在为合作者提供完善的技术与维护服务。</p>

<h2></br></h2>

<h3>百度媒体云人脸识别</h3>

<p><a href="http://developer.baidu.com/wiki/index.php?title=docs/cplat/media/face"target="_blank"title="进入官网">进入官网</a></p>

<p>百度媒体云人脸识别服务，依托百度业界领先的人脸识别算法，提供了人脸检测、五官定位、人脸属性检测等功能。媒体云人脸识别服务通过提供一系列HTTP Restful API及跨终端平台SDK，实现人脸检测、人脸识别等的诸项功能。</p>

<h2></br></h2>

<h3>ReKognition API</h3>

<p><a href="http://rekognition.com"target="_blank"title="进入官网">进入官网</a></p>

<p>利用ReKognition提供的云端人脸识别API实现的一个简单人脸识别Demo，能够识别人脸的五官、人脸的大概年龄、是否戴眼镜、是否闭眼、性别等等功能。</p>

<h2></br></h2>

<h3>RecoFace人脸识别SDK</h3>

<p><a href="http://www.reconova.com/product/List1.shtml?type=product"target="_blank"title="进入官网">进入官网</a></p>

<p>RecoFace人脸识别SDK是瑞为自主研发的人脸识别核心算法，包括人脸检测、人脸跟踪、人脸确认与人脸识别四大核心功能，无论是识别准确度还是识别速度均处于全球领先水平。</p>

<h2></br></h2>

<h3>汉王云人脸识别</h3>

<p><a href="http://developer.hanvon.com"target="_blank"title="进入官网">进入官网</a></p>

<p>汉王科技凭借十几年扎根模式识别领域的底蕴，早在2003年，就瞄准人脸识别技术的国际前沿，积极开展人脸识别技术的潜心研究。目前已经拥有完全自主知识产权的“双目立体”人脸识别算法（Dual Sensor）。汉王云提供免费的人脸识别API和SDK供企业和开发者调用，汉王人脸识别技术广泛应用于智能安全、身份验证等领域，还可识别表情年龄性别，应用开发最具潜力。</p>

<h2></br></h2>

<h3>科大讯飞人脸识别</h3>

<p><a href="http://open.voicecloud.cn/index.php/services/face?type=face"target="_blank"title="进入官网">进入官网</a></p>

<p>科大讯飞联合香港中文大学汤晓鸥教授团队，共同推出世界领先的人脸识别技术，提供人脸验证、人脸检测、人脸关键点检测等功能，识别率高达99%。核心技术源自于学术界最新的深度学习方法及其相关研究，结合大量公开和独有的训练数据集，在超级计算机上学习并提取照片特征，实现高效准确的标定和识别，致力于提供便捷准确的人脸识别技术，为移动设备交互、摄像头应用等不同场景提供强有力的技术支持。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/ios-slash-androidkai-fa-di-tu-sdklie-biao/">iOS/Android开发地图SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T14:48:48+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:48 pm</span></time>
        
        
          | <a href="/blog/2015/01/04/ios-slash-androidkai-fa-di-tu-sdklie-biao/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>高德地图</h3>

<p><a href="http://lbs.amap.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>高德地图SDK是一套简单的地图应用开发调用接口，可支持地图显示与操作，兴趣点搜索，地理编码、离线地图等功能。开发者可以轻松地将其嵌入自己的应用程序，并使用相关的地图功能。地图显示与搜索服务分为两个独立的类库，开发者可以单独加载任一一个。</p>

<h2></br></h2>

<h3>百度地图</h3>

<p><a href="http://developer.baidu.com/map/"target="_blank"title="进入官网">进入官网</a></p>

<p>百度地图API是一套为开发者免费提供的基于百度地图的应用程序接口，提供基本地图、位置搜索、周边搜索、公交驾车导航、定位服务、地理编码及逆地理编码等丰富功能。通过地图API，一方面解决移动开发者服务器端日益增长的海量位置数据的存储维护压力，另一方面彻底解决所有LBS开发者基于位置数据的高并发检索瓶颈。</p>

<h2></br></h2>

<h3>苹果地图</h3>

<p><a href="https://developer.apple.com/cn/"target="_blank"title="进入官网">进入官网</a></p>

<p>在你的应用程序使用基于位置的信息是一个伟大的方式来保持连接到周围世界的用户。无论您使用这些信息的实际用途（如导航），或为娱乐，基于位置的信息，才能提高整体的用户体验。基于位置的信息由两部分组成：位置服务和地图。位置服务是由核心地段的框架，它定义的Objective-C接口，以获取关于用户的位置信息和标题（在其中一个设备指向的方向）提供。地图是由地图Kit框架，它支持的映射类似于地图应用程序发现两者的显示和注释提供。（要使用地图Kit框架的功能，您必须打开地图功能在你的Xcode项目。）位置服务和地图都可以在iOS和OS X。因为地图和定位服务可用在在iOS和OS X操作系统上，所以在这两个平台上的代码很相似。不同之处在于用户界面代码（例如，使用的UIView在iOS和NSView的在OS X上），并在那些在iOS中唯一（如标题服务）所支持的一些功能。</p>

<h2></br></h2>

<h3>腾讯地图</h3>

<p><a href="http://lbs.qq.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>腾讯 Android sdk是一套基于Android 1.5及以上版本设备的应用程序接口，通过该接口，您可以轻松访问腾讯地图服务和数据，构建功能丰富、交互性强的地图应用程序。</p>

<p>腾讯地图API（IOS）是一套基于iOS4.0及以上设备的应用程序接口，通过该接口，您可以轻松访问腾讯地图服务和数据，构建功能丰富、交互性强的地图应用程序。腾讯地图API不仅包含构建地图的基本接口，还提供了诸如地图定位、地址编码，地址反编码，实时路况,POI搜索，周边搜索,公交路线搜索，驾车路线搜索，公交线搜索等数据服务，你可以根据自己的需要进行选择，目前支持Iphone4.0以上的版本。</p>

<h2></br></h2>

<h3>搜狗地图</h3>

<p><a href="http://map.sogou.com/api/?IPLOC=CN4101"target="_blank"title="进入官网">进入官网</a></p>

<p>搜狗地图API是一套基于移动互联网设备的应用程序接口，支持iOS/Android平台。通过该接口，您可以构建操作简单、功能丰富的地图应用，里面包含构建地图基本功能的各种接口，提供了诸如位置搜索、周边查询、线站查询、（反）地理编码等功能服务。搜狗地图API免费提供，任何非盈利性程序均可使用。 提供了大量的实例，开发过程中可以直接拷贝，引用其中的代码。</p>

<h2></br></h2>

<h3>图吧地图</h3>

<p><a href="http://open.mapbar.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>图吧地图移动版API以jar包的方式提供对地图的各种操作，如展示、拖拽、标注、绘制、定位等。基于此您可以轻松地构建各类功能丰富、交互性强的地图应用程序。</p>

<h2></br></h2>

<h3>天地图</h3>

<p><a href="http://api.tianditu.com/api-new/home.html"target="_blank"title="进入官网">进入官网</a></p>

<p>天地图移动API（Android）V2.1版（以下简称天地图移动API）是一套基于Android2.2及以上版本设备的应用程序接口，以jar包的形式提供各种地图服务和数据，如地图展示、标注、定位等等。使用天地图移动API开发包可以轻松地构建各类功能丰富、交互性强的地图应用程序。</p>

<h2></br></h2>

<h3>MapABC地图</h3>

<p><a href="http://code.mapabc.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>MapABC地图服务平台是集数据、服务、应用为一体的企业级GIS开发平台，提供全面的基于地图和位置的服务，可以满足您全方位的地图应用需求。地图服务平台包括数据、地图服务API、客户端API&amp;导航SDK三个部分, 提供制图、专题图、地图展现、搜索、定位、地理编码、逆地理编码、驾车导航、公交换乘、路网分析、实时交通等功能。地图服务API用于提供高性能的地图服 务，客户端API&amp;导航SDK用于在Web和Mobile应用层提供方便易用的客户端开发API。</p>

<h2></br></h2>

<h3>我要地图</h3>

<p><a href="http://api.51ditu.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>我要地图手机版是一款基于网络的免费手机地图软件。Android版目前提供地图浏览、兴趣点搜索、我的位置、公交路线规划、快速切换城市等功能，是您日常生活的好助手。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/ios-slash-androidkai-fa-zhi-fu-sdklie-biao/">iOS/Android开发支付SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T14:03:37+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:03 pm</span></time>
        
        
          | <a href="/blog/2015/01/04/ios-slash-androidkai-fa-zhi-fu-sdklie-biao/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>支付宝</h3>

<p><a href="https://openhome.alipay.com/doc/docIndex.htm"target="_blank"title="进入官网">进入官网</a></p>

<p>支付宝是一个开放式的支付平台，为各类交易场景提供支付工具的支持，并致力于为广大用户提供安全快速的电子支付、网上支付、安全支付、手机支付体验，及转账收款、水电煤缴费、信用卡还款、AA收款等生活服务应用。</p>

<h2></br></h2>

<h3>银联</h3>

<p><a href="http://mobile.unionpay.com/"target="_blank"title="进入官网">进入官网</a></p>

<p>银联支付涵盖便民服务、金融服务、商旅出行、休闲娱乐、电子商城等多种应用。可轻松为手机充值、购买保险、查询银行卡余额、预订酒店机票、代购火车票和购买时令商品。随时随地提供“一站式”移动支付生活服务。</p>

<h2></br></h2>

<h3>微信支付</h3>

<p><a href="https://open.weixin.qq.com/cgi-bin/frame?t=home/pay_tmpl&lang=zh_CN"target="_blank"title="进入官网">进入官网</a></p>

<p>微信支付是由腾讯公司知名移动社交通讯软件微信及第三方支付平台财付通联合推出的移动支付创新产品，旨在为广大微信用户及商户提供更优质的支付服务，微信的支付和安全系统由腾讯财付通提供支持。财付通是持有互联网支付牌照并具备完备的安全体系的第三方支付平台。</p>

<h2></br></h2>

<h3>支付宝移动开放平台</h3>

<p><a href="https://mp.alipay.com/portal/index.htm"target="_blank"title="进入官网">进入官网</a></p>

<p>支付宝移动开放平台包含四大模块：二维码平台、卡券平台、服务窗平台、WiFi平台。</p>

<h2></br></h2>

<h3>百度钱包</h3>

<p><a href="https://www.baifubao.com"target="_blank"title="进入官网">进入官网</a></p>

<p>百付宝是由全球最大的中文搜索引擎公司百度所创办，是中国领先的在线支付应用和服务平台。百度钱包以建立“简单可依赖”的在线支付信用体系为己任，其创新的产品技术、丰富的应用功能、为用户量身定做的交易体验流程，为互联网用户和企业提供安全、可依赖的在线支付服务。百度钱包提供卓越的网上支付和清算服务，为用户提供了在线充值、在线支付、交易管理、生活服务、提现、账户提醒等丰富的功能，特有的双重密码设置和安全中心的实时监控功能更是给百度钱包账户安全提供了双重保障。</p>

<h2></br></h2>

<h3>腾讯移动支付</h3>

<p><a href="http://cpay.qq.com/mpay"target="_blank"title="进入官网">进入官网</a></p>

<p>腾讯支付SDK拥有Q币、财付通、银行卡、充值卡、微支付等多种支付渠道，支持iOS与Android两大操作系统，体验上原生内置，与游戏充分融合。</p>

<h2></br></h2>

<h3>360游戏内支付</h3>

<p><a href="http://dev.360.cn/html/sdk/pay_sdk.html"target="_blank"title="进入官网">进入官网</a></p>

<p>手机游戏支付SDK简介：此SDK包主要面向联网游戏开发者，包括有服务器和客户端两部分。</p>

<p></br></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/04/ioskai-fa-tui-song-sdkji-he/">iOS/Android开发推送SDK列表</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-04T12:33:21+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:33 pm</span></time>
        
        
          | <a href="/blog/2015/01/04/ioskai-fa-tui-song-sdkji-he/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>更多iOS开发相关技术请关注iOS开发微信公众号 iOS开发 ：</p>

<pre><code>iOSDevTip
</code></pre>

<h3>极光推送</h3>

<p><a href="https://www.jpush.cn"target="_blank"title="进入官网">进入官网</a></p>

<p>极光推送，英文简称 JPush，是一个面向普通开发者开放的，部分免费的第三方消息推送服务。极光推送使得开发者可以即时地向其应用程序的用户推送通知或消息，与用户保持互动，从而有效地提高留存率，提升用户体验。平台提供整合了Android推送、iOS推送的统一推送服务。</p>

<h2></br></h2>

<h3>智游推送</h3>

<p><a href="https://www.zypush.com"target="_blank"title="进入官网">进入官网</a></p>

<p>智游推送是北京智游网安科技有限公司为开发者设计的一款推送服务。推送包括移动端SDK和网页后端控制，帮助开发者解决消息推送难题。并且保证推送服务的稳定、高效和即时性。开发者通过添加SDK后，服务消息可以推送到其客户端，通过IP通道实现用户间免费实时通讯服务，支持文字，图片等。</p>

<h2></br></h2>

<h3>个推</h3>

<p><a href="http://www.getui.com"target="_blank"title="进入官网">进入官网</a></p>

<p>个推是由国内个信互动网络科技有限公司所推出的平台，帮助企业的应用通过低成本互联网通道进行消息推送，提供完善、高效、稳定的服务体系，解决了互联网云端到手机端的消息互通问题，依托于已有成熟的推送技术，建立更加稳定符合市场需求的标准化服务平台。</p>

<h2></br></h2>

<h3>百度云推送</h3>

<p><a href="http://developer.baidu.com/cloud/push"target="_blank"title="进入官网">进入官网</a></p>

<p>百度云推送（Push）是百度开放云向开发者提供的消息推送服务；通过利用云端与客户端之间建立稳定、可靠的长连接来为开发者提供向客户端应用推送实时消息服务。百度云推送服务支持推送三种类型的消息：通知、透传消息及富媒体；支持向所有用户或根据标签分类向特定用户群体推送消息。</p>

<h2></br></h2>

<h3>友盟推送</h3>

<p><a href="http://www.umeng.com/push"target="_blank"title="进入官网">进入官网</a></p>

<p>友盟是中国最专业、最有数据凝聚力的移动开发者服务平台，于2010年4月在北京创建。友盟以移动应用统计分析为产品起点，发展成为综合性的移动开发者服务平台。友盟推送是一款帮你将应用的内容更新或活动通知主动推送给终端用户，让用户第一时间获取到相关信息，有效提升用户活跃度和留存率的一种服务。</p>

<h2></br></h2>

<h3>小米推送</h3>

<p><a href="http://dev.xiaomi.com/doc/?page_id=1670"target="_blank"title="进入官网">进入官网</a></p>

<p>小米推送(MiPush)是小米公司为开发者提供的消息推送服务，通过在云端和客户端之间建立一条稳定、可靠的长连接，为开发者提供向客户端应用推送实时消息的服务，帮助开发者有效地拉动用户活跃。</p>

<h2></br></h2>

<h3>腾讯信鸽推送</h3>

<p><a href="http://xg.qq.com"target="_blank"title="进入官网">进入官网</a></p>

<p>信鸽（XG Push）是一款专业移动App推送平台，支持百亿级的通知/消息推送，秒级触达移动用户，现已全面支持Android和iOS两大主流平台。开发者可以方便地通过嵌入SDK，通过API调用或者Web端可视化操作，实现对特定用户推送，大幅提升用户活跃度，有效唤醒沉睡用户，并实时查看推送效果。</p>

<h2></br></h2>

<h3>华为推送</h3>

<p><a href="http://developer.huawei.com/push"target="_blank"title="进入官网">进入官网</a></p>

<p>华为Push是为开发者提供的消息推送平台，建立了从云端到手机端的消息推送通道，让你可以将最新信息及时通知你的用户，去构筑良好的用户关系，提升用户的感知和活跃度。华为Push支持透传消息、通知栏消息、富媒体消息、LBS消息。</p>

<h2></br></h2>

<h3>云巴</h3>

<p><a href="http://www.yunba.io"target="_blank"title="进入官网">进入官网</a></p>

<p>云巴可以让管理者进行一对多和一对一推送，而且多个应用可以复用一个链接，而对于不在线的用户，服务器会保存每一条信息，下次上线时候确保信息被送达，并且支持实时统计与实时在线功能。</p>

<h2></br></h2>

<h3>盛大云推送</h3>

<p><a href="http://www.grandcloud.cn/product/push"target="_blank"title="进入官网">进入官网</a></p>

<p>盛大移动云推送服务是基于盛大云计算Iaas平台所构建的推送服务平台，旨在降低移动应用开发者的开发、运维成本。</p>

<p>使用盛大移动云推送服务，移动应用开发者无需为推送服务搭建服务端，只需在应用开发时集成云推送服务提供的sdk，即可轻松的让应用支持推送服务。</p>

<h2></br></h2>

<h3>亚马逊推送</h3>

<p><a href="http://aws.amazon.com/cn/sns/"target="_blank"title="进入官网">进入官网</a></p>

<p>亚马逊推送Amazon Simple Notification Service (SNS) 是一项快速灵活、管理到位的消息推送服务。Amazon SNS 让推送到 iPhone、iPad、Android、Kindle Fire 和连接 Internet 的智能设备等移动设备以及推送到其他分布式服务变得简单且经济实惠。</p>

<h2></br></h2>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/27/ioskai-fa-zhong-de-gcdduo-xian-cheng-tips/">iOS开发中的gcd多线程tips</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-27T16:48:27+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:48 pm</span></time>
        
        
          | <a href="/blog/2014/12/27/ioskai-fa-zhong-de-gcdduo-xian-cheng-tips/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>本篇文章会持续更新：</p>

<p><div class="entry-content"><h4>我们经常用到的：</h3></p>

<pre><code>dispatch_async(dispatch_get_global_queue(0, 0), ^{  
    // 处理耗时操作的代码块 

    //通知主线程刷新  
    dispatch_async(dispatch_get_main_queue(), ^{  
        //回调或者说是通知主线程刷新  
    });  

});  
</code></pre>

<p>其中main_queue是系统默认的串行队列，global_queue是系统默认的并行队列。</p>

<p><div class="entry-content"><h5>什么是串行队列（Serial）？</h3></p>

<p>创建任意个数的串行队列，每个队列依次执行添加的任务，一个队列同一时刻只能执行一个任务（串行），但是各个队列之间不影响，可以并发执行。每个队列中的任务运行在一个由各自串行队列维护的独立线程上，一个队列中只有一个线程。</p>

<p><div class="entry-content"><h5>什么是并行队列（Concurrent）？</h3></p>

<p>并行队列是不允许自己创建的，系统中存在三个不同优先级的并行队列。并行队列依旧按照任务添加的顺序启动任务，但是，后一个任务无须等待前一个任务执行完毕，而是启动第一个任务后，立即启动下一个任务。至于同一时刻允许同时运行多少个任务有系统决定。任务各自运行在并行队列为他们提供的独立线程上，并行队列中同时运行多少个任务，就必须维护多少个线程。</p>

<p>gcd中还有一个概念叫做主调度队列</p>

<p><div class="entry-content"><h5>主调度队列（main dispatch queue）</h3>
主调度队列中的任务运行在应用程序主线程上，所以，如果你要修改应用程序的界面，他是唯一的选择。</p>

<p>如下：</p>

<pre><code> dispatch_async(dispatch_get_main_queue(), ^{

        //跟新界面的操作

    });
</code></pre>

<p><div class="entry-content"><h4>只执行一次：</h3></p>

<pre><code>static dispatch_once_t onceToken;  
dispatch_once(&amp;onceToken, ^{  
    // 这里写的代码只会被执行一次
}); 
</code></pre>

<p>如果你收集有实用的关于gcd的用法，欢迎分享给我，直接在文章下面评论即可</p>

<p>我的微信公众号：</p>

<pre><code>iOSDevTip
</code></pre>

<p>转载请注明：<a href="http://www.superqq.com/blog/2014/12/27/ioskai-fa-zhong-de-gcdduo-xian-cheng-tips/">iOS开发中的gcd多线程tips</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/23/ios-7zhong-shi-xian-mo-hu-xiao-guo-jiao-cheng/">iOS 7中实现模糊效果教程</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-23T16:21:21+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>4:21 pm</span></time>
        
        
          | <a href="/blog/2014/12/23/ios-7zhong-shi-xian-mo-hu-xiao-guo-jiao-cheng/#comments">Comments</a>
         
      </p>
    
  </header>


  <div class="entry-content"><p>iOS 7在视觉方面有许多改变，其中非常吸引人的功能之一就是在整个系统中巧妙的使用了模糊效果。许多第三方应用程序已经采用了这样的设计细节，并以各种奇妙的和具有创造性的方式使用它。</p>

<p>本文将通过几种不同的技术来实现iOS 7中的模糊效果，当然，这一切都利用了一个名为<a href="https://github.com/BradLarson/GPUImage">GPUImage</a>的框架。</p>

<p>GPUImage是由<a href="www.sunsetlakesoftware.com/blog">Brad Larson</a>创建的，它利用GPU，使在图片和视频上应用不同的效果和滤镜变得非常的容易，同时它还拥有出色的性能，并且它的性能要比苹果内置的相关APIs出色。</p>

<p>注意：本文需要一台物理设备来编译并运行示例程序(在模拟器上无法使用)。同样还需要一个iOS开发者账号。如果你还没有开发者账号的 话，可以来<a href="https://developer.apple.com/">这里</a>注册一个。注册为开发者之后，会有许多福利哟，例如可以使用物理设备来 开发程序，提前获得苹果的相关测试版程序，以及大量的开发资源。</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/TutorialLogo-500x500.png"></p>

<p>iOS中利用GPUImage实现模糊效果</p>

<p>下面我们先来看看本文的目录结构：</p>

<pre><code>开始
为什么要是用模糊效果
    深度引导
    上下文
    关注度
添加静态的模糊效果
    创建截图Category
    利用断点测试截屏图片
    显示截屏图片
    设置contentsRect
    重置模糊滤镜
    对其背景图片
实时模糊
线程中简洁的分支
一些潜在的实时模糊方案
一个折中的方法——对视频实时模糊
    利用GPUImage对视频进行模糊处理
何去何从？
</code></pre>

<p><div class="entry-content"><h3>开始</h3></p>

<p>首先先来<a href="https://github.com/worldligang/Video-Blurring.git">这里</a>下载本文的starter工程，并将其解压出来。</p>

<p>用Xcode打开Video Blurring.xcodeproj，并将工程运行到设备中。此时看到程序的效果如下所示：
<img src="http://cdn1.raywenderlich.com/wp-content/uploads/2013/12/Start-700x394.png"></p>

<p>点击屏幕左上角的菜单(三条横纹)，可以看到界面中出现两个选项：录制视频和播放已有视频。</p>

<p>请注意，现在所有的用户界面都有一个灰色的背景，是不是感觉有点沉闷呢，本文我们就利用iOS 7中的模糊效果来替换掉这些沉闷的灰色背景。</p>

<p><div class="entry-content"><h3>为什么要是用模糊效果</h3></p>

<p>除了外观看起来很棒以外，模糊效果还可以让程序给用户带来3个重要的概念：深度引导、上下文和关注度。
<div class="entry-content"><h4>深度引导</h3></p>

<p>在用户界面上，模糊效果可以给用户提供一个深度引导效果，并且有利于用户对程序导航的理解。在之前的iOS版本中的深度引导效果是通过：三维斜面 (three-dimensional bevels)和有关泽的按钮(反映出一个模拟的光源)，而在iOS 7中是通过模糊和视差(<a href="http://en.wikipedia.org/wiki/Parallax">parallax</a>)来实现的。</p>

<p>这里说的视差效果，可以很明显的观察出来：在装有iOS 7的设备中，将设备从一侧倾斜至另一侧，会发现设备中的图标在移动(会独立于背景)。这样可以给用户做出一个提示：界面是由不同的层构成的，并且重要的界 面元素是在最前面的——这也涉及到下面将要介绍的一个概念：上下文。</p>

<p><div class="entry-content"><h4>上下文</h3></p>

<p>上下文可以让用户在程序内获得一种轴承的感觉。动画的过度效果就提供了一种非常优秀的上下文，当用户点击一个按钮时，在两个view之间利用动画效 果来切换画面(而不是直接显示一个新的view)，可以让用户知道新的view是从哪里出现的，并且可以让用户很容易知道如何回到上一个view。</p>

<p>模糊效果可以将上一个view当做背景显示出来，尽管上一个view已经失去焦点了，不过可以给用户提供更多的上下文：刚刚是在哪里。通知中心就是一个非常棒的例子：当拉下通知中心时，我们可以在背景中看到原来的view(即使现在正在处于通知中心界面)。</p>

<p><div class="entry-content"><h4>关注度</h3></p>

<p>让界面更加关注于某些选择项上，而移除不需要的内容，让用户可以更加快捷的进行导航。用户可以本能的忽略那些被模糊的界面元素，而将注意力集中到某些界面元素中。</p>

<p>通过本文，你将学到两种模糊类型的实现方法：静态模糊和动态模糊。静态模糊代表着快照的时间点，它并不能反映被模糊界面元素的变化。大多数情况下，使用静态模糊效果就足够了。相反，动态模糊则是对需要模糊的背景做出实时更新。</p>

<p>相信看到具体的效果才是最好的，下面我们就来看看模糊效果的具体实现吧！</p>

<p><div class="entry-content"><h3>添加静态的模糊效果</h3></p>

<p>创建一个静态模糊效果首先是将当前屏幕中的view转换为一幅图片。获得图片之后，只需要对图片做模糊处理就可以了。将view转换为一幅图片(截屏)苹果已经提供了一些非常棒的APIs了，并且在iOS 7中又有了新的方法可以让截屏更加快速。</p>

<p>这些新的方法属于<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIView_Class/index.html#//apple_ref/occ/instm/UIView/drawViewHierarchyInRect:afterScreenUpdates:">截屏APIs</a>中的一部分，截屏APIs不仅可以对某个view截屏，还能把整个view层次截屏，如果你希望对某个view截屏，那么可以把view中的按钮、标签、开关等各种view也进行截屏。</p>

<p>此处我们将截屏的逻辑实现到UIView的一个category中。这样一来，我们就可以很方便快捷的将任意的view(以及view中的内容)转换为一个图片——也算是代码的重用吧。</p>

<p><div class="entry-content"><h4>创建截图Category</h3></p>

<p>打开File/New/File&hellip;，然后选择iOS/Cocoa Touch/Objective-C category，如下图所示：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2013/12/NewCategory-700x477.png"></p>

<p>将这个category命名为Screenshot，并将它的category选为UIView,如下图所示：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/CategoryInfo-700x477.png"></p>

<p>将下面这个方法声明到UIView+Screenshot.h中：</p>

<pre><code>-(UIImage *)convertViewToImage; 
</code></pre>

<p>接着将如下方法添加到 UIView+Screenshot.m 中：</p>

<pre><code>-(UIImage *)convertViewToImage 
{ 
    UIGraphicsBeginImageContext(self.bounds.size); 
    [self drawViewHierarchyInRect:self.bounds afterScreenUpdates:YES]; 
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext(); 
    UIGraphicsEndImageContext(); 

    return image; 
} 
</code></pre>

<p>上面的方法中，首先调用了UIGraphicsBeginImageContext()，最后调用的是UIGraphicsEndImageContext()，这两行代码可以理解为图形上下文的一个事物处理过程。一个上下文可以理解为不同的概念，例如屏幕，或者此处可以理解为一幅图片。这里的两行代码起到一个离屏画布的作用——可以将view绘制上去。</p>

<p>drawViewHierarchyInRect:afterScreenUpdates:方法利用view层次结构并将其绘制到当前的上下文中。</p>

<p>最后，UIGraphicsGetImageFromCurrentImageContext()从图形上下文中获取刚刚生成的UIImage。</p>

<p>现在，我们已经完成了category的实现，接着我们只需要在使用到的地方将其import一下即可。</p>

<p>如下代码所示，将代码添加到DropDownMenuController.m顶部：</p>

<pre><code>#import "UIView+Screenshot.h" 
</code></pre>

<p>同时，将如下方法添加到相同的文件中：</p>

<pre><code>-(void)updateBlur 
{ 
    UIImage *image = [self.view.superview convertViewToImage]; 
} 
</code></pre>

<p>上面的代码确保是对superview进行截屏，而不仅仅是当前的view。不这样做的话，截屏获得的图片只是menu本身。</p>

<p><div class="entry-content"><h4>利用断点测试截屏图片</h3></p>

<p>为了测试截屏的效果，我们在convertViewToImage调用的下面一行添加一个断点。这样当命中断点时，程序会在断点中暂停执行，这样我们就可以看到截屏的图片，以此确保截屏代码的正确性:</p>

<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2013/12/AddBreakpoint.png"></p>

<p>在测试之前还有一件事情需要做：调用上面这个方法。</p>

<p>找到show方法，并在addToParentViewController下面直接调用一下updateBlur：</p>

<pre><code>-(void)show { 
    [self addToParentViewController]; 

    [self updateBlur]; // Add this line 

    CGRect deviceSize = [UIScreen mainScreen].bounds; 

    [UIView animateWithDuration:0.25f animations:^(void){ 
        _blurView.frame = CGRectMake(0, 0, deviceSize.size.height, MENUSIZE); 
        _backgroundView.frame = CGRectMake(0, 0, _backgroundView.frame.size.width, MENUSIZE); 
    }]; 
} 
</code></pre>

<p>编译并运行程序，点击菜单按钮，可以看到Xcode在断点出停止了，如下所示：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/BreakpointInfo-700x211.png"></p>

<p>在debugger左下角hand pane中选择image，然后单击快速查找图标按钮，就可以预览刚刚的截屏啦：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/ImagePreview-700x416.png"></p>

<p>如上图所示，正是我们所预期的。
<div class="entry-content"><h4>显示截屏图片</h3></p>

<p>将截取到的图片显示到菜单的背景中就是小菜一碟啦。</p>

<p>一般来说我们都会利用UIImageView来显示一幅图片，而由于我们要利用GPUImage来模糊图片，所以需要使用GPUImageView。</p>

<p>在这里的工程中，已经添加好了GPUImage框架，我们只需要将头文件import一下即可。</p>

<p>将下面的代码添加到DropDownMenuController.m顶部：</p>

<pre><code>#import &lt;GPUImage/GPUImage.h&gt; 
</code></pre>

<p>注意：GPUImage被包含在一个框架中，所以在import语句中，需要利用尖括弧，而不是双引号。</p>

<p>此时，有一个_blurView，类型为UIView——是菜单的灰色背景。将UIView修改为GPUImageView，如下所示：</p>

<pre><code>@implementation DropDownMenuController { 
    GPUImageView *_blurView; 
    UIView *_backgroundView; 
} 
</code></pre>

<p>修改之后，Xcode会报一个warning：大意是你利用UIView进行实例化，而不是预期的GPUImageView。</p>

<p>可以通过下面的方法消除这个警告，在viewDidLad中修改做如下修改：</p>

<pre><code>_blurView = [[GPUImageView alloc] initWithFrame:CGRectMake(0, 0, deviceSize.size.height, 0)]; 
</code></pre>

<p>紧随其后，将如下两行代码添加进去，并移除设置背景色的代码：</p>

<pre><code>_blurView.clipsToBounds = YES; 
_blurView.layer.contentsGravity = kCAGravityTop; 
</code></pre>

<p>clipToBounds属性设置为YES，把超出_blurView范围的子view隐藏起来，而contentsGravity确保图片出现在image view的顶部。</p>

<p>由于_blurView已经用于背景了，所以此处不需要额外设置了。</p>

<p>接着，我们还需要声明一个用于模糊效果的过滤器。</p>

<p>将如下代码添加到DropDownMenuController.m:文件的@implementation中：</p>

<pre><code>GPUImageiOSBlurFilter *_blurFilter; 
</code></pre>

<p>找到之前添加的断点，右键单击，并选中Delete Breakpoint：</p>

<p><img src="http://cdn4.raywenderlich.com/wp-content/uploads/2013/12/DeleteBreakpoint.png"></p>

<p>下面是非常重要的一步了——初始化模糊滤镜。将如下代码添加到DropDownMenuController.m中：</p>

<pre><code>-(void)updateBlur 
{ 
    if(_blurFilter == nil){ 
        _blurFilter = [[GPUImageiOSBlurFilter alloc] init]; 
         _blurFilter.blurRadiusInPixels = 1.0f; 

    } 

    UIImage *image = [self.view.superview convertViewToImage]; 
} 
</code></pre>

<p>注意：上面将模糊半径设置为一个像素，这里暂时将这个值设置低一点，这样可以确保图片的正确定位，当一切ok之后，再增加模糊半径即可。</p>

<p>下面是时候将图片显示到GPUImageView中了。不过并不是简单的实例化一个UIImage，并将其添加到GPUImageView中。首先需创建一个GPUImagePicture。</p>

<p>将如下代码添加到updateBlur方法的底部：</p>

<pre><code>GPUImagePicture *picture = [[GPUImagePicture alloc] initWithImage:image]; 
</code></pre>

<p>至此，我们获得了一个图片，模糊滤镜和iamge view。</p>

<p>接着再将如下代码添加到updateBlur底部：</p>

<pre><code>[picture addTarget:_blurFilter]; 
[_blurFilter addTarget:_blurView]; 

[picture processImage]; 
</code></pre>

<p>上面这几行代码，就像胶水一样，将所有的事情关联起来。将滤镜当做target添加到图片中，然后将image view当做滤镜的target。</p>

<p>上面代码对图片的处理全程发生在GPU上，也就是说当进行模糊计算和显示时，并不会影响到用户界面。当处理结束时，会把图片显示到image view上面。</p>

<p>编译并运行程序，点击菜单按钮，可以看到如下类似画面：</p>

<p><img src="http://cdn1.raywenderlich.com/wp-content/uploads/2013/12/HalfImage-700x394.png"></p>

<p>上面的图片看起来是不是有点奇怪？看到的图片被缩放到适配到菜单视图中了。要对此做出修正，我们需要指定图片的哪一部分需要显示在GPUImageView中——也就是处理截屏视图的上半部分。</p>

<p><div class="entry-content"><h4>设置contentsRect</h3></p>

<p>按照如下代码所示修改DropDownMenuController.m文件中的show方法：</p>

<pre><code>-(void)show 
{ 
    [self addToParentViewController]; 

    [self updateBlur]; 

    CGRect deviceSize = [UIScreen mainScreen].bounds; 

    [UIView animateWithDuration:0.25f animations:^(void){ 
        _blurView.frame = CGRectMake(0.0f, 0.0f, deviceSize.size.height, MENUSIZE); 
        _backgroundView.frame = CGRectMake(0.0f, 0.0f, _backgroundView.frame.size.width, MENUSIZE); 
        _blurView.layer.contentsRect = CGRectMake(0.0f, 0.0f, 1.0f, MENUSIZE / 320.0f); // Add this line! 
    }]; 
} 
</code></pre>

<p>通过指定_blurView.layer.contentsRect来定义一个矩形，在单元坐标空间(unit coordinate space)中，表示只使用layer content的一部分。</p>

<p>编译并运行程序，点击菜单按钮，会看到如下图所示效果：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2013/12/HalfBox-700x394.png"></p>

<p>虽然已经使用了图片的一部分，看起来还是不正确，这是因为它的缩放比例还不适合！此处还缺少对正确内容的缩放。</p>

<p>将下面这行代码添加到show方法中动画block的尾部：</p>

<pre><code>_blurView.layer.contentsScale = (MENUSIZE / 320.0f) * 2; 
</code></pre>

<p>contentsScale属性声明了layer在逻辑坐标空间(以点为单位)和物理坐标空间(以像素为单位)之间的映射关系。更高比例因子表示在渲染layer时，一个点代表着多个像素点。</p>

<p>编译并运行程序，点击菜单按钮，可以看到缩放比例已经正常了：</p>

<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2013/12/FullBlur-700x394.png"></p>

<p>没错——看起来好多了！现在关闭程序，然后重新打开，ou~~发生了什么？如下图所示：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2013/12/HalfBlackBox-700x394.png"></p>

<p>看起来这还是有点问题。如果在对view进行animation之前将contentScale设置回2.0，会解决half bar的问题。</p>

<p>将如下代码添加到DropDownMenuController.m中show方法里面的animation block上面：</p>

<pre><code>_blurView.layer.contentsScale = 2.0f; 
</code></pre>

<p>编译并运行程序，然后点击菜单，接着关闭菜单，再打开菜单，此时菜单开起来如下所示：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/FullBlackBox-700x394.png"></p>

<p>现在半个尺寸的黑色box已经没有问题了——但是现在是全尺寸的黑色box！</p>

<p><div class="entry-content"><h4>重置模糊滤镜</h3></p>

<p>上面问题产生的原因是由于进行了二次模糊计算。解决的方法是移除模糊滤镜中的所有target。如果不这样做的话，之后对滤镜的调用不会输出任何的内容——进而引起黑色box的问题。</p>

<p>按照如下代码更新一下updateBlur方法：</p>

<pre><code>-(void)updateBlur 
{ 
    if(_blurFilter == nil){ 
        _blurFilter = [[GPUImageiOSBlurFilter alloc] init]; 
        _blurFilter.blurRadiusInPixels = 1.0f; 
    } 

    UIImage *image = [self.view.superview convertViewToImage]; 

    GPUImagePicture *picture = [[GPUImagePicture alloc] initWithImage:image]; 
    [picture addTarget:_blurFilter]; 
    [_blurFilter addTarget:_blurView]; 

    [picture processImageWithCompletionHandler:^{ 
        [_blurFilter removeAllTargets]; 
    }]; 
} 
</code></pre>

<p>上面的代码用processImageWithCompletionHandler:替换了processImage方法。这个新的方法有一个completion block，当image 处理结束时，会运行这个block。一旦image处理结束，我们就可以安全的将滤镜中的target全部移除。</p>

<p>编译并运行程序，点击菜单，检查一下黑色box问题是不是已经解决掉了：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2013/12/FinalGrayButton-700x394.png"></p>

<p>多次打开和关闭菜单，确保之前的那个bug已经解决掉啦！</p>

<p>现在仔细观察一下打开菜单的模糊效果——有些东西看起来不正确。为了更加明显的观察到问题，我们减慢动画的时间，让其慢慢的移动。</p>

<p>在show方法中，将animation bloc的持续时间修改为10.0f。</p>

<p>编译并运行程序，点击菜单，然后观察一下菜单出场的慢动作：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/MisalignedBlur-700x394.png"></p>

<p>恩，现在可能你已经发现问题了。被模糊的图片从顶部往下滑动——而我们的本意是希望模糊效果从上往下滑(并不是图片本身)。
<div class="entry-content"><h4>对其背景图片</h3></p>

<p>此处我们需要对静态模糊效果使用一些技巧。当出现菜单时，我们需要利用背景来将模糊效果对其。所以在这里我们不是对image view做移动处理，而是需要对image view做扩展处理，从0开始扩展至image view的全尺寸。这样就可以确保菜单打开时，图片依然保留在原位。</p>

<p>在show方法中，我们已经将菜单打开至全尺寸了，所以现在只需要将contentRect的高度设置为0即可(当image view首次创建并隐藏的时候)。</p>

<p>将下面的代码添加至DropDownMenuController.m文件的viewDidLoad方法中——在_blurView初始化的下方：</p>

<pre><code>_blurView.layer.contentsRect = CGRectMake(0.0f, 0.0f, 1.0f, 0.0f); 
</code></pre>

<p>同时，在相同的一个文件中，将下面的代码添加到animation block的尾部：</p>

<pre><code>_blurView.layer.contentsRect = CGRectMake(0.0f, 0.0f, 1.0f, 0.0f); 
</code></pre>

<p>contentRect属性是可以动画方式设置的。因此在动画期间会rect会自动的插补上。</p>

<p>编译并运行程序。可以看到，问题已经解决：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2013/12/HalfView.png"></p>

<p>这样看起来自然多了。现在我们已经有一个具有模糊背景的滑动菜单了。</p>

<p>现在是时候把动画所需时间调整一下了（为了更好的效果，其实之前设置的值是为了测试所用）：设置为0.25秒，接着在updateBlur方法中将_blurFilter.blurRadiusInPixels设置为4.0f。</p>

<p>编译并运行程序，多次打开菜单，看看效果如何：</p>

<p><img src="http://cdn1.raywenderlich.com/wp-content/uploads/2013/12/FinalBlur-700x394.png"></p>

<p><div class="entry-content"><h3>实时模糊</h3></p>

<p>实时模糊涉及到的技术具有一定的难度，有些难点需要解决才行。为了有效的进行实时模糊，我们需要不停(每秒60帧)的截屏、模糊计算和显示。使用GPUImage每秒中处理60张图片(模糊并显示图片)一点问题都没有。</p>

<p>真正棘手的问题是什么呢？如何实时的截取屏幕图片，信不信由你！</p>

<p>由于截取的屏幕是主用户界面，所有必须使用CPU的主线程来截屏，并将其转换为一幅图片。</p>

<p>提醒：如果事物每秒钟的变化速度在46帧以上，那么人眼就无法识别出来了。这对于开发者来说也是一种解脱——现代处理器在各帧之间可以完成更多的大量工作。</p>

<p><div class="entry-content"><h3>线程中简洁的分支</h3></p>

<p>当运行程序时，会执行大量的指令列表。每一个指令列表都运行在各自的线程中，而我们又可以在多个线程中并发运行各自的指令列表。一个程序在主线程中 开始运行，然后会根据需要，创建新的线程，并在后台执行线程。如果之前你并没有管理过多线程，你可能在写程序的时候总是在主线程中执行指令。</p>

<p>主线程主要处理与用户的交互，以及界面的更新。确保主线程的响应时间是非常关键的。如果在主线程上做了太多的任务，你会明显的感觉到主界面响应迟钝。</p>

<p>如果你曾经使用过Twitter货Facebook，并滚动操作过它里面的内容，你可能已经感觉到后台线程在执行操作了——在滚动的过程中，并不是所有的个人图片立即显示出来，滚动过程中，程序会启动后台线程来获取图片，当图片获取成功之后，再显示到屏幕中。</p>

<p>如果不使用后台线程，那么table view的滚动过程中，如果在主线程上去获取个人图片，会感觉到table view被冻结住了。由于图片的获取需要一些时间，所以最好将这样耗时的操作让后台线程来做，这样就能对用户界面做平滑的操作和响应了。</p>

<p>那么对本文的程序有什么影响呢？之间介绍了，UIView的截屏APIs操作必须在主线程中运行。这就意味着每次截屏时，整个用户界面都会被冻结中。</p>

<p>对于静态模糊效果时，由于这个截屏操作很快，你不会感觉到界面的冻结。并且只需要截屏一次。然而在实时模糊效果中需要每秒中截屏60次。如果在主线程中做这样频繁的截屏操作，那么animation和transition会变得非常的迟钝。</p>

<p>更糟糕的时，如果用户界面复杂度增加，那么在截屏过程中就需要消耗更多的时间，那么就会导致整个程序无法使用了！</p>

<p>那么怎么办呢！
<div class="entry-content"><h3>一些潜在的实时模糊方案</h3></p>

<p>这里有一个关于实时模糊方案：源代码开源的<a href="https://github.com/nicklockwood/FXBlurView">live blur libraries</a>，它通过降低截屏的速度来实现实时模糊效果，并不是使用每秒截屏60次，可能是20、30或者40次。即使看起来没有多大区别，但是你的眼睛还是能发现一定的迟钝——模糊效果并没有跟程序的其它部分同步起来——这样一来，界面看起会没有模糊效果更加的糟糕。</p>

<p>实际上苹果在它们自己的一些程序中处理实时模糊并不存在类似的问题——但是苹果并没有公开相关的API。在iOS 7中UIView的截屏方法，相比于旧方法，性能有了很大的提升，但还是不能满足实时模糊的需求。</p>

<p>一些开发者利用UIToolbar的模糊效果来做一些不好的操作。没错，这是有效果的，但是强烈建议不要在程序中使用它们。虽然这不是私有API，但是这并不算是一种可行的方法，苹果也可能会reject你的程序。也就是说在，在之后的iOS 7版本中，并不能保证还能正常使用。</p>

<p>苹果可以在任何时候对UIToolBar做出修改，或许你的程序就有问题了。在iOS 7.0.3更新中，苹果的修改已经影响到UIToolbar和UINavigationBar了，有些开发者也因此报告出利用相关模糊效果已经失效了！所以最好不要陷入这样潜在的陷阱里面！</p>

<p><div class="entry-content"><h3>一个折中的方法——对视频实时模糊</h3></p>

<p>OK，此时你可能在想，要想在程序中做到实时模糊是不可能的了。那么还有什么方法可以突破限制，做到实时模糊效果呢？</p>

<p>在许多场景中，静态模糊是可以接受的。上一节中，我们对view做适当的修改，让用户看起来是对背景图做的实际模糊处理。当然，这对于静止不动的背景是合适的，并且还可以在模糊背景上实现一些不错的效果。</p>

<p>我们可以做一些实验，看看能不能找到一些效果来实现之前无法做到的实时模糊效果呢？</p>

<p>有一个方法可以试试：对实时视频做模糊处理，虽然截屏是一个非常大的瓶颈，但是GPUImage非常的强大，它能够对视频进行模糊(无论是来自摄像头的视频或者已经录制好的视频，都没问题)。</p>

<p><div class="entry-content"><h3>利用GPUImage对视频进行模糊处理</h3></p>

<p>利用GPUImage对视频的模糊处理与图片的模糊处理类似。针对图片，我们实例化一个GPUImagePicture，然后将其发送给GPUImageiOSBlurFilter，接着再将其发送给GPUImageView。</p>

<p>类似的方法，对于视频，我们使用GPUImageVideoCamera或GPUImageMovie，将后将其发送给GPUImageiOSBlurFilter，接着再将其发送给一个GPUImageView。GPUImageVideoCamera用于设备中的实时摄像头，而GPUImageMovie用于已经录制好的视频。</p>

<p>在我们的starter工程中，已经实例化并配置好了GPUImageVideoCamera。现在的任务是将播放和录制按钮的灰色背景替换为视频的实时滤镜效果。</p>

<p>首先是将此处提供的灰色背景实例UIView替换为GPUImageView。完成之后，我们需要调整每个view的contentRect(基于view的frame)。</p>

<p>这听起来对每个view都需要做大量的工作。为了让任务变得简单，我们创建一个GPUImageView的子类，并把自定义的代码放进去，以便重用。</p>

<p>打开File/New/File…，然后选择iOS/Cocoa Touch/Objective-C class，如下所示：</p>

<p><img src="http://cdn3.raywenderlich.com/wp-content/uploads/2013/12/NewClass.png"></p>

<p>将类命名为BlurView，继承自GPUImageView，如下图所示：</p>

<p><img src="http://cdn5.raywenderlich.com/wp-content/uploads/2014/01/Screen-Shot-2014-01-27-at-21.20.01-700x474.png"></p>

<p>打开ViewController.m文件，将下面的import添加到文件顶部：</p>

<pre><code>#import "BlurView.h" 
</code></pre>

<p>还是在ViewController.m中，在@implementation中找到<em>recordView和</em>controlView的声明，将其修改为BlurView类型，如下所示：</p>

<pre><code>BlurView *_recordView; //Update this! 
UIButton *_recordButton; 
BOOL _recording; 

BlurView *_controlView; //Update this too! 
UIButton *_controlButton; 
BOOL _playing; 
</code></pre>

<p>然后按照如下代码修改viewDidLoad方法：</p>

<pre><code>_recordView = [[BlurView alloc] initWithFrame: 
                CGRectMake(self.view.frame.size.height/2 - 50, 250, 110, 60)]; //Update this! 
//_recordView.backgroundColor = [UIColor grayColor]; //Delete this! 

_recordButton = [UIButton buttonWithType:UIButtonTypeCustom]; 
_recordButton.frame = CGRectMake(5, 5, 100, 50); 
[_recordButton setTitle:@"Record" forState:UIControlStateNormal]; 
[_recordButton setTitleColor:[UIColor redColor] forState:UIControlStateNormal]; 
[_recordButton setImage:[UIImage imageNamed:@"RecordDot.png"] forState:UIControlStateNormal] ; 
[_recordButton addTarget:self 
                  action:@selector(recordVideo) 
        forControlEvents:UIControlEventTouchUpInside]; 

[_recordView addSubview:_recordButton]; 
_recording = NO; 

_recordView.hidden = YES; 
[self.view addSubview:_recordView]; 


_controlView = [[BlurView alloc] initWithFrame: 
                 CGRectMake(self.view.frame.size.height/2 - 40, 230, 80, 80)]; //Update this! 
//_controlView.backgroundColor = [UIColor grayColor]; //Delete this! 
</code></pre>

<p>接着，需要创建模糊图片，将其显示到上面构建的image view中。回到@implementation中，将下面的两个声明添加进去：</p>

<pre><code>GPUImageiOSBlurFilter *_blurFilter; 
GPUImageBuffer *_videoBuffer; 
</code></pre>

<p>现在你已经知道GPUImageiOSBlurFilter的作用了，那么GPUImageBuffer的作用是什么呢？它的任务是获取视频的输出，并获取每一帧，这样我们就可以方便的对其做模糊处理。一个额外的好处就是它可以提升程序的性能！</p>

<p>一般来说，视频输出的内容会通过模糊滤镜处理，然后发送到背景视图中(被显示出来)。不过，在这里使用buffer的话，发送到buffer的视频输出内容，会被分为背景视图和模糊滤镜。这样可以对视频的输出显示做到平滑处理。</p>

<p>将下面的代码添加到viewDidLoad方法的顶部(在super调用的后面)：</p>

<pre><code>_blurFilter = [[GPUImageiOSBlurFilter alloc] init]; 

_videoBuffer = [[GPUImageBuffer alloc] init]; 
[_videoBuffer setBufferSize:1]; 
</code></pre>

<p>还是在同一个文件中，将如下高亮显示的语句添加到useLiveCamera方法中：</p>

<pre><code>-(void)useLiveCamera 
{ 
    if (![UIImagePickerController isSourceTypeAvailable: UIImagePickerControllerSourceTypeCamera]) { 
        UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@"No camera detected" 
                                                        message:@"The current device has no camera" 
                                                       delegate:self 
                                              cancelButtonTitle:@"Ok" 
                                              otherButtonTitles:nil]; 
        [alert show]; 
        return; 
    } 

    _liveVideo = [[GPUImageVideoCamera alloc] initWithSessionPreset:AVCaptureSessionPreset1280x720 
                                                     cameraPosition:AVCaptureDevicePositionBack]; 
    _liveVideo.outputImageOrientation = UIInterfaceOrientationLandscapeLeft; 

    [_liveVideo addTarget:_videoBuffer];           //Update this 
    [_videoBuffer addTarget:_backgroundImageView]; //Add this 
    [_videoBuffer addTarget:_blurFilter];          //And this 
    [_blurFilter addTarget:_recordView];           //And finally this 

    [_liveVideo startCameraCapture]; 

    _recordView.hidden = NO; 
    _controlView.hidden = YES; 
} 
</code></pre>

<p>上面的模糊背景是用于录制按钮的。对于播放按钮也要做类似的处理。</p>

<p>将下面的代码添加到loadVideoWithURL:方法中(在_recordedVideo.playAtActualSpeed = YES;之后)：</p>

<pre><code>[_recordedVideo addTarget:_videoBuffer]; 
[_videoBuffer addTarget:_backgroundImageView]; 
[_videoBuffer addTarget:_blurFilter]; 
[_blurFilter addTarget:_controlView]; 
</code></pre>

<p>编译并运行程序，打开录制操作，看看情况如何：</p>

<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2013/12/FullImageButton.png"></p>

<p>好消息是看起来基本正常！坏消息是整个屏幕被缩放到录制按钮中去了。这个问题跟之前遇到的类似。我们需要给BlurView这是适当的contentRect。</p>

<p>打开BlurView.m，用下面的代码替换掉initWithFrame:方法：</p>

<pre><code>- (id)initWithFrame:(CGRect)frame 
{ 
    self = [super initWithFrame:frame]; 
    if (self) { 
        CGRect deviceSize = [UIScreen mainScreen].bounds; 
        self.layer.contentsRect = CGRectMake(frame.origin.x/deviceSize.size.height, 
                                             frame.origin.y/deviceSize.size.width, 
                                             frame.size.width/deviceSize.size.height, 
                                             frame.size.height/deviceSize.size.width); 
        self.fillMode = kGPUImageFillModeStretch; 
    } 
    return self; 
} 
</code></pre>

<p>contentRect的每个参数必须在0.0f和1.0f之间。在这里只需要利用view的位置除以屏幕的size，得到的值即可。</p>

<p>编译并运行程序，看看效果如何：</p>

<p><img src="http://cdn2.raywenderlich.com/wp-content/uploads/2013/12/FinishedBlur.png"></p>

<p>恭喜！至此已经完成了静态模糊和实时视频模糊的实现。现在你已经完全可以在程序中添加iOS 7的模糊效果啦！</p>

<p><div class="entry-content"><h3>利何去何从？</h3></p>

<p>可以在<a href="https://github.com/worldligang/Video-Blurring-Final.git">这里</a>下载到完整的工程。</p>

<p>本文译自<a href="http://www.raywenderlich.com/60968/ios-7-blur-effects-gpuimage">iOS 7 Blur Effects with GPUImage.</a></p>

<p>本文不仅指导你在程序中使用iOS 7的模糊效果，还介绍了如何使用GPUImage框架，这个框架也是我非常希望你能看到的东西。重要的是，本文指出了为什么要使用模糊，什么时候使用模糊效果是合适的，这在iOS 7的新设计语言中是一个关键的概念。当然也希望在未来的版本中，苹果能够将相关APIs提供给开发者使用，不过在那之前，GPUImage是一个不错的替代品。</p>

<p>我的微信公众号：</p>

<pre><code>iOSDevTip
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/11">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/9">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>微信扫一扫，代码写的好</h1>
        <br/>
        <br/><strong>东半球最好的iOS开发公众号</strong> 
        <br/>
        <br/><img width="220px" src="http://www.superqq.com/images/getqrcode.jpg" />
        <br/>
        <br/><strong>东半球最好的程序猿公众号</strong>
        <br/>
        <br/><img width="220px" src="http://www.superqq.com/images/CodePush.jpg" />
        </p>
<!--广告位-->
<script type="text/javascript">
var cpro_id="u2238881";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"250",rsi1:"250",pat:"17",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
<!--广告链接结束-->
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/08/05/multiple-uiimage-merged/">多个UIImage合并成一个UIImage</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/04/save-photo-to-own-album/">iOS开发之保存照片到自己创建的相簿</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/03/ioskai-fa-zhi-bao-cun-zhao-pian-dao-xi-tong-xiang-ce-(photo-album)/">iOS开发之保存照片到系统相册（Photo Album）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/02/custom-navigation-button-uibarbuttonitem/">自定义导航按钮UIBarButtonItem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/02/first-watch-movie/">《大圣归来》和《捉妖记》第一次购票看电影</a>
      </li>
    
  </ul>
</section>
</section>
<section>
    <h1>About Me</h1>
    <br/>
    <p> 李刚：百度百家专栏作者，刚刚在线站长，iOS工程师非著名自媒体人，微信公众号iOS开发：iOSDevTip运营者<br/>
    <br/><strong>出师未捷名已落</strong>
    <br/>
    <br/>新浪微博: <a href='http://weibo.com/ligangnc' target='_blank'>李刚移动</a>
    <br/>
    <br/>个人微信: <strong>chinaligang</strong> 欢迎调戏
    <br/>
    <br/>iOS群: <strong>218822587</strong>
  <br/>
</section>

   
 <section>
    <h1>友情链接</h1>
    <ul>
    
       <li>
           <a href="http://www.superqq.com" target="_blank" title=“刚刚在线”>刚刚在线</a>
       </li>
       <li>
           <a href="http://www.90159.com" target="_blank" title=“程序员头条”>程序员头条</a>
       </li>
       <li>
           <a href="http://www.iswifting.com" target="_blank" title=“swift开发”>swift开发</a>
       </li>
       <li>
           <a href="http://www.aswifter.com/" target="_blank" title="APP开发者">APP开发者</a>
       </li>
        <li>
           <a href="http://www.boxingjiaoyu.com/" target="_blank" title="程序员聚合平台">程序员聚合平台</a>
       </li>
      <li>
           <a href="http://www.mobile-open.com/" target="_blank" title="阳和移动开发">阳和移动开发</a>
       </li>
       <li>
           <a href="http://www.jq-school.com/" target="_blank" title="jquery教程">jquery教程</a>
       </li>
        <li>
           <a href="http://www.admin10000.com/" target="_blank" title="WEB开发者">WEB开发者</a>
       </li>
       <li>
           <a href="http://www.aichengxu.com/" target="_blank" title="爱程序网">爱程序网</a>
       </li>
       <li>
           <a href="http://www.lai18.com" target="_blank" title="IT技术文章">IT技术文章</a>
       </li>
       <li>
           <a href="http://www.cftea.com/" target="_blank" title="千一网络">千一网络</a>
       </li>
        <li>
           <a href="http://www.bmob.cn/" target="_blank" title="Bmob">Bmob移动后端云</a>
       </li>
       <li>
           <a href="http://www.leichunfeng.com" target="_blank" title="雷纯锋的技术博客">雷纯锋的技术博客</a>
       </li>
       <li>
           <a href="http://cuiqingcai.com/" target="_blank" title="静觅">静觅</a>
       </li>
       <li>
           <a href="http://letsswift.com/" target="_blank" title="一起Swift">一起Swift</a>
       </li>
       <li>
           <a href="http://www.swiftv.cn/" target="_blank" title="SwiftV课堂">SwiftV课堂</a>
       </li>
        <li>
            <a href="http://blog.csdn.net/iosdevtip" target="_blank" title="刚刚在线">CSDN</a>
        </li>
        <li>
            <a href="http://user.qzone.qq.com/1606535851" target="_blank" title="刚刚在线">QQ空间</a>
        </li>
        <li>
            <br/><strong>交换友链：</strong>欢迎各大程序员站点交换友情链接，如需交换，请添加好本站链接后发送邮件至下方邮箱。
            <br/>
            <br/><strong>格式：</strong>（ 友链文字：“ 刚刚在线 ”，链接：“ http://www.superqq.com/ ” ）
            <br/>
            <br/><strong>邮箱：</strong>worldligang@163.com
            <br/>
        </li>
    </ul>
<br/>
<h1>热门推荐</h1>
<!--广告位-->
<script type="text/javascript">
var cpro_id="u2240614";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"250",rsi1:"350",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
<!--广告链接结束-->
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
Copyright &copy; 2015 - 李刚 
<span class="credit">Powered by <a href="http://octopress.org" target="_blank">Octopress</a></span>
 <span class="credit">, 感谢 <a href="http://gitcafe.com/signup?invited_by=tangqiaoboy" target="_blank">GitCafe</a> 为本站提供存储空间</span>

</p>

<script language="javascript" type="text/javascript" src="http://js.users.51.la/17443209.js"></script>
<noscript><a href="http://www.51.la/?17443209" target="_blank"><img alt="&#x6211;&#x8981;&#x5566;&#x514D;&#x8D39;&#x7EDF;&#x8BA1;" src="http://img.users.51.la/17443209.asp" style="border:none" /></a></noscript>
<!--广告位-->
<dic class="flashnews">
    <script type="text/javascript">
        /*960*60 创建于 2015-06-05*/
        var cpro_id = "u2140429";
        </script>
    <script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
    </div>
<!--广告链接结束--></footer>
  











</body>
</html>
