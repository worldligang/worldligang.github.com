<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: æ¨è | åˆšåˆšåœ¨çº¿]]></title>
  <link href="http://www.superqq.com/blog/categories/tui-jian/atom.xml" rel="self"/>
  <link href="http://www.superqq.com/"/>
  <updated>2015-08-23T11:51:14+08:00</updated>
  <id>http://www.superqq.com/</id>
  <author>
    <name><![CDATA[æåˆš]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ä¸€å¥ä»£ç æ·»åŠ æ–°æµªå¼¹å‡ºæ¡†åŠ¨ç”»]]></title>
    <link href="http://www.superqq.com/blog/2015/08/21/sina-animation/"/>
    <updated>2015-08-21T11:16:07+08:00</updated>
    <id>http://www.superqq.com/blog/2015/08/21/sina-animation</id>
    <content type="html"><![CDATA[<p>æ–°æµªå¾®åšä¸­çš„â€œåŠ å·æŒ‰é’®â€ç‚¹å‡»åçš„å¼¹å‡ºåŠ¨ç”»å¾ˆæœ‰æ„æ€ï¼Œæ¯å½“ä¸€ä¸ªäººå­¤å•å¯‚å¯å†·çš„æ—¶å€™æ€»ä¼šä¸åœçš„ç‚¹è¿™ä¸ªåŠ¨ç”»ï¼Œç»ˆäºå¿ä¸ä½è‡ªå·±æ’¸äº†ä¸€ä¸ªã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šæ•ˆæœå›¾ï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation1.gif" alt="æ¼”ç¤º1" /></p>

<p>é¦–å…ˆè¯´ä¸€ä¸‹é€šè¿‡è¿™ä¸ªåŠ¨ç”»åˆ¶ä½œè¿‡ç¨‹ç»™å¤§å®¶åˆ†äº«çš„æŠ€æœ¯é—®é¢˜ï¼š
1.èƒŒæ™¯çš„æ¯›ç»ç’ƒæ•ˆæœ
2.å¼¹æ€§åŠ¨ç”»
3.åŠ¨ç”»è¿›è¡Œæ—¶å¯¹ç”¨æˆ·äº¤äº’çš„å¤„ç†
4.<code>UIControl</code> çš„ <code>event</code> ç±»å‹</p>

<h2>ä¸€ã€èƒŒæ™¯çš„æ¯›ç»ç’ƒæ•ˆæœ</h2>

<p>å¯¹æ–°æµªå¾®åšä¸­å¼¹å‡ºåŠ¨ç”»èƒŒæ™¯çš„æ€è·¯åˆ†æï¼š</p>

<p>  æ–°æµªçš„èƒŒæ™¯åŠ¨ç”»æ•ˆæœæ˜¯æœ‰ä¸€ä¸ªé€æ˜æ¸å˜çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”æœ€ç»ˆæ¸å˜åœæ­¢ä¹‹åæ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªå¸¦æœ‰æ¯›ç»ç’ƒï¼ˆåŠé€æ˜æ¨¡ç³Šï¼‰æ•ˆæœçš„è§†å›¾ã€‚æˆ‘çš„æ¨¡ä»¿æ€è·¯æ˜¯å½“å‡†å¤‡è¦å¼¹å‡ºåŠ¨ç”»çš„æ—¶å€™å¯¹æ•´ä¸ªè§†å›¾è¿›è¡Œæˆªå±æ“ä½œï¼Œå°†æˆªå±åçš„å›¾ç‰‡è¿›è¡Œæ¯›ç»ç’ƒæ•ˆæœæ¸²æŸ“ï¼Œç„¶ååœ¨è§†å›¾ä¸ŠåŠ ä¸€ä¸ªèƒŒæ™¯ <code>UIImageView</code> æ¥æ˜¾ç¤ºè¿™å¼ å›¾ç‰‡ï¼Œç„¶åé€šè¿‡ <code>alpha</code> åŠ¨ç”»æ¥ç”±é€æ˜é€æ¸æ¸å˜å‡ºæ¥ã€‚</p>

<h3>1.å¯¹è§†å›¾è¿›è¡Œæˆªå±ï¼š</h3>

<pre><code>    UIGraphics BeginImageContextWithOptions(size, NO, scale);
    [view.layer renderInContext:UIGraphicsGetCurrentContext()];
    UIImage * image = UIGraphicsGetImageFromCurrentImageContext();
</code></pre>

<h3>2.æˆªå±ååŠ ä¸Šæ¯›ç»ç’ƒæ•ˆæœï¼š</h3>

<p>åˆ¶ä½œæ¯›ç»ç’ƒæ•ˆæœæœ‰ä¸‰ç§é€‰æ‹©ï¼Œä¸€æ˜¯ <code>iOS8</code> åæ¨å‡ºçš„ <code>UIBlurEffect</code> å’Œ <code>UIVisualEffectView</code> æ¥ç›´æ¥æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ¯›ç»ç’ƒæ•ˆæœçš„ <code>View</code> ä¸è¿‡è¿™ç§æ–¹å¼å¹¶ä¸èƒ½ç›´æ¥ç”Ÿæˆä¸€å¼ å¸¦æœ‰æ¯›ç»ç’ƒæ•ˆæœçš„å›¾ç‰‡ï¼Œè€Œä¸”å®ƒçš„æ¨¡ç³Šç¨‹åº¦è®¾ç½®æ–¹æ³•éå¸¸æœ‰é™åªæœ‰é‚£å‡ ä¸ªæšä¸¾ç±»å‹ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p>

<p>ç¬¬äºŒç§æ˜¯é€šè¿‡ <code>CoreImage</code> æ·»åŠ æ»¤é•œçš„æ–¹å¼æ¥å®ç°æ¯›ç»ç’ƒæ•ˆæœï¼Œä¸è¿‡è¿™ç§æ–¹å¼æœ‰ä¸ªç¼ºç‚¹å¦‚æœæ»¤é•œä½¿ç”¨é¢‘ç¹ä¼šå¯¹ä¸»çº¿ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚æœæˆ‘ä¸æ–­é¢‘ç¹çš„é‡å¤åŠ¨ç”»æ•ˆæœå°±å¿…é¡»è¦åšåˆ¤æ–­çœ‹æ»¤é•œæ˜¯å¦æ­£åœ¨èµ·ä½œç”¨ï¼Œå¦åˆ™ä¼šç»å¸¸å‡ºç°å´©æºƒå’Œå†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>

<p>ç¬¬ä¸‰ç§æˆ‘ä»¬ä½¿ç”¨è‹¹æœ13å¹´ <code>WWDC</code> ä¸Šå‘å¸ƒçš„å®˜æ–¹ <code>sample</code> ä¸€ä¸ª <code>UIImage</code> çš„åˆ†ç±» <code>UIImage+ImageEffects.h</code> ,å®ƒä¸ä½†å¯ä»¥åˆ¶ä½œæ¯›ç»ç’ƒæ•ˆæœå›¾ç‰‡ï¼Œè€Œä¸”å¯ä»¥è°ƒæ•´æ¨¡ç³Šç¨‹åº¦å’Œé¢œè‰²æ¸²æŸ“ã€‚ä¸‹é¢ç»™å‡ºä»£ç ï¼š</p>

<pre><code>    image = [image bhb_applyBlurWithRadius:15 
                                 tintColor:tintColor 
                     saturationDeltaFactor:1 
                                 maskImage:nil];//å› ä¸ºOCæ²¡æœ‰å‘½åç©ºé—´ï¼Œé¿å…ä½ çš„ç¨‹åºä¸­ä½¿ç”¨åˆ°äº†è¿™ä¸ªåˆ†ç±»å¯¼è‡´å†²çªï¼Œæˆ‘åŠ äº†å‰ç¼€
</code></pre>

<p>æœ€ç»ˆçš„æ˜¾ç¤ºæ•ˆæœå¾ˆä¸é”™ï¼Œæˆ‘å°†æ¨¡ç³Šç¨‹åº¦å°½é‡çš„è°ƒèŠ‚åˆ°ä¸æ–°æµªå¾®åšä¸€è‡´äº†ï¼Œä¸è¿‡åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°å½“æˆ‘é¢‘ç¹çš„è¿›è¡Œå¼¹å‡ºæ“ä½œæ—¶ï¼Œå†…å­˜ä¼šä¸æ–­æ”€å‡å¦‚ä¸‹å›¾ï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation3.png" alt="æ¼”ç¤º3" />
å†…å­˜æš´å¢çš„åŸå› è‚¯å®šæ˜¯å› ä¸ºåˆšæ‰çš„æˆªå›¾æˆ–è€…æ¯›ç»ç’ƒæ•ˆæœå¯¼è‡´çš„ï¼Œæˆ‘ä»¬æ¥ç”¨ <code>Instruments</code> çš„ <code>Allocations</code> æ¥è¿›è¡Œå†…å­˜åˆ†æï¼Œæ‰¾å‡ºå…ƒå‡¶ã€‚
Xcode -> Product -> Profile -> Allocationsï¼Œ å¼€å¯ä¹‹åæˆ‘ä»¬æ¥ä½¿ç”¨å³ä¸‹è§’çš„ <code>Mark generation</code>ï¼ˆå†…å­˜å¿«ç…§åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥äº†è§£è¯·ç§»æ­¥[è¿™ç‰‡æ–‡ç« ][1]ï¼‰
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation4.png" alt="æ¼”ç¤º4" />
åœ¨å¼¹å‡º <code>View</code> å’Œç§»é™¤ <code>View</code> çš„ä¸¤ä¸ªæ—¶é—´ç‚¹åŠ  <code>Mark generation</code>ã€‚
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation5.png" alt="æ¼”ç¤º5" />
å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œä¸¤ä¸ªæ—¶é—´ç‚¹ç«Ÿç„¶ç›¸å·®äº†4.31Mï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“ææ€–çš„æ•°å­—ï¼Œæ€ªä¸å¾—æˆ‘ç‚¹å‡»å‡ æ¬¡å¼¹å‡ºåŠŸèƒ½ä¹‹åå†…å­˜ä¼šæš´å¢ï¼Œè®©æˆ‘ä»¬ç»§ç»­è·Ÿè¸ªï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation6.png" alt="æ¼”ç¤º6" />
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation7.png" alt="æ¼”ç¤º7" />
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation8.png" alt="æ¼”ç¤º8" />
è·Ÿè¸ªåˆ°æœ€åï¼Œæˆ‘ä»¬å‘ç°å¤§éƒ¨åˆ†æœªé‡Šæ”¾çš„å†…å­˜æ¥è‡ªäºç»˜å›¾å’Œä½å›¾çš„åˆ›å»ºï¼Œå›æƒ³æˆ‘ä»¬å½“åˆåšçš„æˆªå›¾æ“ä½œï¼Œå›¾ç‰‡ä¸Šä¸‹æ–‡å¼€å¯åå¹¶æ²¡æœ‰è¿›è¡Œå…³é—­æ“ä½œï¼Œæ‰€ä»¥åœ¨ç¨‹åºä¸æ–­æˆªå›¾çš„è¿‡ç¨‹ä¸­å¼€å¯äº†æ— æ•°çš„å›¾ç‰‡ä¸Šä¸‹æ–‡è€Œä¸”ä¸ä¼šè¢«é‡Šæ”¾ï¼Œæ·»åŠ ä¸‹é¢è¿™å¥å…³é”®çš„ä»£ç å°±å¯ä»¥è§£å†³é—®é¢˜ï¼ˆNCçš„æˆ‘ç«Ÿç„¶è¿è¿™ä¸ªéƒ½å¿˜äº†åŠ -.-ï¼‰ï¼š</p>

<pre><code>        UIGraphicsEndImageContext();
</code></pre>

<h2>äºŒã€å¼¹æ€§åŠ¨ç”»</h2>

<p>æ–°æµªåŠ¨ç”»ä¸­ï¼ŒæŒ‰é’®å¼¹å‡ºçš„åŠ¨ç”»ä¸ºå¼¹æ€§æ•ˆæœï¼ŒæŒ‰é’®åˆ°è¾¾æœ€ç»ˆä½ç½®åä¸ä¼šç›´æ¥åœæ­¢ï¼Œè€Œæ˜¯åšç±»ä¼¼å¼¹ç°§çš„ä¸€ç§é˜»å°¼è¿åŠ¨ï¼Œè¦å®ç°è¿™ç§åŠ¨ç”»ä¹Ÿå¾ˆç®€å• <code>iOS7</code> åè‹¹æœéå¸¸ç»™åŠ›çš„æ·»åŠ äº† <code>spring</code> å¼¹æ€§åŠ¨ç”»çš„å¿«é€Ÿåˆ›å»ºæ–¹å¼ï¼š</p>

<pre><code>    [UIView animateWithDuration:(NSTimeInterval) 
                          delay:(NSTimeInterval) 
         usingSpringWithDamping:(CGFloat) 
          initialSpringVelocity:(CGFloat) 
                        options:(UIViewAnimationOptions) 
                     animations:^{} 
                     completion:^(BOOL finished) {}];
</code></pre>

<p>é€šè¿‡å¯¹ <code>Damping</code> é˜»åŠ›å’Œ <code>Velocity</code> åˆé€Ÿåº¦çš„è®¾ç½®å¯ä»¥å®ç°å¼¹æ€§åŠ¨ç”»åŠ¨ç”»æ•ˆæœå¦‚ä¸‹å›¾ï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/threeballs.gif" alt="æ‘˜è‡ªMotionDesign" /></p>

<p>å½“ç„¶å®ç°å¼¹æ€§åŠ¨ç”»è¿˜å¯ä»¥ä½¿ç”¨[Jonathan Willing][2]å¤§å¤§çš„ <code>JNWSpringAnimation</code> ,ä½ å¯ä»¥åƒä½¿ç”¨ <code>CABasicAnimation</code> ä¸€æ ·è½»æ¾çš„ä½¿ç”¨å®ƒï¼Œé€šè¿‡æ”¹å˜å…³é”®çš„3ä¸ªå±æ€§ <code>Damping</code> é˜»åŠ›ï¼Œ <code>stiffness</code> ç¡¬ç›´, <code>mass</code> è´¨é‡æ¥æ”¹å˜å¼¹æ€§åŠ¨ç”»çš„æ•ˆæœä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>    JNWSpringAnimation *scale = [JNWSpringAnimation
    animationWithKeyPath:@"transform.translation.x"];
    scale.damping = 7;
    scale.stiffness = 7;
    scale.mass = 1;

    scale.fromValue = @(0);
    scale.toValue = @(400);

    [redBall.layer addAnimation:scale forKey:scale.keyPath];
    redBall.transform = CGAffineTransformMakeTranslation(400, 0);
</code></pre>

<p>å…³é”®çš„ä¸‰ä¸ªå±æ€§å¯¹åŠ¨ç”»çš„å½±å“å¦‚ä¸‹å›¾ï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/jnwdemo.gif" alt="æ‘˜è‡ªMotionDesign" /></p>

<p>ä¸ºäº†å‡è½»é¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹æ¡†æ¶çš„ä¾èµ–ï¼Œæˆ‘ä½¿ç”¨äº† <code>iOS7</code> åŸç”Ÿçš„ <code>spring</code> åŠ¨ç”»ï¼Œå¦‚æœä½ æƒ³è¦å…¼å®¹ä»¥å‰ç‰ˆæœ¬ï¼Œæ›¿æ¢æˆ <code>JNWSpringAnimation</code> å³å¯ã€‚å›åˆ°æ–°æµªåŠ¨ç”»çš„åˆ¶ä½œï¼ŒåŠ¨ç”»æ˜¯6ä¸ªæŒ‰é’®æŒ‰ç…§é¡ºåºä¾æ¬¡å‡ºç°å’Œæ¶ˆå¤±ï¼Œå¹¶ä¸”ç‚¹å‡» <code>more</code> æŒ‰é’®åå¯ä»¥å‘å·¦å¹³ç§»åˆ°ç¬¬äºŒå±å¹•ï¼Œå¹¶ä¸”åœ¨ç¬¬äºŒå±å¹•ç‚¹å‡» <code>å‰å·</code> æŒ‰é’®åŠ¨ç”»ä¼šåŠ åœ¨ç¬¬äºŒå±å¹•çš„6ä¸ªæŒ‰é’®ä¸Šã€‚
æ•ˆæœå¦‚å›¾ï¼š
<img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation2.gif" alt="æ¼”ç¤º2" /></p>

<p>å¯¹æ­¤æˆ‘ä½¿ç”¨äº†ä¸€ä¸ª <code>UIScrollView</code> æ¥æ‰¿è½½è¿™äº›æŒ‰é’®ï¼Œå¹¶å£°æ˜2ä¸ªæ•°ç»„ç”¨æ¥ä¿å­˜æ‰€æœ‰çš„æŒ‰é’®å’Œæ­£åœ¨æ˜¾ç¤ºçš„æŒ‰é’®ï¼ˆåœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”éœ€è¦åšåŠ¨ç”»ï¼‰:</p>

<pre><code>    @property (nonatomic,strong) NSMutableArray * visableArray;//å±å¹•æ˜¾ç¤ºçš„æŒ‰é’®æ•°ç»„
    @property (nonatomic,strong) NSMutableArray * itemsArray;//æ‰€æœ‰æŒ‰é’®çš„æ•°ç»„
</code></pre>

<p>è¿™æ ·æˆ‘åœ¨ç»™è¿™äº›æŒ‰é’®åŠ åŠ¨ç”»çš„æ—¶å€™å°±ä¸ä¼šæµªè´¹æ€§èƒ½ï¼ŒåªæŠŠåŠ¨ç”»åŠ åœ¨å½“å‰æ˜¾ç¤ºåœ¨å±å¹•çš„æŒ‰é’®ä¸Šã€‚åŠ¨ç”»ä¾æ¬¡æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å·®æ¥æ‰§è¡Œï¼Œè§£å†³çš„åŠæ³•æˆ‘æ˜¯ç”¨çš„ <code>GCD</code> :</p>

<pre><code>    [self.visableArray enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) {
        BHBCustomBtn * btn = obj;
        CGFloat x = btn.frame.origin.x;
        CGFloat y = btn.frame.origin.y;
        CGFloat width = btn.frame.size.width;
        CGFloat height = btn.frame.size.height;
        btn.frame = CGRectMake(x, [UIScreen mainScreen].bounds.size.height + y - self.frame.origin.y, width, height);
        btn.alpha = 0.0;
        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(idx * 0.03 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
            [UIView animateWithDuration:0.35 delay:0 usingSpringWithDamping:0.85 initialSpringVelocity:25 options:UIViewAnimationOptionCurveEaseIn animations:^{
                btn.alpha = 1;
                btn.frame = CGRectMake(x, y, width, height);
            } completion:^(BOOL finished) {
                if ([btn isEqual:[self.visableArray lastObject]]) {
                    self.superview.superview.userInteractionEnabled = YES;
                }
            }];
        });
    }];
</code></pre>

<p>è¿™æ ·æŒ‰é’®å°±ä¼šä¾æ¬¡ä»¥å¼¹æ€§åŠ¨ç”»çš„å½¢å¼å¼¹åŠ¨å‡ºæ¥äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå¯¹äºåŠ¨ç”»ç»“æŸåæ‰€ä½œçš„å¤„ç†æˆ‘å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è¯´æ˜ã€‚</p>

<h2>ä¸‰ã€åŠ¨ç”»è¿›è¡Œæ—¶å¯¹ç”¨æˆ·äº¤äº’çš„å¤„ç†</h2>

<p>åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’çš„é—®é¢˜ç›¸å½“å…³é”®ï¼Œè§†å›¾åŠ¨ç”»ä¸­é»˜è®¤è‡ªåŠ¨åœæ­¢å“åº”ç”¨æˆ·äº¤äº’ï¼Œå› æ­¤å½“æŒ‰é’®è¿›è¡Œå¼¹æ€§åŠ¨ç”»æ—¶ï¼Œè§¦æ‘¸å®ƒå¹¶ä¸ä¼šç”Ÿæˆä»»ä½•äº‹ä»¶ã€‚
ä½†æ˜¯å½“ä½ è§¦æ‘¸åŠ å·æŒ‰é’®çš„æ—¶å€™ï¼Œä¼šå†æ¬¡è¿›è¡Œå¼¹å‡ºæ¡†åŠ¨ç”»ï¼Œè¿™æ—¶å°±ä¼šå¼¹å‡ºä¸¤ä¸ªå¼¹å‡ºæ¡†ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠ å·æŒ‰é’®çš„ <code>enable</code> å±æ€§è®¾ç½®ä¸º <code>YES</code> ä½†æ˜¯è¿™æ ·åšæˆ‘ä»¬è¦åœ¨å°è£…çš„è§†å›¾å†…éƒ¨è·å–å¤–éƒ¨çš„åŠ å·æŒ‰é’®ï¼Œè¿™ä¸€ç‚¹è¿èƒŒäº†å°è£…æ€§åŸåˆ™ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚æ‰€ä»¥æˆ‘åœ¨æ‰€æœ‰æŒ‰é’®çš„å¼¹æ€§åŠ¨ç”»å¼€å§‹æ—¶ï¼Œè®¾ç½®ï¼š</p>

<pre><code>    self.superview.superview.userInteractionEnabled = NO;
</code></pre>

<p>æ³¨æ„è§†å›¾çš„å±‚çº§å…³ç³»ï¼Œæˆ‘æ‰€è®¾è®¡çš„ <code>BHBPopView</code> å†…éƒ¨è£…ç€ä¸€ä¸ª <code>UIScrollView</code>ï¼Œè€Œå®ƒä¸Šé¢æ”¾ç€è¿™äº›æŒ‰é’®ï¼Œæ‰€ä»¥ä½ è¦æ‰¾åˆ°çˆ¶è§†å›¾çš„çˆ¶è§†å›¾æ‰èƒ½å¤Ÿç»Ÿä¸€å±è”½ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå½“æ‰€æœ‰çš„æŒ‰é’®å¼¹æ€§åŠ¨ç”»ç»“æŸæ—¶ï¼Œä¹Ÿå°±æ˜¯ <code>visableArray</code> æ•°ç»„æœ€åä¸€ä¸ªæŒ‰é’®åŠ¨ç”»ç»“æŸæ—¶ï¼Œæˆ‘ä»¬æ¢å¤ç”¨æˆ·çš„äº¤äº’ï¼š</p>

<pre><code>    self.superview.superview.userInteractionEnabled = YES;
</code></pre>

<p>è¿™æ ·å½“åŠ¨ç”»è¿›è¡Œè¿‡ç¨‹ä¸­ï¼Œå±è”½äº†ç”¨æˆ·çš„äº¤äº’ï¼Œé¿å…å‘ç”Ÿä¸€äº›æ„å¤–çš„æƒ…å†µã€‚</p>

<h2>å››ã€<code>UIControl</code> çš„ <code>event</code> ç±»å‹</h2>

<p>æ³¨æ„åˆ°æ–°æµªåŠ¨ç”»é‡Œé¢æŒ‰é’®æœ‰ä¸€ä¸ªæ”¾å¤§æ•ˆæœï¼Œå¹¶ä¸”å½“ä½ æ‰‹æŒ‡æ”¾ä¸Šå»çš„æ—¶å€™æ”¾å¤§ï¼Œæ‰‹æŒ‡ç¨å¾®æŒªåŠ¨ï¼Œä¾¿æ¢å¤åŸå§‹å¤§å°ã€‚è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åŠ¨ç”»ï¼š</p>

<p><img src="http://7xkdhe.com1.z0.glb.clouddn.com/sinaAnimation9.gif" alt="æ¼”ç¤º9" /></p>

<p>è¦å®ç°è¿™ä¸ªæ•ˆæœåªéœ€è¦åšä¸€ä¸ªå½¢å˜åŠ¨ç”»å°±å¯ä»¥äº†ï¼Œå…³é”®æ˜¯æˆ‘ä»¬å¦‚ä½•æ§åˆ¶å®ƒæ”¾å¤§å’Œæ¢å¤å¤§å°ã€‚
æ€è·¯å¦‚ä¸‹ï¼šæŒ‰é’®æ˜¯ç»§æ‰¿è‡ª <code>UIControl</code> ï¼Œ<code>UIControl</code> æœ‰ä¸åŒçš„äº‹ä»¶çŠ¶æ€ï¼š</p>

<pre><code>    UIControlEventTouchDown           = 1 &lt;&lt;  0,      // æ‰‹æŒ‡è½åœ¨æŒ‰é’®çš„ä¸€ç¬é—´è§¦å‘
    UIControlEventTouchDownRepeat     = 1 &lt;&lt;  1,      // å¤šç‚¹è§¦ç¢°çš„æ—¶å€™ï¼Œå½“ç¬¬äºŒæ ¹ä»¥ä¸Šçš„æ‰‹æŒ‡è§¦æ‘¸ç¬é—´å‡ºå‘
    UIControlEventTouchDragInside     = 1 &lt;&lt;  2,      // æ‰‹æŒ‡åœ¨è§†å›¾èŒƒå›´å†…æ‹–åŠ¨è§¦å‘
    UIControlEventTouchDragOutside    = 1 &lt;&lt;  3,      // æ‰‹æŒ‡åœ¨è§†å›¾èŒƒå›´å¤–æ‹–åŠ¨è§¦å‘
    UIControlEventTouchDragEnter      = 1 &lt;&lt;  4,      // æ‰‹æŒ‡ä»è§†å›¾å¤–æ‹–åŠ¨åˆ°è§†å›¾å†…æ—¶è§¦å‘
    UIControlEventTouchDragExit       = 1 &lt;&lt;  5,      // æ‰‹æŒ‡ä»è§†å›¾å†…éƒ¨æ‹–åŠ¨åˆ°è§†å›¾å¤–æ—¶è§¦å‘
    UIControlEventTouchUpInside       = 1 &lt;&lt;  6,      // æ‰‹æŒ‡åœ¨è§†å›¾å†…éƒ¨æŠ¬èµ·æ—¶è§¦å‘
    UIControlEventTouchUpOutside      = 1 &lt;&lt;  7,      // æ‰‹æŒ‡åœ¨è§†å›¾å¤–éƒ¨æŠ¬èµ·æ—¶è§¦å‘
    UIControlEventTouchCancel         = 1 &lt;&lt;  8,      // å–æ¶ˆäº‹ä»¶ï¼Œæ”¾ä¸Šäº†å¤ªå¤šæ‰‹æŒ‡æˆ–è€…è¢«ä¸Šé”æˆ–è€…ç”µè¯å‘¼å«æ‰“æ–­ã€‚

    UIControlEventValueChanged        = 1 &lt;&lt; 12,      // å½“è§†å›¾çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘é€é€šçŸ¥ã€‚

    UIControlEventEditingDidBegin     = 1 &lt;&lt; 16,     // UITextField
    UIControlEventEditingChanged      = 1 &lt;&lt; 17,
    UIControlEventEditingDidEnd       = 1 &lt;&lt; 18,
    UIControlEventEditingDidEndOnExit = 1 &lt;&lt; 19,     // 'return key' ending editing

    UIControlEventAllTouchEvents      = 0x00000FFF,  // for touch events
    UIControlEventAllEditingEvents    = 0x000F0000,  // for UITextField
    UIControlEventApplicationReserved = 0x0F000000,  // range available for application use
    UIControlEventSystemReserved      = 0xF0000000,  // range reserved for internal framework use
    UIControlEventAllEvents           = 0xFFFFFFFF
</code></pre>

<p>æˆ‘ä»¬æ‰€ç”¨åˆ°çš„äº‹ä»¶æ˜¯ <code>TouchDown</code> å’Œ <code>DragInside</code>ï¼Œæ‰‹æŒ‡æ”¾ä¸Šå»è§¦å‘ <code>TouchDown</code> æ”¾å¤§è§†å›¾ï¼Œåœ¨è§†å›¾å†…éƒ¨ç§»åŠ¨ <code>DragInside</code> æ—¶æ¢å¤è§†å›¾ï¼Œæ³¨æ„æŒ‰é’®çš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªçŸ©å½¢åŒºåŸŸåŒ…å«äº†å›¾ç‰‡å’Œæ–‡å­—ï¼Œå½“ä½ çš„æ‰‹æŒ‡ç§»å‡ºå›¾ç‰‡çš„æ—¶å€™å¹¶éä¸€å®šä¼šç§»å‡ºæŒ‰é’®ä½œç”¨èŒƒå›´ï¼Œæ‰€ä»¥ä¾ç„¶ä¼šè§¦å‘ <code>TouchUpInsite</code> äº‹ä»¶ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªå±æ€§æ¥è®°å½•ç”¨æˆ·æ‹–æ‹½ä¹‹åå–æ¶ˆæŒ‰é’®çš„ <code>TouchUpInsite</code> æ‰§è¡Œã€‚</p>

<pre><code>    @property (nonatomic,assign) BOOL btnCanceled;
</code></pre>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°åŠ¨ç”»æ•ˆæœäº†ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>    //å¤„ç†æŒ‰é’®æœ‰æ•ˆçš„ç‚¹å‡»äº‹ä»¶ï¼Œå½“å‰æŒ‰é’®æ”¾å¤§æ¶ˆå¤±ï¼Œå…¶ä»–æŒ‰é’®ç¼©å°æ¶ˆå¤±ï¼Œå›è°ƒç‚¹å‡»äº‹ä»¶
    [btn addTarget:self action:@selector(didClickBtn:) forControlEvents:UIControlEventTouchUpInside];
    //å¤„ç†æ‰‹æŒ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œæ”¾å¤§æŒ‰é’®
    [btn addTarget:self action:@selector(didTouchBtn:) forControlEvents:UIControlEventTouchDown];
    //å¤„ç†æ‰‹æŒ‡æ‹–åŠ¨äº‹ä»¶ï¼Œæ¢å¤æŒ‰é’®å¤§å°
    [btn addTarget:self action:@selector(didCancelBtn:) forControlEvents:UIControlEventTouchDragInside];
</code></pre>

<h2>æ€»ç»“ï¼š</h2>

<p>åˆ¶ä½œç±»ä¼¼æ–°æµªå¾®åšè¿™ç§å¼¹å‡ºæ¡†åŠ¨ç”»ï¼Œæˆ‘çš„æ€è·¯æ˜¯å…ˆåˆ†æé€»è¾‘ï¼Œè¿™äº›ç‰¹æ•ˆéƒ½ç”±å“ªäº›ç»„æˆï¼Œæ¯›ç»ç’ƒèƒŒæ™¯ï¼ŒåŠ é¡¶éƒ¨ä¸€ä¸ª <code>logo</code> ï¼ŒåŠ ä¸­é—´ <code>UIScrollView</code>å’Œä¸Šé¢çš„å¾ˆå¤šæŒ‰é’®,åŠ åº•éƒ¨å·¥å…·æ¡ã€‚ç ”ç©¶é€å½»åŠ¨ç”»çš„æ‰§è¡Œé¡ºåºï¼ŒåŠ¨ç”»æ‰§è¡Œç»“æœæœ‰å“ªäº›åˆ†æ”¯ã€‚ç„¶åé’ˆå¯¹ç‰¹æ•ˆä¸­çš„éš¾ç‚¹ï¼Œæ¯”å¦‚æ¯›ç»ç’ƒï¼ŒæŒ‰é’®å¼¹æ€§åŠ¨ç”»ç­‰ç­‰è¿›è¡Œé€ä¸€ç ”ç©¶æ”»ç ´ï¼Œæœ€åå°†è¿™äº›ç»„ä»¶æ•´åˆåœ¨ä¸€èµ·å˜æˆä¸€ä¸ªå¥½ç©çš„åŠ¨ç”»ï¼Œæœ€åä¸è¦å¿˜äº†åŠ¨ç”»çš„å†…å­˜å’Œæ€§èƒ½æµ‹è¯•ã€‚è¿™æ¬¡æˆ‘æ¨¡ä»¿çš„æ–°æµªå¾®åšåŠ¨ç”»å¼¹æ€§æ•ˆæœå¹¶ä¸æ˜¯å¤ªç†æƒ³ï¼Œæ¯”èµ·æ–°æµªåŸç”Ÿæ¥è¯´ä¸æ˜¯ç‰¹åˆ«ä¸€è‡´ï¼Œä¹Ÿå¸Œæœ›æœ‰å…´è¶£çš„ä½ æ¥ç»™æˆ‘ä¸€äº›å»ºè®®ä¼˜åŒ–å®ƒã€‚æœ€ç»ˆåœ¨ä½ çš„é¡¹ç›®ä¸­åŠ å…¥æˆ‘çš„å¼¹å‡ºæ¡†åŠ¨ç”»çœŸçš„åªéœ€è¦ä¸€å¥è¯å“¦ï¼š</p>

<pre><code>    /**
    *  ç›´æ¥æ˜¾ç¤ºä¸€ä¸ªpopViewåœ¨æŸä¸ªviewä¸Š
    *
    *  @param view       çˆ¶view
    *  @param imageArray å›¾æ ‡æ•°ç»„
    *  @param titles     æ ‡é¢˜æ•°ç»„
    *  @param block      å›è°ƒ
    *  @return popè§†å›¾
    */
    + (BHB_INSTANCETYPE)showToView:(UIView *)view andImages:(NSArray *)imageArray andTitles:(NSArray *)titles andSelectBlock:(DidSelectItemBlock)block;
    /**
    *  å¦‚æœæ˜¾ç¤ºä¸€ä¸ªå¸¦moreåŠŸèƒ½çš„ï¼Œè¯·ä½¿ç”¨æ­¤æ–¹æ³•
    *
    *  @param view  çˆ¶view
    *  @param array BHBItemç±»å‹çš„é›†åˆ
    *  @param block å›è°ƒ
    *  @return popè§†å›¾
    */
    + (BHB_INSTANCETYPE)showToView:(UIView *)view withItems:(NSArray *)array andSelectBlock:(DidSelectItemBlock)block;
</code></pre>

<p>hexoå‡ºç‚¹é—®é¢˜ä¿®å¤åˆ°ä¸‹åŠå¤œå•Šï¼ˆå‡çº§åˆ°3.0å¤ªè›‹ç–¼äº†ï¼‰ï¼Œç°åœ¨è„‘å­æ™•æ™•çš„ï¼Œæ˜å¤©è¿˜è¦å»æ–°å…¬å¸å…¥èŒï¼ŒåŠ¨ç”»ä¸­è¿˜æœ‰å¾ˆå¤šç»†èŠ‚æˆ‘ä¸èƒ½ä¸€ä¸€åˆ†äº«äº†ï¼Œæ¬¢è¿å¤§å®¶æ¥ææˆ‘çš„<a href="https://github.com/bb-coder/BHBPopView">Demo</a></p>

<p>good luck!</p>

<p>æœ¬æ–‡ç”±<a href="http://www.90159.com/">ç¨‹åºå‘˜å¤´æ¡</a>ç®¡ç†å‘˜æ¯•æ´ªåšåŸåˆ›æ–‡ç« ï¼Œè½¬è½½åŠ¡å¿…æ³¨æ˜å‡ºå¤„ã€‚</p>

<p>ç‰ˆæƒå£°æ˜ï¼šæˆ‘å·²å°†æœ¬æ–‡åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°çš„å‘è¡¨æƒã€Œç‹¬å®¶ä»£ç†ã€ç»™ iOSå¼€å‘ï¼ˆ iOSDevTip ï¼‰ å¾®ä¿¡å…¬ä¼—å·ã€‚æ‰«ä¸‹æ–¹äºŒç»´ç å³å¯å…³æ³¨ã€ŒiOS å¼€å‘ã€ï¼š</p>

<p><img src="http://images.90159.com/icon/iOSDevTip.jpg" alt="iOSDevTip" /></p>

<p>åŸæ–‡é“¾æ¥ï¼š<a href="http://bihongbo.com/2015/08/19/sinaAnimation/">http://bihongbo.com/2015/08/19/sinaAnimation/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¯å½¢æ¸å˜è¿›åº¦æ¡å®ç°]]></title>
    <link href="http://www.superqq.com/blog/2015/08/12/realization-circular-gradient-progress/"/>
    <updated>2015-08-12T01:12:05+08:00</updated>
    <id>http://www.superqq.com/blog/2015/08/12/realization-circular-gradient-progress</id>
    <content type="html"><![CDATA[<p>ä¹‹å‰æœ‰äººåœ¨æ‰¾æ¸å˜è¿›åº¦æ¡çš„æ•ˆæœï¼Œé—²æ¥æ— äº‹å°±é¡ºæ‰‹å†™äº†ä¸€ä¸ªï¼Œç„¶åç”»äº†è§†å›¾å±‚çº§ï¼Œæ–¹ä¾¿è®²è§£ã€‚</p>

<p>ç¯å¢ƒä¿¡æ¯ï¼š</p>

<p>Mac OS X 10.10.3</p>

<p>Xcode 6.3.1</p>

<p>iOS 8.3</p>

<p>æ•ˆæœå›¾ï¼š</p>

<p><img src="http://images.90159.com/08/result.gif" alt="1" /></p>

<p>æºç ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/saitjr/LoopProgressDemo.git">LoopProgressDemo</a></p>

<p>æ­£æ–‡</p>

<h2>ä¸€ã€è§†å›¾å±‚çº§</h2>

<p>é¦–å…ˆéœ€è¦æå®šçš„å°±æ˜¯è§†å›¾å±‚çº§å…³ç³»ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ</p>

<pre><code>1. èƒŒæ™¯æ˜¯æœ‰é€æ˜åº¦çš„è“è‰²(blueView)

2. éœ€è¦ä¸€ä¸ªä»ç»¿-&gt;é»„-&gt;çº¢çš„æ¸å˜è‰²ï¼Œé‚£ä¸ªè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯Layer(colorLayer)

3. blueViewå’ŒcolorLayerä»–ä»¬çš„è¡¨ç°çŠ¶æ€éƒ½æ˜¯ç¯å½¢çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦ç¯å½¢çš„é®ç½©

4. è“è‰²çš„ç¯å¹¶æ²¡æœ‰å˜ï¼Œè€Œæ¸å˜è‰²çš„ç¯å´åœ¨æ—¶åˆ»å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦ä¸¤ä¸ªé®ç½©ï¼Œä¸€ä¸ªç»™è“è‰²(blueMaskLayer)ï¼Œä¸€ä¸ªç»™æ¸å˜è‰²(colorMaskLayer)
</code></pre>

<p>ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œç°åœ¨éœ€è¦å‡ ä¸ªå˜é‡ä»¥åŠä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š</p>

<pre><code>[viewController.view addSubView:blueView];
[blueView.layer addSubLayer:colorLayer];
colorLayer.mask = colorMaskLayer;
blueView.layer.mask = blueMaskLayer;
</code></pre>

<p>è§†å›¾å±‚çº§å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="http://images.90159.com/08/ios-implement-loop-progress-1.png" alt="1" /></p>

<h2>äºŒã€æ ¹æ®è§†å›¾å±‚çº§æ¥å®ç°</h2>

<p>ææ¸…æ¥šäº†å±‚çº§ï¼Œæ¥ç€å°±åº”è¯¥é€ä¸ªå®ç°äº†ã€‚</p>

<ol>
<li>æœ‰é€æ˜åº¦çš„è“è‰²è§†å›¾blueView</li>
</ol>


<p>ViewController.m</p>

<p>BlueView *blueView = [[BlueView alloc] initWithFrame:CGRectMake(0, 0, 300, 300)];
blueView.center = self.view.center;
blueView.backgroundColor = [UIColor blueColor]; // æˆ‘è¿™é‡Œæ²¡æœ‰ç»™é€æ˜åº¦
[self.view addSubView:blueView];</p>

<ol>
<li>æ¸å˜å›¾å±‚colorLayer</li>
</ol>


<p>å› ä¸ºç³»ç»Ÿæ²¡æœ‰æä¾›æ ¹æ®è·¯å¾„æ¸å˜çš„å®ç°æ–¹æ³•ï¼Œæ‰€ä»¥åªèƒ½é‡‡ç”¨æ›²çº¿æ•‘å›½çš„æ–¹å¼æ¥ç”»ã€‚é‚£ä¹ˆæˆ‘æ‰€ä½¿ç”¨çš„æ–¹æ³•æ˜¯ï¼šåœ¨å·¦è¾¹ç”»ä¸€ä¸ªä»ä¸‹å¾€ä¸Šä¸ºç»¿->é»„çš„æ¸å˜Layerï¼ˆleftLayerï¼‰ï¼Œç„¶åå³è¾¹ç”»ä¸€ä¸ªä»ä¸‹å¾€ä¸Šä¸ºçº¢->é»„çš„æ¸å˜Layerï¼ˆrightLayerï¼‰ã€‚</p>

<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>

<p><img src="http://images.90159.com/08/ios-implement-loop-progress-2.png" alt="1" /></p>

<p>æ¸å˜è‰²</p>

<p>ä½†æ˜¯è¿™ç§æ–¹å¼æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºé»„ç»¿è‰²å’Œæ©˜çº¢è‰²çš„åˆ†ç•Œå¤ªæ˜æ˜¾ï¼Œæ‰€ä»¥æœ€å¥½è®¾ç½®ä¸€ä¸ªæ¸å˜çš„èŒƒå›´ã€‚</p>

<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>

<p><img src="http://images.90159.com/08/ios-implement-loop-progress-3.png" alt="1" /></p>

<p>è®¾ç½®æ¸å˜èŒƒå›´çš„æ¸å˜è‰²</p>

<p>å®ç°ä»£ç ï¼š</p>

<p>BlueView.m</p>

<pre><code>- (void)setupColorLayer {
    self.colorLayer = [CAShapeLayer layer];
    self.colorLayer.frame = self.bounds;
    [self.layer addSublayer:self.colorLayer];

    CAGradientLayer *leftLayer = [CAGradientLayer layer];
    leftLayer.frame = CGRectMake(0, 0, self.bounds.size.width / 2, self.bounds.size.height);
    // åˆ†æ®µè®¾ç½®æ¸å˜è‰²
    leftLayer.locations = @[@0.3, @0.9, @1];
    leftLayer.colors = @[(id)[UIColor yellowColor].CGColor, (id)[UIColor greenColor].CGColor];
    [self.colorLayer addSublayer:leftLayer];

    CAGradientLayer *rightLayer = [CAGradientLayer layer];
    rightLayer.frame = CGRectMake(self.bounds.size.width / 2, 0, self.bounds.size.width / 2, self.bounds.size.height);
    rightLayer.locations = @[@0.3, @0.9, @1];
    rightLayer.colors = @[(id)[UIColor yellowColor].CGColor, (id)[UIColor redColor].CGColor];
    [self.colorLayer addSublayer:rightLayer];
}
</code></pre>

<ol>
<li>æ¸å˜å›¾å±‚çš„ç¯å½¢é®ç½©colorMaskLayer</li>
</ol>


<p>å› ä¸ºæ¸å˜å›¾å±‚ç¯å½¢é®ç½©å’Œè“è‰²è§†å›¾çš„ç¯å½¢é®ç½©æ ·å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥å°†ç¯å½¢é®ç½©çš„åˆ›å»ºä»£ç å°è£…å‡ºæ¥ï¼š</p>

<p>BlueView.m</p>

<pre><code>- (CAShapeLayer *)generateMaskLayer {

    CAShapeLayer *layer = [CAShapeLayer layer];
    layer.frame = self.bounds;

    // åˆ›å»ºä¸€ä¸ªåœ†å¿ƒä¸ºçˆ¶è§†å›¾ä¸­ç‚¹çš„åœ†ï¼ŒåŠå¾„ä¸ºçˆ¶è§†å›¾å®½çš„2/5ï¼Œèµ·å§‹è§’åº¦æ˜¯ä»-240Â°åˆ°60Â°
    UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:CGPointMake(self.bounds.size.width / 2, self.bounds.size.height / 2) radius:self.bounds.size.width / 2.5 startAngle:-3 / 4 * M_PI endAngle:1 / 3 * M_PI clockwise:YES];
    layer.lineWidth = 20;
    layer.path = path.CGPath;
    layer.fillColor = [UIColor clearColor].CGColor; // å¡«å……è‰²ä¸ºé€æ˜ï¼ˆä¸è®¾ç½®ä¸ºé»‘è‰²ï¼‰
    layer.strokeColor = [UIColor blackColor].CGColor; // éšä¾¿è®¾ç½®ä¸€ä¸ªè¾¹æ¡†é¢œè‰²
    layer.lineCap = kCALineCapRound; // è®¾ç½®çº¿ä¸ºåœ†è§’
    return layer;
}
</code></pre>

<p>è®¾ç½®æ¸å˜è‰²ç¯å½¢é®ç½©å±‚</p>

<p>BlueView.m</p>

<pre><code>- (void)setupColorMaskLayer {

    CAShapeLayer *layer = [self generateMaskLayer];
    layer.lineWidth = 20.5; // æ¸å˜é®ç½©çº¿å®½è¾ƒå¤§ï¼Œé˜²æ­¢è“è‰²é®ç½©æœ‰è¾¹éœ²å‡ºæ¥
    self.colorLayer.mask = layer;

    self.colorMaskLayer = [CAShapeLayer layer];
    self.colorMaskLayer = layer;
}
</code></pre>

<ol>
<li>blueViewçš„ç¯å½¢é®ç½©blueMaskLayer</li>
</ol>


<p>BlueView.m</p>

<pre><code>- (void)setupBlueMaskLayer {

    CAShapeLayer *layer = [self generateMaskLayer];
    self.layer.mask = layer;
    self.blueMaskLayer = layer;
}
</code></pre>

<ol>
<li>è®¾ç½®ç™¾åˆ†æ¯”</li>
</ol>


<p>è®¾ç½®æ¸å˜è‰²æ‰€å çš„ç™¾åˆ†æ¯”ï¼Œå…¶å®å°±æ˜¯æ”¹å˜colorMaskLayerçš„èŒƒå›´ï¼Œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥æ ¹æ®ç™¾åˆ†æ¯”æ¥ä¿®æ”¹ã€‚</p>

<pre><code>self.colorMaskLayer.strokeEnd = 0.5;
</code></pre>

<p>åˆ°æ­¤ï¼Œæ•´ä¸ªæ•ˆæœå°±å·²ç»å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ä¸‹å›å¼¹åŠ¨ç”»ã€‚</p>

<h2>ä¸‰ã€è®¾ç½®å›å¼¹åŠ¨ç”»</h2>

<p>æˆ‘æ‰€ä½¿ç”¨çš„æ˜¯popåº“ä¸­çš„POPSpringAnimationï¼Œè¿™ä¸ªæ•ˆæœæ¯”è¾ƒQå¼¹ï¼ŒåŠ åœ¨è¿›åº¦æ¡ä¸Šåˆšå¥½ã€‚è¦åŠ åŠ¨ç”»ï¼Œåªéœ€è¦æŠŠä¸Šé¢çš„ä¿®æ”¹strokeEndçš„ä»£ç æ¢æˆä¸€ä¸‹æ–¹æ³•å°±å¯ä»¥äº†ï¼š</p>

<pre><code>- (void)animationWithStrokeEnd:(CGFloat)strokeEnd {

    POPSpringAnimation *strokeAnimation = [POPSpringAnimation animationWithPropertyNamed:kPOPShapeLayerStrokeEnd];
    strokeAnimation.toValue = @(strokeEnd);
    strokeAnimation.springBounciness = 12.f;
    strokeAnimation.removedOnCompletion = NO;
    [self.colorMaskLayer pop_addAnimation:strokeAnimation forKey:@"layerStrokeAnimation"];
}
</code></pre>

<p>æ¥æºï¼š<a href="http://www.brighttj.com/ios/ios-implement-loop-progress.html">http://www.brighttj.com/ios/ios-implement-loop-progress.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å½©è‰²TabBaråˆ‡æ¢åŠ¨ç”»å®ç°]]></title>
    <link href="http://www.superqq.com/blog/2015/08/11/color-tabbar-switch-animation/"/>
    <updated>2015-08-11T00:38:31+08:00</updated>
    <id>http://www.superqq.com/blog/2015/08/11/color-tabbar-switch-animation</id>
    <content type="html"><![CDATA[<p>æ— æ„é—´çœ‹åˆ°ä¸€ä¸ªå½©è‰²TabBaråˆ‡æ¢çš„è®¾è®¡å›¾ï¼Œæ„Ÿè§‰å¾ˆä¸é”™ï¼Œæœ‰ç©ºå°±æŠŠä»–å®ç°äº†ã€‚
ç¯å¢ƒä¿¡æ¯
Mac OS X 10.10.4
Xcode 6.4
iOS 8.4
æ•ˆæœå›¾ï¼š</p>

<p><img src="http://images.90159.com/08/1.1TabBar-1.gif" alt="1.1TabBar-1.gif" /></p>

<p>æºç ä¸‹è½½åœ°å€ï¼š
<a href="https://github.com/saitjr/TColorfulTabBar.git">https://github.com/saitjr/TColorfulTabBar.git</a></p>

<h2>ä¸€ã€å®ç°åˆ†æ</h2>

<p>çœ‹åˆ°è¿™ä¸ªå½©è‰²åˆ‡æ¢æ•ˆæœçš„æ—¶å€™ï¼Œæˆ‘ç¬¬ä¸€ä¸ªååº”å°±æ˜¯åœ¨TabBarä¸Šæœ‰ä¸€ä¸ªå½©è‰²çš„Viewï¼Œç„¶åæ¯ä¸ªè‰²å—çš„æ˜¾ç¤ºéƒ½æ˜¯é€šè¿‡maskæ¥æ˜¾ç¤ºçš„ã€‚æœ€ç»ˆï¼Œæˆ‘çš„å…·ä½“å®ç°ä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªæ€è·¯æ¥çš„ã€‚</p>

<h4>1. è®¾è®¡æ€æƒ³</h4>

<p>ä¸ºäº†å‡å°‘ä¾µå…¥æ€§ï¼ˆè€¦åˆï¼‰ï¼Œæˆ‘é‡‡å–çš„æ˜¯ç»§æ‰¿UITabBaræ¥å®ç°ï¼Œæ‰€ä»¥è¦é›†æˆçš„æ—¶å€™ï¼Œåªéœ€è¦å°†ç³»ç»Ÿçš„TabBaræ¢æˆæˆ‘å†™çš„TColorfulTabBarå°±å¯ä»¥äº†ã€‚</p>

<p><img src="http://images.90159.com/08/1.2TabBar-2.png" alt="1.2TabBar-2.png" /></p>

<h4>2. è§†å›¾å±‚çº§å›¾</h4>

<h2>äºŒã€æ•ˆæœå®ç°</h2>

<h4>1. æ·»åŠ å½©è‰²è§†å›¾colorfulView</h4>

<p>TColorfulTabBar.m</p>

<pre><code>- (void)setupColorView {

    // åˆå§‹åŒ–å½©è‰²è§†å›¾ï¼Œå¹¶å°†å®ƒåŠ åœ¨tabbarä¸Š
    UIView *colorView = [[UIView alloc] initWithFrame:self.bounds];
    [self addSubview:colorView];
    self.colorfulView = colorView;

    // å½©è‰²è§†å›¾çš„äº”ç§é¢œè‰²ï¼Œè¿™æ˜¯ä¸€ä¸ªUIColoræ•°ç»„ï¼Œ
    NSArray *colors = self.itemColors;
    CGFloat itemWidth = self.bounds.size.width / self.itemCount;

    for (int i = 0; i &lt; self.itemCount; i ++) {

        UIView *view = [[UIView alloc] initWithFrame:CGRectMake(itemWidth * i, 0, itemWidth, self.bounds.size.height)]; 
        view.backgroundColor = colors[i]; 
        [self.colorfulView addSubview:view]; 
    } 
}
</code></pre>

<h4>2. æ·»åŠ å½©è‰²è§†å›¾çš„é®ç½©colorfulMaskView</h4>

<p>ä¹‹æ‰€ä»¥è¿™é‡Œçš„é®ç½©ä½¿ç”¨çš„æ˜¯UIViewè€Œä¸æ˜¯CAShapeLayeræˆ–è€…CALayerï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>

<ul>
<li>é®ç½©æ˜¯çŸ©å½¢ï¼Œæ²¡å¿…è¦ä½¿ç”¨è·¯å¾„ï¼Œæ‰€ä»¥ä¸ç”¨CAShapeLayer</li>
<li>é€šè¿‡è®¾è®¡å›¾å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä½ç§»åŠ¨ç”»ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªé®ç½©å•å‘å˜å®½ï¼ˆå‘å·¦æˆ–å‘å³ï¼‰çš„æ•ˆæœã€‚å¦‚æœä½¿ç”¨CALayerï¼Œé‚£ä¹ˆæ”¹å˜boundsçš„æ—¶å€™ï¼Œæ˜¯åŒå‘æ”¹å˜ï¼Œæƒ³è¦å•å‘å°±å¿…é¡»åŠ é”šç‚¹ï¼Œå¤ªéº»çƒ¦</li>
<li>å¦‚æœä½¿ç”¨UIViewï¼Œé‚£ä¹ˆå‘å³å˜å®½åªéœ€è¦xä¸å˜ï¼Œwidthå˜é•¿å°±è¡Œï¼›å‘å·¦å˜å®½åªéœ€è¦x-valueï¼Œwidth+valueå°±è¡Œï¼Œè¦æ–¹ä¾¿çš„å¤š</li>
<li>æœ€åä¸€ç‚¹å°±æ˜¯åœ¨åšåŠ¨ç”»çš„æ—¶å€™ï¼ŒLayerè¦ç”¨åˆ°CABaseAnimationï¼Œç„¶è€ŒUIViewä½¿ç”¨UIViewçš„Animationå°±è¡Œ</li>
</ul>


<p>åœ¨è®¾ç½®é®ç½©çš„æ—¶å€™ï¼Œå°†colorfulMaskViewçš„layerè®¾ç½®ä¸ºcolorfulViewçš„maskå°±å¯ä»¥äº†ã€‚
ä»£ç å®ç°å¦‚ä¸‹ï¼š
TColorfulTabBar.m</p>

<pre><code>- (void)setupMaskLayer {

    // è·å–æ¯ä¸ªitemçš„å®½åº¦
    CGFloat itemWidth = self.bounds.size.width / self.itemCount;

    // åˆå§‹åŒ–colorMaskViewï¼Œå¹¶å°†colorMaskViewçš„layerè®¾ç½®æˆå½©è‰²è§†å›¾çš„é®ç½©
    UIView *colorMaskView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, itemWidth, self.bounds.size.height)];
    colorMaskView.backgroundColor = [UIColor blackColor];
    self.colorfulMaskView = colorMaskView;
    self.colorfulView.layer.mask = self.colorfulMaskView.layer;
}
</code></pre>

<h4>3. è®¾ç½®ä»£ç†ï¼Œè·å–å½“å‰ç‚¹å‡»çš„ä¸‹æ ‡</h4>

<p>UITabBarå¹¶æ²¡æœ‰è·å–ç‚¹å‡»ä¸‹æ ‡çš„æ¥å£ï¼Œä½†æ˜¯UITabBarDelegateæœ‰ï¼Œè¿™ä¸ªåè®®é»˜è®¤è¢«UITabBarControlleréµå®ˆã€‚ä¸ºäº†é™ä½è€¦åˆæ€§ï¼Œé‡‡ç”¨UITabBarè‡ªå·±è·å–ä¸‹æ ‡ï¼Œæ‰€ä»¥ï¼Œéœ€è¦UITabBarè‡ªå·±å®ç°è‡ªå·±çš„delegateã€‚
<strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½åœ¨UITabBarçš„åˆå§‹åŒ–æ–¹æ³•ä¸­å»è®¾ç½®self.delegate = selfï¼Œå› ä¸ºå³ä½¿è®¾ç½®äº†ï¼Œä¹Ÿä¼šè¢«UITabBarControllerè¦†ç›–ã€‚æœ€ç»ˆè§£å†³æ–¹æ¡ˆæ˜¯å½“UITabBaråŠ è½½åˆ°çˆ¶è§†å›¾ä¸Šæ˜¯ï¼Œåœ¨ä¿®æ”¹delegateä¸ºselfã€‚</strong></p>

<pre><code>- (void)didMoveToSuperview {
    [super didMoveToSuperview];
    self.delegate = self;
}
</code></pre>

<p>å› ä¸ºæ¯æ¬¡çš„ç§»åŠ¨ä½ç½®ä¸æ–¹å‘éƒ½å’Œä¸Šæ¬¡çš„ä¸‹æ ‡ä¸è¿™æ¬¡çš„ä¸‹æ ‡æœ‰å…³ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åˆ°å±æ€§æ¥è®°å½•è¿™ä¸¤ä¸ªä¸‹æ ‡çš„å€¼ã€‚
    - (void)tabBar:(UITabBar <em>)tabBar didSelectItem:(UITabBarItem </em>)item {</p>

<pre><code>    NSInteger index = [self.items indexOfObject:item];
    self.fromeIndex = self.toIndex;
    self.toIndex = index;
    // æ‹¿åˆ°ä¸‹æ ‡ä»¥åæ‰§è¡ŒåŠ¨ç”»
    [self animation];
}
</code></pre>

<h4>4. ç§»åŠ¨é®ç½©ï¼Œæ˜¾ç¤ºä¸åŒçš„è‰²å—</h4>

<p>åœ¨åšåŠ¨ç”»çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘åˆ°æ•ˆæœçš„å¹³æ»‘æ€§ã€‚æ•´ä¸ªåŠ¨ç”»æœ‰ä¸¤ä¸ªåŠ¨ç”»ç»„æˆï¼Œä¸€ä¸ªæ˜¯å®½åº¦æ”¾å¤§çš„åŠ¨ç”»ï¼Œä¸€ä¸ªæ˜¯ç¼©å°åˆ°åŸæ¥å¤§å°å’Œä½ç§»åŠ¨ç”»ã€‚æ•´ä¸ªåŠ¨ç”»æ˜¯EaseInOutçš„æ•ˆæœï¼Œæ‰€ä»¥æ‹†å¼€æ¥çœ‹ï¼Œå°±åº”è¯¥ç¬¬ä¸€ä¸ªåŠ¨ç”»EaseInï¼Œç¬¬äºŒä¸ªåŠ¨ç”»EaseOutã€‚
ä¸€å›¾èƒœåƒè¨€ï¼š</p>

<p><img src="http://images.90159.com/08/1.3TabBar-3.png" alt="1.3TabBar-3.png" /></p>

<pre><code>- (void)animation {

    CGFloat itemWidth = self.bounds.size.width / self.itemCount;
    // ä¸ºäº†æ•ˆæœçœ‹èµ·æ¥æ›´å¹³æ»‘ï¼Œæ‰€ä»¥æ ¹æ®ä¸¤æ¬¡ä¸‹æ ‡çš„å·®å€¼æ¥è®¡ç®—éœ€è¦æ”¾å¤§çš„è·ç¦»
    CGFloat extraWidth = ABS(self.toIndex - self.fromeIndex) * itemWidth / 4;

    // æ”¾å¤§çš„å¤§å°
    CGRect scaleFrame = CGRectMake(self.colorfulMaskView.x, 0, itemWidth + extraWidth, self.bounds.size.height);
    // æœ€ç»ˆå¤§çš„å¤§å°ä¸ä½ç½®
    CGRect toFrame = CGRectMake(self.toIndex * itemWidth, 0, itemWidth, self.bounds.size.height);

    // å¦‚æœæ˜¯å‘å·¦ç§»åŠ¨ï¼Œé‚£ä¿®æ”¹xè½´çš„åæ ‡
    if (self.fromeIndex &gt; self.toIndex) {

        scaleFrame = CGRectMake(self.colorfulMaskView.x - extraWidth, 0, itemWidth + extraWidth, self.bounds.size.height);
    }

    // ä¸¤ä¸ªåŠ¨ç”»åŠ èµ·æ¥æ˜¯ä¸€ä¸ªEaseInOutçš„æ•ˆæœï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªåŠ¨ç”»å°±åº”è¯¥æ˜¯EaseInï¼Œç¬¬äºŒä¸ªåŠ¨ç”»æ˜¯EaseOut
    // å…ˆè¿›è¡Œæ”¾å¤§
    [UIView animateWithDuration:ANIMATION_DURATION delay:0 options:UIViewAnimationOptionCurveEaseIn animations:^{

        self.colorfulMaskView.frame = scaleFrame;
    } completion:^(BOOL finished) {

        // å†è¿›è¡Œç¼©å°å’Œä½ç§»
        [UIView animateWithDuration:ANIMATION_DURATION delay:0 options:UIViewAnimationOptionCurveEaseOut animations:^{

            self.colorfulMaskView.frame = toFrame;
        } completion:NULL];
    }];
}
</code></pre>

<p>åŸæ–‡:<a href="http://www.brighttj.com/ios/ios-colorful-tabbar-implement.html">http://www.brighttj.com/ios/ios-colorful-tabbar-implement.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸€æ¬¡å¯¹MKMapViewçš„æ€§èƒ½ä¼˜åŒ–]]></title>
    <link href="http://www.superqq.com/blog/2015/08/09/performance-optimization-of-mkmapview/"/>
    <updated>2015-08-09T13:18:21+08:00</updated>
    <id>http://www.superqq.com/blog/2015/08/09/performance-optimization-of-mkmapview</id>
    <content type="html"><![CDATA[<h2>å‰è¨€</h2>

<p>æœ€è¿‘åšçš„é¡¹ç›®ä¸»è¦æ˜¯LBSè¿™å— ä¸»æ‰“æˆå‘˜å®šä½åŠŸèƒ½ æˆ‘ä»¬çš„UIè®¾è®¡æ˜¯è¿™æ ·çš„</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-1.png" alt="Pic-MK-1" /></p>

<p>ä¹ä¸€çœ‹ä¸Šå»æ˜¯æŒºå¥½æŒºç¾è§‚çš„ ä¸åŒçš„äººä¼šæ˜¾ç¤ºä¸åŒçš„å¤´åƒ å¯æ˜¯å½“äººæ‰å †çš„æ—¶å€™ é—®é¢˜å°±æ¥äº†</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-2.png" alt="Pic-MK-2" /></p>

<p>å½“äººå¤šçš„æ—¶å€™(ä¾‹å¦‚ä¸Šå›¾æ‰€ç¤º) åœ°å›¾æ»‘åŠ¨èµ·æ¥å°±èƒ½æ„Ÿè§‰åˆ°æ˜æ˜¾é¡¿å¡ é‚£ç§ä¸æµç•…æ„Ÿèƒ½æŠ˜ç£¨æ­»äºº æ‰€ä»¥ è‡ªç„¶æˆ‘ä»¬è¦è§£å†³è¿™ä¸ªé—®é¢˜(ç­‰ç­‰ å…ˆä¸è¦åæ§½ä¸ºä»€ä¹ˆä¸ç”¨åœ°å›¾èšåˆ å› ä¸ºè¿™å·²ç»æ˜¯åœ°å›¾æ”¾åˆ°æœ€å¤§äº† èšåˆä¸é€‚åˆè¿™æ¬¡çš„é—®é¢˜è®¨è®º)</p>

<h2>åˆ†æ</h2>

<p>é¦–å…ˆçœ‹ä¸‹æˆ‘æ˜¯æ€ä¹ˆå®ç°è¿™ä¸ªannotationViewçš„ ç”±äºè¿™ä¸ªannotationsViewæ˜¯å¼‚å½¢çš„(ä¹Ÿå°±æ˜¯æ— æ³•é€šè¿‡è®¾ç½®åœ†è§’ç›´æ¥å¾—åˆ°) è€Œä¸”é‡Œé¢çš„å›¾ç‰‡è¿˜å› ç”¨æˆ·è€Œå¼‚ æ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨layer.maskæ¥è¿›è¡Œé®ç½© ä»£ç å¦‚ä¸‹</p>

<pre><code>@implementation MMAnnotationView

- (instancetype)initWithAnnotation:(id&lt;MKAnnotation&gt;)annotation reuseIdentifier:(NSString *)reuseIdentifier
{
    self = [super initWithAnnotation:annotation reuseIdentifier:reuseIdentifier];
    if ( self )
    {
        self.frame = CGRectMake(0, 0, TRACK_ANNOTATION_SIZE.width, TRACK_ANNOTATION_SIZE.height);
        self.centerOffset = CGPointMake(0, -(TRACK_ANNOTATION_SIZE.height-3)/2);
        self.canShowCallout = NO;

        self.avatarView = [[UIImageView alloc] initWithFrame:self.bounds];
        [self addSubview:self.avatarView];
        self.avatarView.contentMode = UIViewContentModeScaleAspectFill;

        CAShapeLayer *shapelayer = [CAShapeLayer layer];
        shapelayer.frame = self.bounds;
        shapelayer.path = self.framePath.CGPath;
        self.avatarView.layer.mask = shapelayer;

        self.layer.shadowPath = self.framePath.CGPath;
        self.layer.shadowRadius = 1.0f;
        self.layer.shadowColor = [UIColor colorWithHex:0x666666FF].CGColor;
        self.layer.shadowOpacity = 1.0f;
        self.layer.shadowOffset = CGSizeMake(0, 0);
        self.layer.masksToBounds = NO;
    }
    return self;
}

//maskè·¯å¾„
- (UIBezierPath *)framePath
{
    if ( !_framePath )
    {
        CGFloat arrowWidth = 14;

        CGMutablePathRef path = CGPathCreateMutable();

        CGRect rectangle = CGRectInset(CGRectMake(0, 0, CGRectGetWidth(self.bounds), CGRectGetWidth(self.bounds)), 3,3);

        CGPoint p[3] = {
        {CGRectGetMidX(self.bounds)-arrowWidth/2, CGRectGetWidth(self.bounds)-6},
        {CGRectGetMidX(self.bounds)+arrowWidth/2, CGRectGetWidth(self.bounds)-6},
        {CGRectGetMidX(self.bounds), CGRectGetHeight(self.bounds)-4}
        };

        CGPathAddRoundedRect(path, NULL, rectangle, 5, 5);
        CGPathAddLines(path, NULL, p, 3);

        CGPathCloseSubpath(path);

        _framePath = [UIBezierPath bezierPathWithCGPath:path];

        CGPathRelease(path);
    }

    return _framePath;
}
</code></pre>

<p>æˆ‘ç”¨ä»£ç ç”Ÿæˆäº†å½¢çŠ¶è·¯å¾„ å¹¶ä»¥æ­¤ç”Ÿæˆäº†layerçš„maskå’ŒshadowPath
ä½¿ç”¨æ—¶ åªè¦ç›´æ¥ç”¨SDWebImageè®¾ç½®å¤´åƒå°±è¡Œäº†</p>

<pre><code>[annotationView.avatarView sd_setImageWithURL:[NSURL URLWithString:avatarURL] placeholderImage:placeHolderImage];
</code></pre>

<p>æ¥ä¸‹æ¥ç”¨å·¥å…·åˆ†æä¸€ä¸‹é—®é¢˜å‡ºæ¥å“ª åˆ†ææ€§èƒ½å½“ç„¶æ˜¯é€‰æ‹©Instrments(ç”¨æ³•åœ¨è¿™é‡Œå°±ä¸åšä»‹ç»äº†) æ‰“å¼€Core Animation ç„¶åè¿è¡Œç¨‹åº æ»‘åŠ¨åœ°å›¾ å¯ä»¥çœ‹åˆ°æ€§èƒ½åˆ†æå¦‚ä¸‹</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-3.jpg" alt="Pic-MK-3" /></p>

<p>åŸæ¥å¹³å‡å¸§æ•°åªæœ‰ä¸åˆ°30å¸§ è¿™ç¦»æˆ‘ä»¬çš„ç›®æ ‡60å¸§å·®å¾—å®åœ¨å¤ªè¿œ</p>

<p>å†ä½¿ç”¨Debug Optionæ¥æ·±å…¥åˆ†æä¸€ä¸‹</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-4.png" alt="Pic-MK-4" /></p>

<p>ç”±äºMKMapViewçš„åŸå›  è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒè¿™å‡ ä¸ªé€‰é¡¹</p>

<ul>
<li>Color Blended Layers</li>
<li>Color Misaligned Images</li>
<li>Color Offscreen-Rendered Yellow</li>
</ul>


<p>åˆ†åˆ«æ‰“å¼€è¿™å‡ ä¸ªé€‰é¡¹ ç»“æœå¦‚ä¸‹</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-5.png" alt="Pic-MK-5" /></p>

<p>å¯ä»¥çœ‹åˆ°</p>

<ul>
<li>Color Blended Layersæ²¡æœ‰é—®é¢˜ ä¸è¿‡è¿™ä¹Ÿæ˜¯æ­£å¸¸çš„ ç”±äºä½¿ç”¨äº†mask æ²¡æœ‰é€æ˜çš„åœ°æ–¹</li>
<li>Color Misaligned Imagesé™¤äº†é»˜è®¤å¤´åƒå¤–å…¨ä¸­ è¿™æ˜¯å› ä¸ºæœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡å¤§å°è·Ÿæ˜¾ç¤ºçš„å¤§å°ä¸ä¸€è‡´ å¯¼è‡´ç¼©æ”¾ è€Œé»˜è®¤å¤´åƒåˆ™æ˜¯ä¸€è‡´çš„ æ‰€ä»¥æ²¡é—®é¢˜</li>
<li>Color Offscreen-Rendered Yellowå…¨ä¸­ ç”±äºä½¿ç”¨äº†mask å¯¼è‡´å¤§é‡çš„ç¦»å±æ¸²æŸ“ è¿™ä¹Ÿæ˜¯æ€§èƒ½ä¸‹é™çš„ä¸»è¦åŸå› </li>
</ul>


<h2>è§£å†³</h2>

<p>é—®é¢˜çš„åŸå› æ‰¾åˆ°äº† é‚£ä¹ˆæ¥ä¸‹æ¥è¯¥å¦‚ä½•è§£å†³å‘¢?</p>

<ul>
<li>é¦–å…ˆmaskæ˜¯è‚¯å®šä¸èƒ½ç”¨äº†</li>
<li><p>å…¶æ¬¡ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡æˆ‘ä»¬è¦é¢„å¤„ç†æˆå®é™…å¤§å°
é‚£ä¹ˆ ç›´æ¥æŠŠä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡åˆæˆä¸ºæˆ‘ä»¬è¦æ˜¾ç¤ºçš„æœ€ç»ˆç»“æœä¸å°±okäº†å—? è¯•è¯•çœ‹</p>

<pre><code>  - (void)loadAnnotationImageWithURL:(NSString*)url imageView:(UIImageView*)imageView
  {
      //å°†åˆæˆåçš„å›¾ç‰‡ç¼“å­˜èµ·æ¥
      NSString *annoImageURL = url;
      NSString *annoImageCacheURL = [annoImageURL stringByAppendingString:@"cache"];

      UIImage *cacheImage = [[SDImageCache sharedImageCache] imageFromDiskCacheForKey:annoImageCacheURL];
      if ( cacheImage )
      {
          //LLLog(@"hit cache");
          imageView.image = cacheImage;
      }
      else
      {
          //LLLog(@"no cache");
          [imageView sd_setImageWithURL:[NSURL URLWithString:annoImageURL]
          placeholderImage:placeHolderImage
          completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, NSURL *imageURL) {
          if (!error)
          {
              UIImage *annoImage = [image annotationImage];
              imageView.image = annoImage;

              [[SDImageCache sharedImageCache] storeImage:annoImage forKey:annoImageCacheURL];
              }
          }];
      }
  }

  @implementation UIImage (LJC)
  - (UIImage*) annotationImage
  {
      static UIView *snapshotView = nil;
      static UIImageView *imageView = nil;

      if ( !snapshotView )
      {
          snapshotView = [UIView new];
          snapshotView.frame = CGRectMake(0, 0, TRACK_ANNOTATION_SIZE.width, TRACK_ANNOTATION_SIZE.height);

          imageView = [UIImageView new];
          [snapshotView addSubview:imageView];
          imageView.clipsToBounds = YES;
          imageView.frame = snapshotView.bounds;
          imageView.contentMode = UIViewContentModeScaleAspectFill;

          CGFloat arrowWidth = 14;

          CGMutablePathRef path = CGPathCreateMutable();

          CGRect rectangle = CGRectInset(CGRectMake(0, 0, CGRectGetWidth(imageView.bounds), CGRectGetWidth(imageView.bounds)), 3,3);

          CGPoint p[3] = {
              {CGRectGetMidX(imageView.bounds)-arrowWidth/2, CGRectGetWidth(imageView.bounds)-6},
              {CGRectGetMidX(imageView.bounds)+arrowWidth/2, CGRectGetWidth(imageView.bounds)-6},
              {CGRectGetMidX(imageView.bounds), CGRectGetHeight(imageView.bounds)-4}
          };

          CGPathAddRoundedRect(path, NULL, rectangle, 5, 5);
          CGPathAddLines(path, NULL, p, 3);

          CGPathCloseSubpath(path);

          CAShapeLayer *shapelayer = [CAShapeLayer layer];
          shapelayer.frame = imageView.bounds;
          shapelayer.path = path;

          imageView.layer.mask = shapelayer;

          snapshotView.layer.shadowPath = path;
          snapshotView.layer.shadowRadius = 1.0f;
          snapshotView.layer.shadowColor = [UIColor colorWithHex:0x666666FF].CGColor;
          snapshotView.layer.shadowOpacity = 1.0f;
          snapshotView.layer.shadowOffset = CGSizeMake(0, 0);

          CGPathRelease(path);
      }

      imageView.image = self;

      UIGraphicsBeginImageContextWithOptions(TRACK_ANNOTATION_SIZE, NO, 0);

      [snapshotView.layer renderInContext:UIGraphicsGetCurrentContext()];

      UIImage *copied = UIGraphicsGetImageFromCurrentImageContext();
      UIGraphicsEndImageContext();

      return copied;
  }
  @end
</code></pre></li>
</ul>


<p>ç„¶åä½¿ç”¨çš„æ—¶å€™ åªè¦ç®€å•çš„å¦‚ä¸‹è°ƒç”¨å°±OKäº†</p>

<pre><code>[self loadAnnotationImageWithURL:avatarURL imageView:annotationView.avatarView];
</code></pre>

<p>çœ‹çœ‹ä¿®æ”¹ä¹‹åçš„Instrumentsè¡¨ç°å¦‚ä½•</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-6.png" alt="Pic-MK-6" /></p>

<ul>
<li>Color Blended Layerså…¨ä¸­ è¿™ä¹Ÿæ˜¯æ— å¯é¿å…çš„ å› ä¸ºæ˜¾ç¤ºçš„å°±æ˜¯ä¸€å¼ å¸¦é€æ˜åº¦çš„å›¾ ä½†æ˜¯ç”±äºåœ°å›¾çš„ç‰¹æ®Šæ€§(å¤´åƒçš„ä½ç½®å˜åŒ–é—´éš”è¾ƒé•¿ æ‰€ä»¥ä¸ä¼šç»å¸¸å¼•å‘åˆæˆ ä¹Ÿæ²¡æœ‰åŠ¨ç”») æ‰€ä»¥è¿™é‡Œä¹Ÿä¸æ˜¯é—®é¢˜</li>
<li>Color Misaligned Imagesæ²¡é—®é¢˜äº† å› ä¸ºå¤´åƒå·²è¢«ç¼©æ”¾æˆäº†ç›¸åŒå¤§å°</li>
<li>Color Offscreen-Rendered Yellowæ²¡é—®é¢˜äº† å› ä¸ºåªæ˜¯ç®€å•çš„æ˜¾ç¤ºäº†ä¸€å¼ å›¾ç‰‡ è€Œå¹¶æ²¡æœ‰éœ€è¦ç¦»å±æ¸²æŸ“çš„ä¸œè¥¿äº†</li>
</ul>


<p>å†æ¥çœ‹ä¸‹å¸§æ•°æƒ…å†µ</p>

<p><img src="http://7xkkjz.com1.z0.glb.clouddn.com/MK-7.jpg" alt="Pic-MK-7" /></p>

<p>Oh-Yeah~ ä¸å…‰å¸§æ•°è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®æ ‡60å¸§(ç”±äºè¿˜æœ‰ä¸šåŠ¡é€»è¾‘çº¿ç¨‹åœ¨åå°è·‘ æ‰€ä»¥æ²¡æœ‰é‚£ä¹ˆçš„ç¨³å®š) å°±è¿å¹³å‡è¿è¡Œè€—æ—¶éƒ½ä¸‹é™äº†ä¸å°‘ å°±ç®—åœ°å›¾ä¸Šå†å¤šæ˜¾ç¤ºå‡ åä¸ªäºº ä¹Ÿä¸æˆé—®é¢˜äº†</p>

<p>åŸæ–‡è¿æ¥ï¼š<a href="http://adad184.com/2015/07/13/improve-performance-with-mkmapview/">http://adad184.com/2015/07/13/improve-performance-with-mkmapview/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ã€Šæ‹›è˜ä¸€ä¸ªé è°±çš„iOSã€‹é¢è¯•é¢˜å‚è€ƒç­”æ¡ˆï¼ˆä¸Šï¼‰]]></title>
    <link href="http://www.superqq.com/blog/2015/08/08/interview-ios-question-answer/"/>
    <updated>2015-08-08T00:16:38+08:00</updated>
    <id>http://www.superqq.com/blog/2015/08/08/interview-ios-question-answer</id>
    <content type="html"><![CDATA[<blockquote><p>æ¨èç†ç”±ï¼šæœ€è¿‘æ¯”è¾ƒğŸ”¥çš„å…³äºiOSå¼€å‘é¢è¯•é¢˜çš„æ–‡ç« ã€‚ç®€å•å–µäº†ä¸€çœ¼ï¼Œæ„Ÿè§‰å¾ˆä¸é”™ï¼Œä½œè€…sunnyxxä¹Ÿæ˜¯ä¸ªå¤§ç‰›ã€‚ç‰¹æ­¤æ¨èï¼</p></blockquote>

<p><a href="http://blog.sunnyxx.com/2015/07/04/ios-interview/">ã€Šæ‹›è˜ä¸€ä¸ªé è°±çš„ iOSã€‹</a>â€”å‚è€ƒç­”æ¡ˆï¼ˆä¸Šï¼‰</p>

<p>è¯´æ˜ï¼šé¢è¯•é¢˜æ¥æºæ˜¯<a href="http://weibo.com/u/1364395395">å¾®åš@æˆ‘å°±å«Sunnyæ€ä¹ˆäº†</a>çš„è¿™ç¯‡åšæ–‡ï¼š<a href="http://blog.sunnyxx.com/2015/07/04/ios-interview/">ã€Šæ‹›è˜ä¸€ä¸ªé è°±çš„ iOSã€‹</a>ï¼Œå…¶ä¸­å…±55é¢˜ï¼Œé™¤ç¬¬ä¸€é¢˜ä¸ºçº é”™é¢˜å¤–ï¼Œå…¶ä»–54é“å‡ä¸ºç®€ç­”é¢˜ã€‚</p>

<p>å‡ºé¢˜è€…ç®€ä»‹ï¼š å­™æºï¼ˆsunnyxxï¼‰ï¼Œç›®å‰å°±èŒäºç™¾åº¦ï¼Œè´Ÿè´£ç™¾åº¦çŸ¥é“ iOS å®¢æˆ·ç«¯çš„å¼€å‘å·¥ä½œï¼Œå¯¹æŠ€æœ¯å–œæ¬¢åˆ¨æ ¹é—®åº•å’Œæ€»ç»“æœ€ä½³å®è·µï¼Œçƒ­çˆ±åˆ†äº«å’Œå¼€æºï¼Œç»´æŠ¤ä¸€ä¸ªå« forkingdog çš„å¼€æºå°ç»„ã€‚</p>

<p>ç­”æ¡ˆä¸º<a href="http://weibo.com/luohanchenyilong/">å¾®åš@iOSç¨‹åºçŠ­è¢</a>æ•´ç†ï¼Œæœªç»å‡ºé¢˜è€…æ ¡å¯¹ï¼Œå¦‚æœ‰çº°æ¼ï¼Œè¯·å‘<a href="http://weibo.com/luohanchenyilong/">å¾®åš@iOSç¨‹åºçŠ­è¢</a>æŒ‡æ­£ã€‚</p>

<hr />

<h3>1. é£æ ¼çº é”™é¢˜</h3>

<p><img src="http://i.imgur.com/O7Zev94.png" alt="enter image description here" />
ä¿®æ”¹å®Œçš„ä»£ç ï¼š</p>

<p>ä¿®æ”¹æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œç°ç»™å‡ºä¸€ç§åšç¤ºä¾‹ï¼š</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ä¿®æ”¹å®Œçš„ä»£ç ï¼Œè¿™æ˜¯ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼Œåé¢ä¼šç»™å‡ºç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•

typedef NS_ENUM(NSInteger, CYLSex) {
    CYLSexMan,
    CYLSexWoman
};

@interface CYLUser : NSObject&lt;NSCopying&gt;

@property (nonatomic, copy, readonly) NSString *name;
@property (nonatomic, assign, readonly) NSUInteger age;
@property (nonatomic, assign, readonly) CYLSex sex;

- (instancetype)initWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;
+ (instancetype)userWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;

@end
</code></pre>

<p>ä¸‹é¢å¯¹å…·ä½“ä¿®æ”¹çš„åœ°æ–¹ï¼Œåˆ†ä¸¤éƒ¨åˆ†åšä¸‹ä»‹ç»ï¼š<strong><em>ç¡¬ä¼¤éƒ¨åˆ†</em></strong>å’Œ<strong><em>ä¼˜åŒ–éƒ¨åˆ†</em></strong>
ã€‚å› ä¸º<strong><em>ç¡¬ä¼¤éƒ¨åˆ†</em></strong>æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œä¸ºäº†èŠ‚çœå¤§å®¶æ—¶é—´ï¼Œæ”¾åœ¨åé¢è®²ï¼Œå¤§ç¥è¯·ç›´æ¥çœ‹<strong><em>ä¼˜åŒ–éƒ¨åˆ†</em></strong>ã€‚</p>

<h4><strong><em>ä¼˜åŒ–éƒ¨åˆ†</em></strong></h4>

<ol>
<li><p>enumå»ºè®®ä½¿ç”¨ <code>NS_ENUM</code> å’Œ <code>NS_OPTIONS</code> å®æ¥å®šä¹‰æšä¸¾ç±»å‹ï¼Œå‚è§å®˜æ–¹çš„ <a href="https://developer.apple.com/library/ios/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html">Adopting Modern Objective-C</a> ä¸€æ–‡ï¼š</p>

<p>//å®šä¹‰ä¸€ä¸ªæšä¸¾
typedef NS_ENUM(NSInteger, CYLSex) {
    CYLSexMan,
    CYLSexWoman
};</p></li>
<li><p>ageå±æ€§çš„ç±»å‹ï¼šåº”é¿å…ä½¿ç”¨åŸºæœ¬ç±»å‹ï¼Œå»ºè®®ä½¿Foundationæ•°æ®ç±»å‹ï¼Œå¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>

<p>int -> NSInteger
unsigned -> NSUInteger
float -> CGFloat
åŠ¨ç”»æ—¶é—´ -> NSTimeInterval</p></li>
</ol>


<p>åŒæ—¶è€ƒè™‘åˆ°ageçš„ç‰¹ç‚¹ï¼Œåº”ä½¿ç”¨NSUIntegerï¼Œè€Œéintã€‚
è¿™æ ·åšçš„æ˜¯åŸºäº64-bit é€‚é…è€ƒè™‘ï¼Œè¯¦æƒ…å¯å‚è€ƒå‡ºé¢˜è€…çš„åšæ–‡<a href="http://blog.sunnyxx.com/2014/12/20/64-bit-tips/">ã€Š64-bit Tipsã€‹</a>ã€‚</p>

<ol>
<li>å¦‚æœå·¥ç¨‹é¡¹ç›®éå¸¸åºå¤§ï¼Œéœ€è¦æ‹†åˆ†æˆä¸åŒçš„æ¨¡å—ï¼Œå¯ä»¥åœ¨ç±»ã€typedefå®å‘½åçš„æ—¶å€™ä½¿ç”¨å‰ç¼€ã€‚</li>
<li>doLogInæ–¹æ³•ä¸åº”å†™åœ¨è¯¥ç±»ä¸­ï¼šè™½ç„¶<code>LogIn</code>çš„å‘½åä¸å¤ªæ¸…æ™°ï¼Œä½†ç¬”è€…çŒœæµ‹æ˜¯loginçš„æ„æ€ï¼Œè€Œç™»å½•æ“ä½œå±äºä¸šåŠ¡é€»è¾‘ï¼Œè§‚å¯Ÿç±»å UserModel ï¼Œä»¥åŠå±æ€§çš„å‘½åæ–¹å¼ï¼Œè¯¥ç±»åº”è¯¥æ˜¯ä¸€ä¸ª Model è€Œä¸æ˜¯ä¸€ä¸ªâ€œ MVVM æ¨¡å¼ä¸‹çš„ ViewModel â€ï¼š</li>
</ol>


<blockquote><p>æ— è®ºæ˜¯MVCæ¨¡å¼è¿˜æ˜¯MVVMæ¨¡å¼ï¼Œä¸šåŠ¡é€»è¾‘éƒ½ä¸åº”å½“å†™åœ¨Modelé‡Œã€‚</p></blockquote>

<p> ï¼ˆå¦‚æœæŠ›å¼€å‘½åè§„èŒƒï¼Œå‡è®¾è¯¥ç±»çœŸçš„æ˜¯MVVMæ¨¡å¼é‡Œçš„ ViewModel ï¼Œé‚£ä¹ˆUserModelè¿™ä¸ªç±»å¯èƒ½å¯¹åº”çš„æ˜¯ç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œå¦‚æœæœ‰ç‰¹æ®Šçš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šloginå¯¹åº”çš„åº”å½“æ˜¯æ³¨å†Œå¹¶ç™»å½•çš„ä¸€ä¸ªButtonï¼Œå‡ºç°loginæ–¹æ³•ä¹Ÿå¯èƒ½æ˜¯åˆç†çš„ã€‚ï¼‰</p>

<ol>
<li>doLogInæ–¹æ³•å‘½åä¸è§„èŒƒï¼šæ·»åŠ äº†å¤šä½™çš„åŠ¨è¯å‰ç¼€ã€‚
è¯·ç‰¢è®°ï¼š</li>
</ol>


<blockquote><p>å¦‚æœæ–¹æ³•è¡¨ç¤ºè®©å¯¹è±¡æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œï¼Œä½¿ç”¨åŠ¨è¯æ‰“å¤´æ¥å‘½åï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨<code>do</code>ï¼Œ<code>does</code>è¿™ç§å¤šä½™çš„å…³é”®å­—ï¼ŒåŠ¨è¯æœ¬èº«çš„æš—ç¤ºå°±è¶³å¤Ÿäº†ã€‚
 11. <code>-(id)initUserModelWithUserName: (NSString*)name withAge:(int)age;</code>æ–¹æ³•ä¸­ä¸è¦ç”¨<code>with</code>æ¥è¿æ¥ä¸¤ä¸ªå‚æ•°:<code>withAge:</code>åº”å½“æ¢ä¸º<code>age:</code>ï¼Œ<code>age:</code>å·²ç»è¶³ä»¥æ¸…æ™°è¯´æ˜å‚æ•°çš„ä½œç”¨ï¼Œä¹Ÿä¸å»ºè®®ç”¨<code>andAge:</code>ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œå³ä½¿æœ‰ç±»ä¼¼<code>withA:withB:</code>çš„å‘½åéœ€æ±‚ï¼Œä¹Ÿé€šå¸¸æ˜¯ä½¿ç”¨<code>withA:andB:</code>è¿™ç§å‘½åï¼Œç”¨æ¥è¡¨ç¤ºæ–¹æ³•æ‰§è¡Œäº†ä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„æ“ä½œï¼ˆ<em>ä»è®¾è®¡ä¸Šæ¥è¯´ï¼Œè¿™æ—¶å€™ä¹Ÿå¯ä»¥æ‹†åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„æ–¹æ³•</em>ï¼‰ï¼Œå®ƒä¸åº”è¯¥ç”¨ä½œé˜æ˜æœ‰å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ï¼š</p></blockquote>

<pre><code>//é”™è¯¯ï¼Œä¸è¦ä½¿ç”¨"and"æ¥è¿æ¥å‚æ•°
- (int)runModalForDirectory:(NSString *)path andFile:(NSString *)name andTypes:(NSArray *)fileTypes;
//é”™è¯¯ï¼Œä¸è¦ä½¿ç”¨"and"æ¥é˜æ˜æœ‰å¤šä¸ªå‚æ•°
- (instancetype)initWithName:(CGFloat)width andAge:(CGFloat)height;
//æ­£ç¡®ï¼Œä½¿ç”¨"and"æ¥è¡¨ç¤ºä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„æ“ä½œ
- (BOOL)openFile:(NSString *)fullPath withApplication:(NSString *)appName andDeactivate:(BOOL)flag;
</code></pre>

<ol>
<li>ç”±äºå­—ç¬¦ä¸²å€¼å¯èƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥è¦æŠŠç›¸å…³å±æ€§çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€å£°æ˜ä¸ºcopyã€‚(åŸå› åœ¨ä¸‹æ–‡æœ‰è¯¦ç»†è®ºè¿°ï¼š<strong><em>ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</em></strong>)</li>
<li>â€œæ€§åˆ«â€(sexï¼‰å±æ€§çš„ï¼šè¯¥ç±»ä¸­åªç»™å‡ºäº†ä¸€ç§â€œåˆå§‹åŒ–æ–¹æ³•â€ (initializer)ç”¨äºè®¾ç½®â€œå§“åâ€(Name)å’Œâ€œå¹´é¾„â€(Age)çš„åˆå§‹å€¼ï¼Œé‚£å¦‚ä½•å¯¹â€œæ€§åˆ«â€(Sexï¼‰åˆå§‹åŒ–ï¼Ÿ</li>
</ol>


<p> Objective-C æœ‰ designated å’Œ secondary åˆå§‹åŒ–æ–¹æ³•çš„è§‚å¿µã€‚ designated åˆå§‹åŒ–æ–¹æ³•æ˜¯æä¾›æ‰€æœ‰çš„å‚æ•°ï¼Œsecondary åˆå§‹åŒ–æ–¹æ³•æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªæˆ–è€…æ›´å¤šçš„é»˜è®¤å‚æ•°æ¥è°ƒç”¨ designated åˆå§‹åŒ–æ–¹æ³•çš„åˆå§‹åŒ–æ–¹æ³•ã€‚ä¸¾ä¾‹è¯´æ˜ï¼š</p>

<pre><code>// .mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
//

@implementation CYLUser

- (instancetype)initWithName:(NSString *)name
                         age:(NSUInteger)age
                         sex:(CYLSex)sex {
    if(self = [super init]) {
        _name = [name copy];
        _age = age;
        _sex = sex;
    }
    return self;
}

- (instancetype)initWithName:(NSString *)name
                         age:(NSUInteger)age {
    return [self initWithName:name age:age sex:nil];
}

@end
</code></pre>

<p> ä¸Šé¢çš„ä»£ç ä¸­initWithName:age:sex: å°±æ˜¯ designated åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦å¤–çš„æ˜¯ secondary åˆå§‹åŒ–æ–¹æ³•ã€‚å› ä¸ºä»…ä»…æ˜¯è°ƒç”¨ç±»å®ç°çš„ designated åˆå§‹åŒ–æ–¹æ³•ã€‚</p>

<p>  å› ä¸ºå‡ºé¢˜è€…æ²¡æœ‰ç»™å‡º.mæ–‡ä»¶ï¼Œæ‰€ä»¥æœ‰ä¸¤ç§çŒœæµ‹ï¼š1ï¼šæœ¬æ¥æ‰“ç®—åªè®¾è®¡ä¸€ä¸ªdesignated åˆå§‹åŒ–æ–¹æ³•ï¼Œä½†æ¼æ‰äº†â€œæ€§åˆ«â€(sexï¼‰å±æ€§ã€‚é‚£ä¹ˆæœ€ç»ˆçš„ä¿®æ”¹ä»£ç å°±æ˜¯ä¸Šæ–‡ç»™å‡ºçš„ç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ã€‚2ï¼šä¸æ‰“ç®—åˆå§‹æ—¶åˆå§‹åŒ–â€œæ€§åˆ«â€(sexï¼‰å±æ€§ï¼Œæ‰“ç®—åæœŸå†ä¿®æ”¹ï¼Œå¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆåº”è¯¥æŠŠâ€œæ€§åˆ«â€(sexï¼‰å±æ€§è®¾ä¸ºreadwriteå±æ€§ï¼Œæœ€ç»ˆç»™å‡ºçš„ä¿®æ”¹ä»£ç åº”è¯¥æ˜¯ï¼š</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ç¬¬äºŒç§ä¿®æ”¹æ–¹æ³•ï¼ˆåŸºäºç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•çš„åŸºç¡€ä¸Šï¼‰

typedef NS_ENUM(NSInteger, CYLSex) {
    CYLSexMan,
    CYLSexWoman
};

@interface CYLUser : NSObject&lt;NSCopying&gt;

@property (nonatomic, copy, readonly) NSString *name;
@property (nonatomic, assign, readonly) NSUInteger age;
@property (nonatomic, assign, readwrite) CYLSex sex;

- (instancetype)initWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;
- (instancetype)initWithName:(NSString *)name age:(NSUInteger)age;
+ (instancetype)userWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;

@end
</code></pre>

<p> .hä¸­æš´éœ² designated åˆå§‹åŒ–æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å­ç±»åŒ– ï¼ˆæƒ³äº†è§£æ›´å¤šï¼Œè¯·æˆ³&ndash;ã€‹ <a href="http://is.gd/OQ49zk"><strong><em>ã€Šç¦…ä¸ Objective-C ç¼–ç¨‹è‰ºæœ¯ ï¼ˆZen and the Art of the Objective-C Craftsmanship ä¸­æ–‡ç¿»è¯‘ï¼‰ã€‹</em></strong></a>ã€‚ï¼‰</p>

<ol>
<li>æŒ‰ç…§æ¥å£è®¾è®¡çš„æƒ¯ä¾‹ï¼Œå¦‚æœè®¾è®¡äº†â€œåˆå§‹åŒ–æ–¹æ³•â€ (initializer)ï¼Œä¹Ÿåº”å½“æ­é…ä¸€ä¸ªå¿«æ·æ„é€ æ–¹æ³•ã€‚è€Œå¿«æ·æ„é€ æ–¹æ³•çš„è¿”å›å€¼ï¼Œå»ºè®®ä¸ºinstancetypeï¼Œä¸ºä¿æŒä¸€è‡´æ€§ï¼Œinitæ–¹æ³•å’Œå¿«æ·æ„é€ æ–¹æ³•çš„è¿”å›ç±»å‹æœ€å¥½éƒ½ç”¨instancetypeã€‚</li>
<li><p>å¦‚æœåŸºäºç¬¬ä¸€ç§ä¿®æ”¹æ–¹æ³•ï¼šæ—¢ç„¶è¯¥ç±»ä¸­å·²ç»æœ‰ä¸€ä¸ªâ€œåˆå§‹åŒ–æ–¹æ³•â€ (initializer)ï¼Œç”¨äºè®¾ç½®â€œå§“åâ€(Name)ã€â€œå¹´é¾„â€(Age)å’Œâ€œæ€§åˆ«â€(Sexï¼‰çš„åˆå§‹å€¼:
é‚£ä¹ˆåœ¨è®¾è®¡å¯¹åº”@propertyæ—¶å°±åº”è¯¥å°½é‡ä½¿ç”¨ä¸å¯å˜çš„å¯¹è±¡ï¼šå…¶ä¸‰ä¸ªå±æ€§éƒ½åº”è¯¥è®¾ä¸ºâ€œåªè¯»â€ã€‚ç”¨åˆå§‹åŒ–æ–¹æ³•è®¾ç½®å¥½å±æ€§å€¼ä¹‹åï¼Œå°±ä¸èƒ½å†æ”¹å˜äº†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä»éœ€å£°æ˜å±æ€§çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€ã€‚äºæ˜¯å¯ä»¥æŠŠå±æ€§çš„å®šä¹‰æ”¹æˆè¿™æ ·</p>

<pre><code>  @property (nonatomic, copy, readonly) NSString *name;
  @property (nonatomic, assign, readonly) NSUInter age;
  @property (nonatomic, assign, readonly) CYLSex sex;
ç”±äºæ˜¯åªè¯»å±æ€§ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶åˆ›å»ºå¯¹åº”çš„â€œè®¾ç½®æ–¹æ³•â€ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å†™ä¸Šè¿™äº›å±æ€§çš„è¯­ä¹‰ï¼Œä»¥æ­¤è¡¨æ˜åˆå§‹åŒ–æ–¹æ³•åœ¨è®¾ç½®è¿™äº›å±æ€§å€¼æ—¶æ‰€ç”¨çš„æ–¹å¼ã€‚è¦æ˜¯ä¸å†™æ˜è¯­ä¹‰çš„è¯ï¼Œè¯¥ç±»çš„è°ƒç”¨è€…å°±ä¸çŸ¥é“åˆå§‹åŒ–æ–¹æ³•é‡Œä¼šæ‹·è´è¿™äº›å±æ€§ï¼Œä»–ä»¬æœ‰å¯èƒ½ä¼šåœ¨è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰è‡ªè¡Œæ‹·è´å±æ€§å€¼ã€‚è¿™ç§æ“ä½œå¤šä½™è€Œä¸”ä½æ•ˆã€‚
</code></pre></li>
<li><code>initUserModelWithUserName</code>å¦‚æœæ”¹ä¸º<code>initWithName</code>ä¼šæ›´åŠ ç®€æ´ï¼Œè€Œä¸”è¶³å¤Ÿæ¸…æ™°ã€‚</li>
<li><code>UserModel</code>å¦‚æœæ”¹ä¸º<code>User</code>ä¼šæ›´åŠ ç®€æ´ï¼Œè€Œä¸”è¶³å¤Ÿæ¸…æ™°ã€‚</li>
<li><code>UserSex</code>å¦‚æœæ”¹ä¸º<code>Sex</code>ä¼šæ›´åŠ ç®€æ´ï¼Œè€Œä¸”è¶³å¤Ÿæ¸…æ™°ã€‚</li>
</ol>


<h4><strong><em>ç¡¬ä¼¤éƒ¨åˆ†</em></strong></h4>

<ol>
<li>åœ¨-å’Œ(void)ä¹‹é—´åº”è¯¥æœ‰ä¸€ä¸ªç©ºæ ¼</li>
<li>enumä¸­é©¼å³°å‘½åæ³•å’Œä¸‹åˆ’çº¿å‘½åæ³•æ··ç”¨é”™è¯¯ï¼šæšä¸¾ç±»å‹çš„å‘½åè§„åˆ™å’Œå‡½æ•°çš„å‘½åè§„åˆ™ç›¸åŒï¼šå‘½åæ—¶ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œå‹¿ä½¿ç”¨ä¸‹åˆ’çº¿å‘½åæ³•ã€‚</li>
<li>enumå·¦æ‹¬å·å‰åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæˆ–è€…å°†å·¦æ‹¬å·æ¢åˆ°ä¸‹ä¸€è¡Œ</li>
<li>enumå³æ‹¬å·ååŠ ä¸€ä¸ªç©ºæ ¼</li>
<li><code>UserModel :NSObject</code> åº”ä¸º<code>UserModel : NSObject</code>ï¼Œä¹Ÿå°±æ˜¯<code>:</code>å³ä¾§å°‘äº†ä¸€ä¸ªç©ºæ ¼ã€‚</li>
<li>@interfaceä¸@propertyå±æ€§å£°æ˜ä¸­é—´åº”å½“é—´éš”ä¸€è¡Œã€‚</li>
<li>ä¸¤ä¸ªæ–¹æ³•å®šä¹‰ä¹‹é—´ä¸éœ€è¦æ¢è¡Œï¼Œæœ‰æ—¶ä¸ºäº†åŒºåˆ†æ–¹æ³•çš„åŠŸèƒ½ä¹Ÿå¯é—´éš”ä¸€è¡Œï¼Œä½†ç¤ºä¾‹ä»£ç ä¸­é—´éš”äº†ä¸¤è¡Œã€‚</li>
<li><p><code>-(id)initUserModelWithUserName: (NSString*)name withAge:(int)age;</code>æ–¹æ³•ä¸­æ–¹æ³•åä¸å‚æ•°ä¹‹é—´å¤šäº†ç©ºæ ¼ã€‚è€Œä¸”<code>-</code> ä¸<code>(id)</code>ä¹‹é—´å°‘äº†ç©ºæ ¼ã€‚</p></li>
<li><p><code>-(id)initUserModelWithUserName: (NSString*)name withAge:(int)age;</code>æ–¹æ³•ä¸­æ–¹æ³•åä¸å‚æ•°ä¹‹é—´å¤šäº†ç©ºæ ¼ï¼š<code>(NSString*)name</code>å‰å¤šäº†ç©ºæ ¼ã€‚</p></li>
<li><p><code>-(id)initUserModelWithUserName: (NSString*)name withAge:(int)age;</code>æ–¹æ³•ä¸­<code>(NSString*)name</code>,åº”ä¸º<code>(NSString *)name</code>ï¼Œå°‘äº†ç©ºæ ¼ã€‚</p></li>
<li>doLogInæ–¹æ³•å‘½åä¸æ¸…æ™°ï¼šç¬”è€…çŒœæµ‹æ˜¯loginçš„æ„æ€ï¼Œåº”è¯¥æ˜¯ç²—å¿ƒæ‰‹è¯¯é€ æˆçš„ã€‚</li>
<li>ç¬¬äºŒä¸ª@propertyä¸­assignå’Œnonatomicè°ƒæ¢ä½ç½®ã€‚</li>
</ol>


<h3>2. ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Œç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3>

<p>ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿ</p>

<ol>
<li><p>åœ¨ARCä¸­,åœ¨æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨çš„æ—¶å€™,å¾€å¾€è¦é€šè¿‡è®©å…¶ä¸­ä¸€ç«¯ä½¿ç”¨weakæ¥è§£å†³,æ¯”å¦‚:delegateä»£ç†å±æ€§</p></li>
<li><p>è‡ªèº«å·²ç»å¯¹å®ƒè¿›è¡Œä¸€æ¬¡å¼ºå¼•ç”¨,æ²¡æœ‰å¿…è¦å†å¼ºå¼•ç”¨ä¸€æ¬¡,æ­¤æ—¶ä¹Ÿä¼šä½¿ç”¨weak,è‡ªå®šä¹‰IBOutletæ§ä»¶å±æ€§ä¸€èˆ¬ä¹Ÿä½¿ç”¨weakï¼›å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨strongã€‚åœ¨ä¸‹æ–‡ä¹Ÿæœ‰è®ºè¿°ï¼š<strong><em>ã€ŠIBOutletè¿å‡ºæ¥çš„è§†å›¾å±æ€§ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¾ç½®æˆweak?ã€‹</em></strong></p></li>
</ol>


<p>ä¸åŒç‚¹ï¼š</p>

<ol>
<li><p><code>weak</code> æ­¤ç‰¹è´¨è¡¨æ˜è¯¥å±æ€§å®šä¹‰äº†ä¸€ç§â€œéæ‹¥æœ‰å…³ç³»â€ (nonowning relationship)ã€‚ä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œè®¾ç½®æ–¹æ³•æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ã€‚æ­¤ç‰¹è´¨åŒassignç±»ä¼¼ï¼Œ
ç„¶è€Œåœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚
è€Œ <code>assign</code> çš„â€œè®¾ç½®æ–¹æ³•â€åªä¼šæ‰§è¡Œé’ˆå¯¹â€œçº¯é‡ç±»å‹â€ (scalar typeï¼Œä¾‹å¦‚ CGFloat æˆ–
NSlnteger ç­‰)çš„ç®€å•èµ‹å€¼æ“ä½œã€‚</p></li>
<li><p>assigin å¯ä»¥ç”¨éOCå¯¹è±¡,è€Œweakå¿…é¡»ç”¨äºOCå¯¹è±¡</p></li>
</ol>


<h3>3. æ€ä¹ˆç”¨ copy å…³é”®å­—ï¼Ÿ</h3>

<p>ç”¨é€”ï¼š</p>

<ol>
<li>NSStringã€NSArrayã€NSDictionary ç­‰ç­‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œæ˜¯å› ä¸ºä»–ä»¬æœ‰å¯¹åº”çš„å¯å˜ç±»å‹ï¼šNSMutableStringã€NSMutableArrayã€NSMutableDictionaryï¼›</li>
<li>blockä¹Ÿç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œå…·ä½“åŸå› è§<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/WorkingwithBlocks/WorkingwithBlocks.html#//apple_ref/doc/uid/TP40011210-CH8-SW12">å®˜æ–¹æ–‡æ¡£ï¼š<strong><em>Objects Use Properties to Keep Track of Blocks</em></strong></a>ï¼š</li>
</ol>


<p> blockä½¿ç”¨copyæ˜¯ä»MRCé—ç•™ä¸‹æ¥çš„â€œä¼ ç»Ÿâ€,åœ¨MRCä¸­,æ–¹æ³•å†…éƒ¨çš„blockæ˜¯åœ¨æ ˆåŒºçš„,ä½¿ç”¨copyå¯ä»¥æŠŠå®ƒæ”¾åˆ°å †åŒº.åœ¨ARCä¸­å†™ä¸å†™éƒ½è¡Œï¼šå¯¹äºblockä½¿ç”¨copyè¿˜æ˜¯strongæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†å†™ä¸Šcopyä¹Ÿæ— ä¼¤å¤§é›…ï¼Œè¿˜èƒ½æ—¶åˆ»æé†’æˆ‘ä»¬ï¼šç¼–è¯‘å™¨è‡ªåŠ¨å¯¹blockè¿›è¡Œäº†copyæ“ä½œã€‚</p>

<p> <img src="http://i.imgur.com/VlVKl8L.png" alt="enter image description here" /></p>

<p>ä¸‹é¢åšä¸‹è§£é‡Šï¼š
copyæ­¤ç‰¹è´¨æ‰€è¡¨è¾¾çš„æ‰€å±å…³ç³»ä¸strongç±»ä¼¼ã€‚ç„¶è€Œè®¾ç½®æ–¹æ³•å¹¶ä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶â€œæ‹·è´â€ (copy)ã€‚
å½“å±æ€§ç±»å‹ä¸ºNSStringæ—¶ï¼Œç»å¸¸ç”¨æ­¤ç‰¹è´¨æ¥ä¿æŠ¤å…¶å°è£…æ€§ï¼Œå› ä¸ºä¼ é€’ç»™è®¾ç½®æ–¹æ³•çš„æ–°å€¼æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªNSMutableStringç±»çš„å®ä¾‹ã€‚è¿™ä¸ªç±»æ˜¯NSStringçš„å­ç±»ï¼Œè¡¨ç¤ºä¸€ç§å¯ä¿®æ”¹å…¶å€¼çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è‹¥æ˜¯ä¸æ‹·è´å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè®¾ç½®å®Œå±æ€§ä¹‹åï¼Œå­—ç¬¦ä¸²çš„å€¼å°±å¯èƒ½ä¼šåœ¨å¯¹è±¡ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é­äººæ›´æ”¹ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶å°±è¦æ‹·è´ä¸€ä»½â€œä¸å¯å˜â€ (immutable)çš„å­—ç¬¦ä¸²ï¼Œç¡®ä¿å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å€¼ä¸ä¼šæ— æ„é—´å˜åŠ¨ã€‚åªè¦å®ç°å±æ€§æ‰€ç”¨çš„å¯¹è±¡æ˜¯â€œå¯å˜çš„â€ (mutable)ï¼Œå°±åº”è¯¥åœ¨è®¾ç½®æ–°å±æ€§å€¼æ—¶æ‹·è´ä¸€ä»½ã€‚</p>

<blockquote><p>ç”¨@propertyå£°æ˜ NSStringã€NSArrayã€NSDictionary ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œæ˜¯å› ä¸ºä»–ä»¬æœ‰å¯¹åº”çš„å¯å˜ç±»å‹ï¼šNSMutableStringã€NSMutableArrayã€NSMutableDictionaryï¼Œä»–ä»¬ä¹‹é—´å¯èƒ½è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä¸ºç¡®ä¿å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å€¼ä¸ä¼šæ— æ„é—´å˜åŠ¨ï¼Œåº”è¯¥åœ¨è®¾ç½®æ–°å±æ€§å€¼æ—¶æ‹·è´ä¸€ä»½ã€‚</p></blockquote>

<p>è¯¥é—®é¢˜åœ¨ä¸‹æ–‡ä¸­ä¹Ÿæœ‰è®ºè¿°ï¼š<strong><em>ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></strong></p>

<h3>4. è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼š <code>@property (copy) NSMutableArray *array;</code></h3>

<p>ä¸¤ä¸ªé—®é¢˜ï¼š1ã€æ·»åŠ ,åˆ é™¤,ä¿®æ”¹æ•°ç»„å†…çš„å…ƒç´ çš„æ—¶å€™,ç¨‹åºä¼šå› ä¸ºæ‰¾ä¸åˆ°å¯¹åº”çš„æ–¹æ³•è€Œå´©æºƒ.å› ä¸ºcopyå°±æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å¯å˜NSArrayçš„å¯¹è±¡ï¼›2ã€ä½¿ç”¨äº†atomicå±æ€§ä¼šä¸¥é‡å½±å“æ€§èƒ½ ï¼›</p>

<p>ç¬¬1æ¡çš„ç›¸å…³åŸå› åœ¨ä¸‹æ–‡ä¸­æœ‰è®ºè¿°<strong><em>ã€Šç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿã€‹</em></strong> ä»¥åŠä¸Šæ–‡<strong><em>ã€Šæ€ä¹ˆç”¨ copy å…³é”®å­—ï¼Ÿã€‹</em></strong>ä¹Ÿæœ‰è®ºè¿°ã€‚</p>

<p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç å°±ä¼šå‘ç”Ÿå´©æºƒ</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ä¸‹é¢çš„ä»£ç å°±ä¼šå‘ç”Ÿå´©æºƒ

@property (nonatomic, copy) NSMutableArray *mutableArray;



// .mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ä¸‹é¢çš„ä»£ç å°±ä¼šå‘ç”Ÿå´©æºƒ

NSMutableArray *array = [NSMutableArray arrayWithObjects:@1,@2,nil];
self.mutableArray = array;
[self.mutableArray removeObjectAtIndex:0];
</code></pre>

<p>æ¥ä¸‹æ¥å°±ä¼šå¥”æºƒï¼š</p>

<pre><code>-[__NSArrayI removeObjectAtIndex:]: unrecognized selector sent to instance 0x7fcd1bc30460
</code></pre>

<p>ç¬¬2æ¡åŸå› ï¼Œå¦‚ä¸‹ï¼š</p>

<blockquote><p>è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”ï¼Œä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åºï¼Œè¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œé€šè¿‡å£°æ˜nonatomicå¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€ã€‚</p></blockquote>

<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±ç¼–è¯‘å™¨æ‰€åˆæˆçš„æ–¹æ³•ä¼šé€šè¿‡é”å®šæœºåˆ¶ç¡®ä¿å…¶åŸå­æ€§(atomicity)ã€‚å¦‚æœå±æ€§å…·å¤‡nonatomicç‰¹è´¨ï¼Œåˆ™ä¸ä½¿ç”¨åŒæ­¥é”ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ²¡æœ‰åä¸ºâ€œatomicâ€çš„ç‰¹è´¨(å¦‚æœæŸå±æ€§ä¸å…·å¤‡nonatomicç‰¹è´¨ï¼Œé‚£å®ƒå°±æ˜¯â€œåŸå­çš„â€(atomic))ã€‚</p>

<p>åœ¨iOSå¼€å‘ä¸­ï¼Œä½ ä¼šå‘ç°ï¼Œå‡ ä¹æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸ºnonatomicã€‚</p>

<p>ä¸€èˆ¬æƒ…å†µä¸‹å¹¶ä¸è¦æ±‚å±æ€§å¿…é¡»æ˜¯â€œåŸå­çš„â€ï¼Œå› ä¸ºè¿™å¹¶ä¸èƒ½ä¿è¯â€œçº¿ç¨‹å®‰å…¨â€ ( thread safety)ï¼Œè‹¥è¦å®ç°â€œçº¿ç¨‹å®‰å…¨â€çš„æ“ä½œï¼Œè¿˜éœ€é‡‡ç”¨æ›´ä¸ºæ·±å±‚çš„é”å®šæœºåˆ¶æ‰è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è¿ç»­å¤šæ¬¡è¯»å–æŸå±æ€§å€¼çš„è¿‡ç¨‹ä¸­æœ‰åˆ«çš„çº¿ç¨‹åœ¨åŒæ—¶æ”¹å†™è¯¥å€¼ï¼Œé‚£ä¹ˆå³ä¾¿å°†å±æ€§å£°æ˜ä¸ºatomicï¼Œä¹Ÿè¿˜æ˜¯ä¼šè¯»åˆ°ä¸åŒçš„å±æ€§å€¼ã€‚</p>

<p>å› æ­¤ï¼Œå¼€å‘iOSç¨‹åºæ—¶ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨nonatomicå±æ€§ã€‚ä½†æ˜¯åœ¨å¼€å‘Mac OS Xç¨‹åºæ—¶ï¼Œä½¿ç”¨
atomicå±æ€§é€šå¸¸éƒ½ä¸ä¼šæœ‰æ€§èƒ½ç“¶é¢ˆã€‚</p>

<h3>5. å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setterï¼Ÿ</h3>

<blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½ï¼Œåˆ™éœ€å®ç°NSCopyingåè®®ã€‚å¦‚æœè‡ªå®šä¹‰çš„å¯¹è±¡åˆ†ä¸ºå¯å˜ç‰ˆæœ¬ä¸ä¸å¯å˜ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±è¦åŒæ—¶å®ç°NSCopyiogä¸NSMutableCopyingåè®®ã€‚</p></blockquote>

<p>å…·ä½“æ­¥éª¤ï¼š</p>

<ol>
<li>éœ€å£°æ˜è¯¥ç±»éµä»NSCopyingåè®®</li>
<li><p>å®ç°NSCopyingåè®®ã€‚è¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•:</p>

<ul>
<li>(id)copyWithZone: (NSZone*) zone</li>
</ul>
</li>
</ol>


<p>æ³¨æ„ï¼šä¸€æåˆ°è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Œæˆ‘ä»¬æ€»æ˜¯æƒ³è¦†å†™copyæ–¹æ³•ï¼Œå…¶å®çœŸæ­£éœ€è¦å®ç°çš„å´æ˜¯â€œcopyWithZoneâ€æ–¹æ³•ã€‚</p>

<p>ä»¥ç¬¬ä¸€é¢˜çš„ä»£ç ä¸ºä¾‹ï¼š</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ä¿®æ”¹å®Œçš„ä»£ç 

typedef NS_ENUM(NSInteger, CYLSex) {
    CYLSexMan,
    CYLSexWoman
};

@interface CYLUser : NSObject&lt;NSCopying&gt;

@property (nonatomic, copy, readonly) NSString *name;
@property (nonatomic, assign, readonly) NSUInteger age;
@property (nonatomic, assign, readonly) CYLSex sex;

- (instancetype)initWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;
+ (instancetype)userWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;

@end
</code></pre>

<p>ç„¶åå®ç°åè®®ä¸­è§„å®šçš„æ–¹æ³•ï¼š</p>

<pre><code>- (id)copyWithZone:(NSZone *)zone {
    CYLUser *copy = [[[self copy] allocWithZone:zone] 
                     initWithName:_name
                                  age:_age
                                  sex:_sex];
    return copy;
}
</code></pre>

<p>ä½†åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½è¿™ä¹ˆç®€å•ï¼Œé‡åˆ°æ›´å¤æ‚ä¸€ç‚¹ï¼Œæ¯”å¦‚ç±»å¯¹è±¡ä¸­çš„æ•°æ®ç»“æ„å¯èƒ½å¹¶æœªåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è®¾ç½®å¥½ï¼Œéœ€è¦å¦è¡Œè®¾ç½®ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚CYLUserä¸­å«æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œä¸å…¶ä»–CYLUserå¯¹è±¡å»ºç«‹æˆ–è§£é™¤æœ‹å‹å…³ç³»çš„é‚£äº›æ–¹æ³•éƒ½éœ€è¦æ“ä½œè¿™ä¸ªæ•°ç»„ã€‚é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¾—æŠŠè¿™ä¸ªåŒ…å«æœ‹å‹å¯¹è±¡çš„æ•°ç»„ä¹Ÿä¸€å¹¶æ‹·è´è¿‡æ¥ã€‚ä¸‹é¢åˆ—å‡ºäº†å®ç°æ­¤åŠŸèƒ½æ‰€éœ€çš„å…¨éƒ¨ä»£ç :</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// ä»¥ç¬¬ä¸€é¢˜ã€Šé£æ ¼çº é”™é¢˜ã€‹é‡Œçš„ä»£ç ä¸ºä¾‹

typedef NS_ENUM(NSInteger, CYLSex) {
    CYLSexMan,
    CYLSexWoman
};

@interface CYLUser : NSObject&lt;NSCopying&gt;

@property (nonatomic, copy, readonly) NSString *name;
@property (nonatomic, assign, readonly) NSUInteger age;
@property (nonatomic, assign, readonly) CYLSex sex;

- (instancetype)initWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;
+ (instancetype)userWithName:(NSString *)name age:(NSUInteger)age sex:(CYLSex)sex;
- (void)addFriend:(CYLUser *)user;
- (void)removeFriend:(CYLUser *)user;

@end
</code></pre>

<p>// .mæ–‡ä»¶</p>

<pre><code>// .mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// 

@implementation CYLUser {
    NSMutableSet *_friends;
}

- (void)setName:(NSString *)name {
    _name = [name copy];
}

- (instancetype)initWithName:(NSString *)name 
                             age:(NSUInteger)age 
                             sex:(CYLSex)sex {
     if(self = [super init]) {
        _name = [name copy];
        _age = age;
        _sex = sex;
        _friends = [[NSMutableSet alloc] init];
     }
     return self;
}

- (void)addFriend:(CYLUser *)user {
    [_friends addObject:user];
}

- (void)removeFriend:(CYLUser *)user {
    [_friends removeObject:person];
}

- (id)copyWithZone:(NSZone *)zone {
    CYLUser *copy = [[[self copy] allocWithZone:zone] 
                     initWithName:_name
                                  age:_age
                                  sex:_sex];
    copy-&gt;_friends = [_friends mutableCopy];
    return copy;
}

- (id)deepCopy {
    CYLUser *copy = [[[self copy] allocWithZone:zone] 
                     initWithName:_name
                                  age:_age
                                  sex:_sex];
    copy-&gt;_friends = [[NSMutableSet alloc] initWithSet:_friends 
                                             copyItems:YES];
    return copy;
}

@end
</code></pre>

<p>ä»¥ä¸Šåšæ³•èƒ½æ»¡è¶³åŸºæœ¬çš„éœ€æ±‚ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç¼ºé™·ï¼š</p>

<blockquote><p>å¦‚æœä½ æ‰€å†™çš„å¯¹è±¡éœ€è¦æ·±æ‹·è´ï¼Œé‚£ä¹ˆå¯è€ƒè™‘æ–°å¢ä¸€ä¸ªä¸“é—¨æ‰§è¡Œæ·±æ‹·è´çš„æ–¹æ³•ã€‚</p></blockquote>

<p>ã€æ³¨ï¼šæ·±æµ…æ‹·è´çš„æ¦‚å¿µï¼Œåœ¨ä¸‹æ–‡ä¸­æœ‰ä»‹ç»ï¼Œè¯¦è§ä¸‹æ–‡çš„ï¼š<strong><em>ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</em></strong>ã€‘</p>

<p>åœ¨ä¾‹å­ä¸­ï¼Œå­˜æ”¾æœ‹å‹å¯¹è±¡çš„setæ˜¯ç”¨â€œcopyWithZooe:â€æ–¹æ³•æ¥æ‹·è´çš„ï¼Œè¿™ç§æµ…æ‹·è´æ–¹å¼ä¸ä¼šé€ä¸ªå¤åˆ¶setä¸­çš„å…ƒç´ ã€‚è‹¥éœ€è¦æ·±æ‹·è´çš„è¯ï¼Œåˆ™å¯åƒä¸‹é¢è¿™æ ·ï¼Œç¼–å†™ä¸€ä¸ªä¸“ä¾›æ·±æ‹·è´æ‰€ç”¨çš„æ–¹æ³•:</p>

<pre><code>- (id)deepCopy {
    CYLUser *copy = [[[self copy] allocWithZone:zone] 
                     initWithName:_name
                                  age:_age
                                  sex:_sex];
    copy-&gt;_friends = [[NSMutableSet alloc] initWithSet:_friends 
                                             copyItems:YES];
    return copy;
}
</code></pre>

<p>è‡³äº<strong><em>å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</em></strong>è¿™ä¸ªé—®é¢˜ï¼Œ</p>

<p>å¦‚æœæŠ›å¼€æœ¬ä¾‹æ¥å›ç­”çš„è¯ï¼Œå¦‚ä¸‹ï¼š</p>

<pre><code>- (void)setName:(NSString *)name {
    _name = [name copy];
}
</code></pre>

<p>å¦‚æœå•å•å°±ä¸Šæ–‡çš„ä»£ç è€Œè¨€ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¹Ÿä¸èƒ½é‡å†™nameçš„ setter ï¼šç”±äºæ˜¯nameæ˜¯åªè¯»å±æ€§ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸ä¼šä¸ºå…¶åˆ›å»ºå¯¹åº”çš„â€œè®¾ç½®æ–¹æ³•â€ï¼Œç”¨åˆå§‹åŒ–æ–¹æ³•è®¾ç½®å¥½å±æ€§å€¼ä¹‹åï¼Œå°±ä¸èƒ½å†æ”¹å˜äº†ã€‚ï¼ˆ åœ¨æœ¬ä¾‹ä¸­ï¼Œä¹‹æ‰€ä»¥è¿˜è¦å£°æ˜å±æ€§çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€&ndash;copyï¼Œæ˜¯å› ä¸ºï¼šå¦‚æœä¸å†™copyï¼Œè¯¥ç±»çš„è°ƒç”¨è€…å°±ä¸çŸ¥é“åˆå§‹åŒ–æ–¹æ³•é‡Œä¼šæ‹·è´è¿™äº›å±æ€§ï¼Œä»–ä»¬æœ‰å¯èƒ½ä¼šåœ¨è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰è‡ªè¡Œæ‹·è´å±æ€§å€¼ã€‚è¿™ç§æ“ä½œå¤šä½™è€Œä½æ•ˆã€‚ï¼‰ã€‚</p>

<p>é‚£å¦‚ä½•ç¡®ä¿nameè¢«copyï¼Ÿåœ¨åˆå§‹åŒ–æ–¹æ³•(initializer)ä¸­åšï¼š</p>

<pre><code>- (instancetype)initWithName:(NSString *)name 
                             age:(NSUInteger)age 
                             sex:(CYLSex)sex {
     if(self = [super init]) {
        _name = [name copy];
        _age = age;
        _sex = sex;
        _friends = [[NSMutableSet alloc] init];
     }
     return self;
}
</code></pre>

<h3>6. @property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„</h3>

<p><strong>@property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>

<blockquote><p>@property = ivar + getter + setter;</p></blockquote>

<p>ä¸‹é¢è§£é‡Šä¸‹ï¼š</p>

<blockquote><p>â€œå±æ€§â€ (property)æœ‰ä¸¤å¤§æ¦‚å¿µï¼šivarï¼ˆå®ä¾‹å˜é‡ï¼‰ã€å­˜å–æ–¹æ³•ï¼ˆaccess method ï¼ getter + setterï¼‰ã€‚</p></blockquote>

<p>â€œå±æ€§â€ (property)ä½œä¸º Objective-C çš„ä¸€é¡¹ç‰¹æ€§ï¼Œä¸»è¦çš„ä½œç”¨å°±åœ¨äºå°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚ Objective-C å¯¹è±¡é€šå¸¸ä¼šæŠŠå…¶æ‰€éœ€è¦çš„æ•°æ®ä¿å­˜ä¸ºå„ç§å®ä¾‹å˜é‡ã€‚å®ä¾‹å˜é‡ä¸€èˆ¬é€šè¿‡â€œå­˜å–æ–¹æ³•â€(access method)æ¥è®¿é—®ã€‚å…¶ä¸­ï¼Œâ€œè·å–æ–¹æ³•â€ (getter)ç”¨äºè¯»å–å˜é‡å€¼ï¼Œè€Œâ€œè®¾ç½®æ–¹æ³•â€ (setter)ç”¨äºå†™å…¥å˜é‡å€¼ã€‚è¿™ä¸ªæ¦‚å¿µå·²ç»å®šå‹ï¼Œå¹¶ä¸”ç»ç”±â€œå±æ€§â€è¿™ä¸€ç‰¹æ€§è€Œæˆä¸º<code>Objective-C 2.0</code>çš„ä¸€éƒ¨åˆ†ã€‚
è€Œåœ¨æ­£è§„çš„ Objective-C ç¼–ç é£æ ¼ä¸­ï¼Œå­˜å–æ–¹æ³•æœ‰ç€ä¸¥æ ¼çš„å‘½åè§„èŒƒã€‚
æ­£å› ä¸ºæœ‰äº†è¿™ç§ä¸¥æ ¼çš„å‘½åè§„èŒƒï¼Œæ‰€ä»¥ Objective-C è¿™é—¨è¯­è¨€æ‰èƒ½æ ¹æ®åç§°è‡ªåŠ¨åˆ›å»ºå‡ºå­˜å–æ–¹æ³•ã€‚å…¶å®ä¹Ÿå¯ä»¥æŠŠå±æ€§å½“åšä¸€ç§å…³é”®å­—ï¼Œå…¶è¡¨ç¤º:</p>

<blockquote><p>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å†™å‡ºä¸€å¥—å­˜å–æ–¹æ³•ï¼Œç”¨ä»¥è®¿é—®ç»™å®šç±»å‹ä¸­å…·æœ‰ç»™å®šåç§°çš„å˜é‡ã€‚
æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆè¯´ï¼š</p>

<p>@property = getter + setter;</p></blockquote>

<p>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç±»ï¼š</p>

<pre><code>@interface Person : NSObject 
@property NSString *firstName; 
@property NSString *lastName; 
@end 
</code></pre>

<p>ä¸Šè¿°ä»£ç å†™å‡ºæ¥çš„ç±»ä¸ä¸‹é¢è¿™ç§å†™æ³•ç­‰æ•ˆï¼š</p>

<pre><code>@interface Person : NSObject 
- (NSString *)firstName; 
- (void)setFirstName:(NSString *)firstName; 
- (NSString *)lastName; 
- (void)setLastName:(NSString *)lastName; 
@end 
</code></pre>

<p><strong>ivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„?</strong></p>

<blockquote><p>â€œè‡ªåŠ¨åˆæˆâ€( autosynthesis)</p></blockquote>

<p>å®Œæˆå±æ€§å®šä¹‰åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç¼–å†™è®¿é—®è¿™äº›å±æ€§æ‰€éœ€çš„æ–¹æ³•ï¼Œæ­¤è¿‡ç¨‹å«åšâ€œè‡ªåŠ¨åˆæˆâ€( autosynthesis)ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±ç¼–è¯‘
å™¨åœ¨ç¼–è¯‘æœŸæ‰§è¡Œï¼Œæ‰€ä»¥ç¼–è¾‘å™¨é‡Œçœ‹ä¸åˆ°è¿™äº›â€œåˆæˆæ–¹æ³•â€(synthesized method)çš„æºä»£ç ã€‚é™¤äº†ç”Ÿæˆæ–¹æ³•ä»£ç  getterã€setter ä¹‹å¤–ï¼Œç¼–è¯‘å™¨è¿˜è¦è‡ªåŠ¨å‘ç±»ä¸­æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œå¹¶ä¸”åœ¨å±æ€§åå‰é¢åŠ ä¸‹åˆ’çº¿ï¼Œä»¥æ­¤ä½œä¸ºå®ä¾‹å˜é‡çš„åå­—ã€‚åœ¨å‰ä¾‹ä¸­ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªå®ä¾‹å˜é‡ï¼Œå…¶åç§°åˆ†åˆ«ä¸º
<code>_firstName</code>ä¸<code>_lastName</code>ã€‚ä¹Ÿå¯ä»¥åœ¨ç±»çš„å®ç°ä»£ç é‡Œé€šè¿‡
@synthesizeè¯­æ³•æ¥æŒ‡å®šå®ä¾‹å˜é‡çš„åå­—.</p>

<pre><code>@implementation Person 
@synthesize firstName = _myFirstName; 
@synthesize lastName = myLastName; 
@end 
</code></pre>

<p>æˆ‘ä¸ºäº†ææ¸…å±æ€§æ˜¯æ€ä¹ˆå®ç°çš„,æ›¾ç»åç¼–è¯‘è¿‡ç›¸å…³çš„ä»£ç ,ä»–å¤§è‡´ç”Ÿæˆäº†äº”ä¸ªä¸œè¥¿</p>

<ol>
<li><code>OBJC_IVAR_$ç±»å$å±æ€§åç§°</code> ï¼šè¯¥å±æ€§çš„â€œåç§»é‡â€ (offset)ï¼Œè¿™ä¸ªåç§»é‡æ˜¯â€œç¡¬ç¼–ç â€ (hardcode)ï¼Œè¡¨ç¤ºè¯¥å˜é‡è·ç¦»å­˜æ”¾å¯¹è±¡çš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€æœ‰å¤šè¿œã€‚</li>
<li>setterä¸getteræ–¹æ³•å¯¹åº”çš„å®ç°å‡½æ•°</li>
<li><code>ivar_list</code> ï¼šæˆå‘˜å˜é‡åˆ—è¡¨</li>
<li><code>method_list</code> ï¼šæ–¹æ³•åˆ—è¡¨</li>
<li><code>prop_list</code> ï¼šå±æ€§åˆ—è¡¨</li>
</ol>


<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¯æ¬¡åœ¨å¢åŠ ä¸€ä¸ªå±æ€§,ç³»ç»Ÿéƒ½ä¼šåœ¨<code>ivar_list</code>ä¸­æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡çš„æè¿°,åœ¨<code>method_list</code>ä¸­å¢åŠ setterä¸getteræ–¹æ³•çš„æè¿°,åœ¨å±æ€§åˆ—è¡¨ä¸­å¢åŠ ä¸€ä¸ªå±æ€§çš„æè¿°,ç„¶åè®¡ç®—è¯¥å±æ€§åœ¨å¯¹è±¡ä¸­çš„åç§»é‡,ç„¶åç»™å‡ºsetterä¸getteræ–¹æ³•å¯¹åº”çš„å®ç°,åœ¨setteræ–¹æ³•ä¸­ä»åç§»é‡çš„ä½ç½®å¼€å§‹èµ‹å€¼,åœ¨getteræ–¹æ³•ä¸­ä»åç§»é‡å¼€å§‹å–å€¼,ä¸ºäº†èƒ½å¤Ÿè¯»å–æ­£ç¡®å­—èŠ‚æ•°,ç³»ç»Ÿå¯¹è±¡åç§»é‡çš„æŒ‡é’ˆç±»å‹è¿›è¡Œäº†ç±»å‹å¼ºè½¬.</p>

<h3>7. @protocol å’Œ category ä¸­å¦‚ä½•ä½¿ç”¨ @property</h3>

<ol>
<li>åœ¨protocolä¸­ä½¿ç”¨propertyåªä¼šç”Ÿæˆsetterå’Œgetteræ–¹æ³•å£°æ˜,æˆ‘ä»¬ä½¿ç”¨å±æ€§çš„ç›®çš„,æ˜¯å¸Œæœ›éµå®ˆæˆ‘åè®®çš„å¯¹è±¡èƒ½å®ç°è¯¥å±æ€§</li>
<li><p>category ä½¿ç”¨ @property ä¹Ÿæ˜¯åªä¼šç”Ÿæˆsetterå’Œgetteræ–¹æ³•çš„å£°æ˜,å¦‚æœæˆ‘ä»¬çœŸçš„éœ€è¦ç»™categoryå¢åŠ å±æ€§çš„å®ç°,éœ€è¦å€ŸåŠ©äºè¿è¡Œæ—¶çš„ä¸¤ä¸ªå‡½æ•°ï¼š</p></li>
<li><p><code>objc_setAssociatedObject</code></p></li>
<li><code>objc_getAssociatedObject</code></li>
</ol>


<h3>8. runtime å¦‚ä½•å®ç° weak å±æ€§</h3>

<p>è¦å®ç°weakå±æ€§ï¼Œé¦–å…ˆè¦ææ¸…æ¥šweakå±æ€§çš„ç‰¹ç‚¹ï¼š</p>

<blockquote><p>weak æ­¤ç‰¹è´¨è¡¨æ˜è¯¥å±æ€§å®šä¹‰äº†ä¸€ç§â€œéæ‹¥æœ‰å…³ç³»â€ (nonowning relationship)ã€‚ä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œè®¾ç½®æ–¹æ³•æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ã€‚æ­¤ç‰¹è´¨åŒassignç±»ä¼¼ï¼Œ ç„¶è€Œåœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚</p></blockquote>

<p>é‚£ä¹ˆruntimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ</p>

<blockquote><p>runtime å¯¹æ³¨å†Œçš„ç±»ï¼Œ ä¼šè¿›è¡Œå¸ƒå±€ï¼Œå¯¹äº weak å¯¹è±¡ä¼šæ”¾å…¥ä¸€ä¸ª hash è¡¨ä¸­ã€‚ ç”¨ weak æŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€ä½œä¸º keyï¼Œå½“æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ä¼š deallocï¼Œå‡å¦‚ weak æŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯aï¼Œé‚£ä¹ˆå°±ä¼šä»¥aä¸ºé”®ï¼Œ åœ¨è¿™ä¸ª weak è¡¨ä¸­æœç´¢ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»¥aä¸ºé”®çš„ weak å¯¹è±¡ï¼Œä»è€Œè®¾ç½®ä¸º nilã€‚</p></blockquote>

<p>æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼ˆä¼ªä»£ç ï¼‰æ¥è¡¨ç¤ºä¸Šè¿°æœºåˆ¶ï¼š</p>

<p><code>objc_storeWeak(&amp;a, b)</code>å‡½æ•°ï¼š</p>

<p><code>objc_storeWeak</code>å‡½æ•°æŠŠç¬¬äºŒä¸ªå‚æ•°&ndash;èµ‹å€¼å¯¹è±¡ï¼ˆbï¼‰çš„å†…å­˜åœ°å€ä½œä¸ºé”®å€¼keyï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°&ndash;weakä¿®é¥°çš„å±æ€§å˜é‡ï¼ˆaï¼‰çš„å†…å­˜åœ°å€ï¼ˆ&amp;aï¼‰ä½œä¸ºvalueï¼Œæ³¨å†Œåˆ° weak è¡¨ä¸­ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ï¼ˆbï¼‰ä¸º0ï¼ˆnilï¼‰ï¼Œé‚£ä¹ˆæŠŠå˜é‡ï¼ˆaï¼‰çš„å†…å­˜åœ°å€ï¼ˆ&amp;aï¼‰ä»weakè¡¨ä¸­åˆ é™¤ï¼Œ</p>

<p>ä½ å¯ä»¥æŠŠ<code>objc_storeWeak(&amp;a, b)</code>ç†è§£ä¸ºï¼š<code>objc_storeWeak(value, key)</code>ï¼Œå¹¶ä¸”å½“keyå˜nilï¼Œå°†valueç½®nilã€‚</p>

<p>åœ¨bénilæ—¶ï¼Œaå’ŒbæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåœ¨bå˜nilæ—¶ï¼Œaå˜nilã€‚æ­¤æ—¶å‘aå‘é€æ¶ˆæ¯ä¸ä¼šå´©æºƒï¼šåœ¨Objective-Cä¸­å‘nilå‘é€æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚</p>

<p>è€Œå¦‚æœaæ˜¯ç”±assignä¿®é¥°çš„ï¼Œåˆ™ï¼š
åœ¨bénilæ—¶ï¼Œaå’ŒbæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåœ¨bå˜nilæ—¶ï¼Œaè¿˜æ˜¯æŒ‡å‘è¯¥å†…å­˜åœ°å€ï¼Œå˜é‡æŒ‡é’ˆã€‚æ­¤æ—¶å‘aå‘é€æ¶ˆæ¯ææ˜“å´©æºƒã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬å°†åŸºäº<code>objc_storeWeak(&amp;a, b)</code>å‡½æ•°ï¼Œä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿâ€œruntimeå¦‚ä½•å®ç°weakå±æ€§â€ï¼š</p>

<pre><code>// ä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿï¼šruntimeå¦‚ä½•å®ç°weakå±æ€§
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong

 id obj1;
 objc_initWeak(&amp;obj1, obj);
/*objå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œå˜é‡ä½œç”¨åŸŸç»“æŸ*/
 objc_destroyWeak(&amp;obj1);
</code></pre>

<p>ä¸‹é¢å¯¹ç”¨åˆ°çš„ä¸¤ä¸ªæ–¹æ³•<code>objc_initWeak</code>å’Œ<code>objc_destroyWeak</code>åšä¸‹è§£é‡Šï¼š</p>

<p>æ€»ä½“è¯´æ¥ï¼Œä½œç”¨æ˜¯ï¼š
é€šè¿‡<code>objc_initWeak</code>å‡½æ•°åˆå§‹åŒ–â€œé™„æœ‰weakä¿®é¥°ç¬¦çš„å˜é‡ï¼ˆobj1ï¼‰â€ï¼Œåœ¨å˜é‡ä½œç”¨åŸŸç»“æŸæ—¶é€šè¿‡<code>objc_destoryWeak</code>å‡½æ•°é‡Šæ”¾è¯¥å˜é‡ï¼ˆobj1ï¼‰ã€‚</p>

<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹æ–¹æ³•çš„å†…éƒ¨å®ç°ï¼š</p>

<p><code>objc_initWeak</code>å‡½æ•°çš„å®ç°æ˜¯è¿™æ ·çš„ï¼šåœ¨å°†â€œé™„æœ‰weakä¿®é¥°ç¬¦çš„å˜é‡ï¼ˆobj1ï¼‰â€åˆå§‹åŒ–ä¸º0ï¼ˆnilï¼‰åï¼Œä¼šå°†â€œèµ‹å€¼å¯¹è±¡â€ï¼ˆobjï¼‰ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨<code>objc_storeWeak</code>å‡½æ•°ã€‚</p>

<pre><code>obj1 = 0ï¼›
obj_storeWeak(&amp;obj1, obj);
</code></pre>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>

<blockquote><p> weak ä¿®é¥°çš„æŒ‡é’ˆé»˜è®¤å€¼æ˜¯ nil ï¼ˆåœ¨Objective-Cä¸­å‘nilå‘é€æ¶ˆæ¯æ˜¯å®‰å…¨çš„ï¼‰</p></blockquote>

<p>ç„¶å<code>obj_destroyWeak</code>å‡½æ•°å°†0ï¼ˆnilï¼‰ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨<code>objc_storeWeak</code>å‡½æ•°ã€‚</p>

<p><code>objc_storeWeak(&amp;obj1, 0);</code></p>

<p>å‰é¢çš„æºä»£ç ä¸ä¸‹åˆ—æºä»£ç ç›¸åŒã€‚</p>

<pre><code>// ä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿï¼šruntimeå¦‚ä½•å®ç°weakå±æ€§
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong

id obj1;
obj1 = 0;
objc_storeWeak(&amp;obj1, obj);
/* ... objçš„å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œè¢«ç½®nil ... */
objc_storeWeak(&amp;obj1, 0);
</code></pre>

<p><code>objc_storeWeak</code>å‡½æ•°æŠŠç¬¬äºŒä¸ªå‚æ•°&ndash;èµ‹å€¼å¯¹è±¡ï¼ˆobjï¼‰çš„å†…å­˜åœ°å€ä½œä¸ºé”®å€¼ï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°&ndash;weakä¿®é¥°çš„å±æ€§å˜é‡ï¼ˆobj1ï¼‰çš„å†…å­˜åœ°å€æ³¨å†Œåˆ° weak è¡¨ä¸­ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ï¼ˆobjï¼‰ä¸º0ï¼ˆnilï¼‰ï¼Œé‚£ä¹ˆæŠŠå˜é‡ï¼ˆobj1ï¼‰çš„åœ°å€ä»weakè¡¨ä¸­åˆ é™¤ï¼Œåœ¨åé¢çš„ç›¸å…³ä¸€é¢˜ä¼šè¯¦è§£ã€‚</p>

<p>ä½¿ç”¨ä¼ªä»£ç æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬â€œçœŸæªå®å¼¹â€åœ°å®ç°ä¸‹ï¼š</p>

<blockquote><p>å¦‚ä½•è®©ä¸ä½¿ç”¨weakä¿®é¥°çš„@propertyï¼Œæ‹¥æœ‰weakçš„æ•ˆæœã€‚</p></blockquote>

<p>æˆ‘ä»¬ä»setteræ–¹æ³•å…¥æ‰‹ï¼š</p>

<pre><code>- (void)setObject:(NSObject *)object
{
    objc_setAssociatedObject(self, "object", object, OBJC_ASSOCIATION_ASSIGN);
    [object cyl_runAtDealloc:^{
        _object = nil;
    }];
}
</code></pre>

<p>ä¹Ÿå°±æ˜¯æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š</p>

<ol>
<li><p>åœ¨setteræ–¹æ³•ä¸­åšå¦‚ä¸‹è®¾ç½®ï¼š</p>

<pre><code>objc_setAssociatedObject(self, "object", object, OBJC_ASSOCIATION_ASSIGN);
</code></pre></li>
<li><p>åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚åšåˆ°è¿™ç‚¹ï¼ŒåŒæ ·è¦å€ŸåŠ©runtimeï¼š</p>

<p>//è¦é”€æ¯çš„ç›®æ ‡å¯¹è±¡
id objectToBeDeallocated;
//å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œäº‹ä»¶â€ï¼šå½“ä¸Šé¢çš„ç›®æ ‡å¯¹è±¡é”€æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„â€œäº‹ä»¶â€ã€‚
id objectWeWantToBeReleasedWhenThatHappens;
objc_setAssociatedObject(objectToBeDeallocted,
                         someUniqueKey,
                         objectWeWantToBeReleasedWhenThatHappens,
                         OBJC_ASSOCIATION_RETAIN);</p></li>
</ol>


<p>çŸ¥é“äº†æ€è·¯ï¼Œæˆ‘ä»¬å°±å¼€å§‹å®ç°<code>cyl_runAtDealloc</code>æ–¹æ³•ï¼Œå®ç°è¿‡ç¨‹åˆ†ä¸¤éƒ¨åˆ†ï¼š</p>

<p>ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºä¸€ä¸ªç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œäº‹ä»¶â€ï¼šå½“ç›®æ ‡å¯¹è±¡é”€æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„â€œäº‹ä»¶â€ã€‚å€ŸåŠ©blockæ‰§è¡Œâ€œäº‹ä»¶â€ã€‚</p>

<pre><code>// .hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// è¿™ä¸ªç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œäº‹ä»¶â€ï¼šå½“ç›®æ ‡å¯¹è±¡é”€æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„â€œäº‹ä»¶â€ã€‚å€ŸåŠ©blockæ‰§è¡Œâ€œäº‹ä»¶â€ã€‚

typedef void (^voidBlock)(void);

@interface CYLBlockExecutor : NSObject 

- (id)initWithBlock:(voidBlock)block;

@end


// .mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// è¿™ä¸ªç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œäº‹ä»¶â€ï¼šå½“ç›®æ ‡å¯¹è±¡é”€æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„â€œäº‹ä»¶â€ã€‚å€ŸåŠ©blockæ‰§è¡Œâ€œäº‹ä»¶â€ã€‚

#import "CYLBlockExecutor.h"

@interface CYLBlockExecutor() {
    voidBlock _block;
}
@implementation CYLBlockExecutor

- (id)initWithBlock:(voidBlock)aBlock
{
    self = [super init];

    if (self) {
        _block = [aBlock copy];
    }

    return self;
}

- (void)dealloc
{
    _block ? _block() : nil;
}

@end
</code></pre>

<p>ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒä»£ç ï¼šåˆ©ç”¨runtimeå®ç°<code>cyl_runAtDealloc</code>æ–¹æ³•</p>

<pre><code>// CYLNSObject+RunAtDealloc.hæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// åˆ©ç”¨runtimeå®ç°cyl_runAtDeallocæ–¹æ³•

#import "CYLBlockExecutor.h"

const void *runAtDeallocBlockKey = &amp;runAtDeallocBlockKey;

@interface NSObject (CYLRunAtDealloc)

- (void)cyl_runAtDealloc:(voidBlock)block;

@end


// CYLNSObject+RunAtDealloc.mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong
// åˆ©ç”¨runtimeå®ç°cyl_runAtDeallocæ–¹æ³•

#import "CYLNSObject+RunAtDealloc.h"
#import "CYLBlockExecutor.h"

@implementation NSObject (CYLRunAtDealloc)

- (void)cyl_runAtDealloc:(voidBlock)block
{
    if (block) {
        CYLBlockExecutor *executor = [[CYLBlockExecutor alloc] initWithBlock:block];

        objc_setAssociatedObject(self,
                                 runAtDeallocBlockKey,
                                 executor,
                                 OBJC_ASSOCIATION_RETAIN);
    }
}

@end
</code></pre>

<p>ä½¿ç”¨æ–¹æ³•ï¼š
å¯¼å…¥</p>

<pre><code>#import "CYLNSObject+RunAtDealloc.h"
</code></pre>

<p>ç„¶åå°±å¯ä»¥ä½¿ç”¨äº†ï¼š</p>

<pre><code>    NSObject *foo = [[NSObject alloc] init];

    [foo cyl_runAtDealloc:^{
        NSLog(@"æ­£åœ¨é‡Šæ”¾foo!");
    }];
</code></pre>

<p>å¦‚æœå¯¹<code>cyl_runAtDealloc</code>çš„å®ç°åŸç†æœ‰å…´è¶£ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡åšæ–‡ <a href="http://stackoverflow.com/a/31560217/3395008"><strong><em>Fun With the Objective-C Runtime: Run Code at Deallocation of Any Object</em></strong></a></p>

<h3>9. @propertyä¸­æœ‰å“ªäº›å±æ€§å…³é”®å­—ï¼Ÿ/ @property åé¢å¯ä»¥æœ‰å“ªäº›ä¿®é¥°ç¬¦ï¼Ÿ</h3>

<p>å±æ€§å¯ä»¥æ‹¥æœ‰çš„ç‰¹è´¨åˆ†ä¸ºå››ç±»:</p>

<ol>
<li><p>åŸå­æ€§&mdash;<code>nonatomic</code>ç‰¹è´¨</p>

<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±ç¼–è¯‘å™¨åˆæˆçš„æ–¹æ³•ä¼šé€šè¿‡é”å®šæœºåˆ¶ç¡®ä¿å…¶åŸå­æ€§(atomicity)ã€‚å¦‚æœå±æ€§å…·å¤‡nonatomicç‰¹è´¨ï¼Œåˆ™ä¸ä½¿ç”¨åŒæ­¥é”ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡æ²¡æœ‰åä¸ºâ€œatomicâ€çš„ç‰¹è´¨(å¦‚æœæŸå±æ€§ä¸å…·å¤‡nonatomicç‰¹è´¨ï¼Œé‚£å®ƒå°±æ˜¯â€œåŸå­çš„â€ ( atomic) )ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥åœ¨å±æ€§ç‰¹è´¨ä¸­å†™æ˜è¿™ä¸€ç‚¹ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ã€‚è‹¥æ˜¯è‡ªå·±å®šä¹‰å­˜å–æ–¹æ³•ï¼Œé‚£ä¹ˆå°±åº”è¯¥éµä»ä¸å±æ€§ç‰¹è´¨ç›¸ç¬¦çš„åŸå­æ€§ã€‚</p></li>
<li><p>è¯»/å†™æƒé™&mdash;<code>readwrite(è¯»å†™)</code>ã€<code>readooly (åªè¯»)</code></p></li>
<li>å†…å­˜ç®¡ç†è¯­ä¹‰&mdash;<code>assign</code>ã€<code>strong</code>ã€ <code>weak</code>ã€<code>unsafe_unretained</code>ã€<code>copy</code></li>
<li>æ–¹æ³•å&mdash;<code>getter=&lt;name&gt;</code> ã€<code>setter=&lt;name&gt;</code></li>
</ol>


<p>  <code>getter=&lt;name&gt;</code>çš„æ ·å¼ï¼š</p>

<pre><code>    @property (nonatomic, getter=isOn) BOOL on;
</code></pre>

<p>ï¼ˆ <code>setter=&lt;name&gt;</code>è¿™ç§ä¸å¸¸ç”¨ï¼Œä¹Ÿä¸æ¨èä½¿ç”¨ã€‚æ•…ä¸åœ¨è¿™é‡Œç»™å‡ºå†™æ³•ã€‚ï¼‰
 3. ä¸å¸¸ç”¨çš„ï¼š<code>nonnull</code>,<code>null_resettable</code>,<code>nullable</code></p>

<h3>10. weakå±æ€§éœ€è¦åœ¨deallocä¸­ç½®nilä¹ˆï¼Ÿ</h3>

<p>ä¸éœ€è¦ã€‚</p>

<blockquote><p>åœ¨ARCç¯å¢ƒæ— è®ºæ˜¯å¼ºæŒ‡é’ˆè¿˜æ˜¯å¼±æŒ‡é’ˆéƒ½æ— éœ€åœ¨ dealloc è®¾ç½®ä¸º nil ï¼Œ ARC ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†</p></blockquote>

<p>å³ä¾¿æ˜¯ç¼–è¯‘å™¨ä¸å¸®æˆ‘ä»¬åšè¿™äº›ï¼Œweakä¹Ÿä¸éœ€è¦åœ¨deallocä¸­ç½®nilï¼š</p>

<p>æ­£å¦‚ä¸Šæ–‡çš„ï¼š<strong><em>runtime å¦‚ä½•å®ç° weak å±æ€§</em></strong> ä¸­æåˆ°çš„ï¼š</p>

<p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸‹weakçš„setteræ–¹æ³•ï¼Œåº”è¯¥å¦‚ä¸‹ï¼š</p>

<pre><code>- (void)setObject:(NSObject *)object
{
    objc_setAssociatedObject(self, "object", object, OBJC_ASSOCIATION_ASSIGN);
    [object cyl_runAtDealloc:^{
        _object = nil;
    }];
}
</code></pre>

<p>ä¹Ÿå³:</p>

<blockquote><p>åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚</p></blockquote>

<h3>11. @synthesizeå’Œ@dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3>

<ol>
<li>@propertyæœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯ï¼Œä¸€ä¸ªæ˜¯@synthesizeï¼Œä¸€ä¸ªæ˜¯@dynamicã€‚å¦‚æœ@synthesizeå’Œ@dynamicéƒ½æ²¡å†™ï¼Œé‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<code>@syntheszie var = _var;</code></li>
<li>@synthesizeçš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç°setteræ–¹æ³•å’Œgetteræ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</li>
<li>@dynamicå‘Šè¯‰ç¼–è¯‘å™¨ï¼šå±æ€§çš„setterä¸getteræ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ï¼ˆå½“ç„¶å¯¹äºreadonlyçš„å±æ€§åªéœ€æä¾›getterå³å¯ï¼‰ã€‚å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼Œç„¶åä½ æ²¡æœ‰æä¾›@setteræ–¹æ³•å’Œ@getteræ–¹æ³•ï¼Œç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ°<code>instance.var = someVar</code>ï¼Œç”±äºç¼ºsetteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼›æˆ–è€…å½“è¿è¡Œåˆ° <code>someVar = var</code>æ—¶ï¼Œç”±äºç¼ºgetteræ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ç¼–è¯‘æ—¶æ²¡é—®é¢˜ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ç»‘å®šã€‚</li>
</ol>


<h3>12. ARCä¸‹ï¼Œä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶ï¼Œé»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ</h3>

<ol>
<li>å¯¹åº”åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å…³é”®å­—æ˜¯</li>
</ol>


<p> atomic,readwrite,assign
 2. å¯¹äºæ™®é€šçš„OCå¯¹è±¡</p>

<p> atomic,readwrite,strong</p>

<p>å‚è€ƒé“¾æ¥ï¼š</p>

<ol>
<li><p><a href="http://stackoverflow.com/a/15541801/3395008"> <strong><em>Objective-C ARC: strong vs retain and weak vs assign</em></strong> </a></p></li>
<li><p><a href="http://rdcworld-iphone.blogspot.in/2012/12/variable-property-attributes-or.html"> <strong><em>Variable property attributes or Modifiers in iOS</em></strong> </a></p></li>
</ol>


<h3>13. ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>

<ol>
<li>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</li>
<li>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</li>
</ol>


<p>copyæ­¤ç‰¹è´¨æ‰€è¡¨è¾¾çš„æ‰€å±å…³ç³»ä¸strongç±»ä¼¼ã€‚ç„¶è€Œè®¾ç½®æ–¹æ³•å¹¶ä¸ä¿ç•™æ–°å€¼ï¼Œè€Œæ˜¯å°†å…¶â€œæ‹·è´â€ (copy)ã€‚
å½“å±æ€§ç±»å‹ä¸ºNSStringæ—¶ï¼Œç»å¸¸ç”¨æ­¤ç‰¹è´¨æ¥ä¿æŠ¤å…¶å°è£…æ€§ï¼Œå› ä¸ºä¼ é€’ç»™è®¾ç½®æ–¹æ³•çš„æ–°å€¼æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªNSMutableStringç±»çš„å®ä¾‹ã€‚è¿™ä¸ªç±»æ˜¯NSStringçš„å­ç±»ï¼Œè¡¨ç¤ºä¸€ç§å¯ä¿®æ”¹å…¶å€¼çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è‹¥æ˜¯ä¸æ‹·è´å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè®¾ç½®å®Œå±æ€§ä¹‹åï¼Œå­—ç¬¦ä¸²çš„å€¼å°±å¯èƒ½ä¼šåœ¨å¯¹è±¡ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹é­äººæ›´æ”¹ã€‚æ‰€ä»¥ï¼Œè¿™æ—¶å°±è¦æ‹·è´ä¸€ä»½â€œä¸å¯å˜â€ (immutable)çš„å­—ç¬¦ä¸²ï¼Œç¡®ä¿å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å€¼ä¸ä¼šæ— æ„é—´å˜åŠ¨ã€‚åªè¦å®ç°å±æ€§æ‰€ç”¨çš„å¯¹è±¡æ˜¯â€œå¯å˜çš„â€ (mutable)ï¼Œå°±åº”è¯¥åœ¨è®¾ç½®æ–°å±æ€§å€¼æ—¶æ‹·è´ä¸€ä»½ã€‚</p>

<p>ä¸ºäº†ç†è§£è¿™ç§åšæ³•ï¼Œé¦–å…ˆè¦çŸ¥é“ï¼Œå¯¹éé›†åˆç±»å¯¹è±¡çš„copyæ“ä½œï¼š</p>

<p>åœ¨éé›†åˆç±»å¯¹è±¡ä¸­ï¼šå¯¹immutableå¯¹è±¡è¿›è¡Œcopyæ“ä½œï¼Œæ˜¯æŒ‡é’ˆå¤åˆ¶ï¼ŒmutableCopyæ“ä½œæ—¶å†…å®¹å¤åˆ¶ï¼›å¯¹mutableå¯¹è±¡è¿›è¡Œcopyå’ŒmutableCopyéƒ½æ˜¯å†…å®¹å¤åˆ¶ã€‚ç”¨ä»£ç ç®€å•è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>

<ul>
<li>[immutableObject copy] // æµ…å¤åˆ¶</li>
<li>[immutableObject mutableCopy] //æ·±å¤åˆ¶</li>
<li>[mutableObject copy] //æ·±å¤åˆ¶</li>
<li>[mutableObject mutableCopy] //æ·±å¤åˆ¶</li>
</ul>


<p>æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p>

<pre><code>NSMutableString *string = [NSMutableString stringWithString:@"origin"];//copy
NSString *stringCopy = [string copy]; 
</code></pre>

<p>æŸ¥çœ‹å†…å­˜ï¼Œä¼šå‘ç° stringã€stringCopy å†…å­˜åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œè¯´æ˜æ­¤æ—¶éƒ½æ˜¯åšå†…å®¹æ‹·è´ã€æ·±æ‹·è´ã€‚å³ä½¿ä½ è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>

<pre><code>[string appendString:@"origion!"]
</code></pre>

<p>stringCopyçš„å€¼ä¹Ÿä¸ä¼šå› æ­¤æ”¹å˜ï¼Œä½†æ˜¯å¦‚æœä¸ä½¿ç”¨copyï¼ŒstringCopyçš„å€¼å°±ä¼šè¢«æ”¹å˜ã€‚
  é›†åˆç±»å¯¹è±¡ä»¥æ­¤ç±»æ¨ã€‚
æ‰€ä»¥ï¼Œ</p>

<blockquote><p>ç”¨@propertyå£°æ˜ NSStringã€NSArrayã€NSDictionary ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œæ˜¯å› ä¸ºä»–ä»¬æœ‰å¯¹åº”çš„å¯å˜ç±»å‹ï¼šNSMutableStringã€NSMutableArrayã€NSMutableDictionaryï¼Œä»–ä»¬ä¹‹é—´å¯èƒ½è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä¸ºç¡®ä¿å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å€¼ä¸ä¼šæ— æ„é—´å˜åŠ¨ï¼Œåº”è¯¥åœ¨è®¾ç½®æ–°å±æ€§å€¼æ—¶æ‹·è´ä¸€ä»½ã€‚</p></blockquote>

<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.zybuluo.com/MicroCai/note/50592">iOS é›†åˆçš„æ·±å¤åˆ¶ä¸æµ…å¤åˆ¶</a></p>

<h3>14. @synthesizeåˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿå‡å¦‚propertyåä¸ºfooï¼Œå­˜åœ¨ä¸€ä¸ªåä¸º<code>_foo</code>çš„å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿˜ä¼šè‡ªåŠ¨åˆæˆæ–°å˜é‡ä¹ˆï¼Ÿ</h3>

<p>åœ¨å›ç­”ä¹‹å‰å…ˆè¯´æ˜ä¸‹ä¸€ä¸ªæ¦‚å¿µï¼š</p>

<blockquote><p>å®ä¾‹å˜é‡ = æˆå‘˜å˜é‡ ï¼ ivar</p></blockquote>

<p>è¿™äº›è¯´æ³•ï¼Œç¬”è€…ä¸‹æ–‡ä¸­ï¼Œå¯èƒ½éƒ½ä¼šç”¨åˆ°ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚</p>

<p>æ­£å¦‚
<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/EncapsulatingData/EncapsulatingData.html#//apple_ref/doc/uid/TP40011210-CH5-SW6">Appleå®˜æ–¹æ–‡æ¡£ <strong><em>You Can Customize Synthesized Instance Variable Names</em></strong></a> æ‰€è¯´ï¼š
<img src="http://i.imgur.com/D6d0zGJ.png" alt="enter image description here" /></p>

<p>å¦‚æœä½¿ç”¨äº†å±æ€§çš„è¯ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨ç¼–å†™è®¿é—®å±æ€§æ‰€éœ€çš„æ–¹æ³•ï¼Œæ­¤è¿‡ç¨‹å«åšâ€œè‡ªåŠ¨åˆæˆâ€( auto synthesis)ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸæ‰§è¡Œï¼Œæ‰€ä»¥ç¼–è¾‘å™¨é‡Œçœ‹ä¸åˆ°è¿™äº›â€œåˆæˆæ–¹æ³•â€ (synthesized method)çš„æºä»£ç ã€‚é™¤äº†ç”Ÿæˆæ–¹æ³•ä»£ç ä¹‹å¤–ï¼Œç¼–è¯‘å™¨è¿˜è¦è‡ªåŠ¨å‘ç±»ä¸­æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ï¼Œå¹¶ä¸”åœ¨å±æ€§åå‰é¢åŠ ä¸‹åˆ’çº¿ï¼Œä»¥æ­¤ä½œä¸ºå®ä¾‹å˜é‡çš„åå­—ã€‚</p>

<pre><code>@interface CYLPerson : NSObject 
@property NSString *firstName; 
@property NSString *lastName; 
@end
</code></pre>

<p>åœ¨ä¸Šä¾‹ä¸­ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªå®ä¾‹å˜é‡ï¼Œå…¶åç§°åˆ†åˆ«ä¸º
<code>_firstName</code>ä¸<code>_lastName</code>ã€‚ä¹Ÿå¯ä»¥åœ¨ç±»çš„å®ç°ä»£ç é‡Œé€šè¿‡<code>@synthesize</code>è¯­æ³•æ¥æŒ‡å®šå®ä¾‹å˜é‡çš„åå­—:</p>

<pre><code>@implementation CYLPerson 
@synthesize firstName = _myFirstName; 
@synthesize lastName = _myLastName; 
@end 
</code></pre>

<p>ä¸Šè¿°è¯­æ³•ä¼šå°†ç”Ÿæˆçš„å®ä¾‹å˜é‡å‘½åä¸º<code>_myFirstName</code>ä¸<code>_myLastName</code>ï¼Œè€Œä¸å†ä½¿ç”¨é»˜è®¤çš„åå­—ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ— é¡»ä¿®æ”¹é»˜è®¤çš„å®ä¾‹å˜é‡åï¼Œä½†æ˜¯å¦‚æœä½ ä¸å–œæ¬¢ä»¥ä¸‹åˆ’çº¿æ¥å‘½åå®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è¿™ä¸ªåŠæ³•å°†å…¶æ”¹ä¸ºè‡ªå·±æƒ³è¦çš„åå­—ã€‚ç¬”è€…è¿˜æ˜¯æ¨èä½¿ç”¨é»˜è®¤çš„å‘½åæ–¹æ¡ˆï¼Œå› ä¸ºå¦‚æœæ‰€æœ‰äººéƒ½åšæŒè¿™å¥—æ–¹æ¡ˆï¼Œé‚£ä¹ˆå†™å‡ºæ¥çš„ä»£ç å¤§å®¶éƒ½èƒ½çœ‹å¾—æ‡‚ã€‚</p>

<p>æ€»ç»“ä¸‹@synthesizeåˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

<ol>
<li><p>å¦‚æœæŒ‡å®šäº†æˆå‘˜å˜é‡çš„åç§°,ä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å®šçš„åç§°çš„æˆå‘˜å˜é‡,</p></li>
<li><p>å¦‚æœè¿™ä¸ªæˆå‘˜å·²ç»å­˜åœ¨äº†å°±ä¸å†ç”Ÿæˆäº†.</p></li>
<li>å¦‚æœæ˜¯ <code>@synthesize foo;</code> è¿˜ä¼šç”Ÿæˆä¸€ä¸ªåç§°ä¸ºfooçš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</li>
</ol>


<blockquote><p>å¦‚æœæ²¡æœ‰æŒ‡å®šæˆå‘˜å˜é‡çš„åç§°ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå±æ€§åŒåçš„æˆå‘˜å˜é‡,</p></blockquote>

<ol>
<li>å¦‚æœæ˜¯ <code>@synthesize foo = _foo;</code> å°±ä¸ä¼šç”Ÿæˆæˆå‘˜å˜é‡äº†.</li>
</ol>


<p>å‡å¦‚propertyåä¸ºfooï¼Œå­˜åœ¨ä¸€ä¸ªåä¸º_fooçš„å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿˜ä¼šè‡ªåŠ¨åˆæˆæ–°å˜é‡ä¹ˆï¼Ÿ
ä¸ä¼šã€‚å¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://i.imgur.com/t28ge4W.png" alt="enter image description here" /></p>

<h3>15. åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ@synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h3>

<p>å›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘ä»¬è¦ææ¸…æ¥šä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¸ä¼šautosynthesisï¼ˆè‡ªåŠ¨åˆæˆï¼‰ï¼Ÿ</p>

<ol>
<li>åŒæ—¶é‡å†™äº†setterå’Œgetteræ—¶</li>
<li>é‡å†™äº†åªè¯»å±æ€§çš„getteræ—¶</li>
<li>ä½¿ç”¨äº†@dynamicæ—¶</li>
<li>åœ¨ @protocol ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§</li>
<li>åœ¨ category ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§</li>
<li>é‡è½½çš„å±æ€§</li>
</ol>


<p> å½“ä½ åœ¨å­ç±»ä¸­é‡è½½äº†çˆ¶ç±»ä¸­çš„å±æ€§ï¼Œä½ å¿…é¡» ä½¿ç”¨<code>@synthesize</code>æ¥æ‰‹åŠ¨åˆæˆivarã€‚</p>

<p>é™¤äº†åä¸‰æ¡ï¼Œå¯¹å…¶ä»–å‡ ä¸ªæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä¸€ä¸ªè§„å¾‹ï¼šå½“ä½ æƒ³æ‰‹åŠ¨ç®¡ç†@propertyçš„æ‰€æœ‰å†…å®¹æ—¶ï¼Œä½ å°±ä¼šå°è¯•é€šè¿‡å®ç°@propertyçš„æ‰€æœ‰â€œå­˜å–æ–¹æ³•â€ï¼ˆthe accessor methodsï¼‰æˆ–è€…ä½¿ç”¨<code>@dynamic</code>æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œè¿™æ—¶ç¼–è¯‘å™¨å°±ä¼šè®¤ä¸ºä½ æ‰“ç®—æ‰‹åŠ¨ç®¡ç†@propertyï¼Œäºæ˜¯ç¼–è¯‘å™¨å°±ç¦ç”¨äº†autosynthesisï¼ˆè‡ªåŠ¨åˆæˆï¼‰ã€‚</p>

<p>å› ä¸ºæœ‰äº†autosynthesisï¼ˆè‡ªåŠ¨åˆæˆï¼‰ï¼Œå¤§éƒ¨åˆ†å¼€å‘è€…å·²ç»ä¹ æƒ¯ä¸å»æ‰‹åŠ¨å®šä¹‰ivarï¼Œè€Œæ˜¯ä¾èµ–äºautosynthesisï¼ˆè‡ªåŠ¨åˆæˆï¼‰ï¼Œä½†æ˜¯ä¸€æ—¦ä½ éœ€è¦ä½¿ç”¨ivarï¼Œè€Œautosynthesisï¼ˆè‡ªåŠ¨åˆæˆï¼‰åˆå¤±æ•ˆäº†ï¼Œå¦‚æœä¸å»æ‰‹åŠ¨å®šä¹‰ivarï¼Œé‚£ä¹ˆä½ å°±å¾—å€ŸåŠ©<code>@synthesize</code>æ¥æ‰‹åŠ¨åˆæˆivarã€‚</p>

<p>å…¶å®ï¼Œ<code>@synthesize</code>è¯­æ³•è¿˜æœ‰ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯ä¸å¤ªå»ºè®®å¤§å®¶ä½¿ç”¨ï¼š</p>

<p>å¯ä»¥åœ¨ç±»çš„å®ç°ä»£ç é‡Œé€šè¿‡<code>@synthesize</code>è¯­æ³•æ¥æŒ‡å®šå®ä¾‹å˜é‡çš„åå­—:</p>

<pre><code>@implementation CYLPerson 
@synthesize firstName = _myFirstName; 
@synthesize lastName = _myLastName; 
@end 
</code></pre>

<p>ä¸Šè¿°è¯­æ³•ä¼šå°†ç”Ÿæˆçš„å®ä¾‹å˜é‡å‘½åä¸º<code>_myFirstName</code>ä¸<code>_myLastName</code>ï¼Œè€Œä¸å†ä½¿ç”¨é»˜è®¤çš„åå­—ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ— é¡»ä¿®æ”¹é»˜è®¤çš„å®ä¾‹å˜é‡åï¼Œä½†æ˜¯å¦‚æœä½ ä¸å–œæ¬¢ä»¥ä¸‹åˆ’çº¿æ¥å‘½åå®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è¿™ä¸ªåŠæ³•å°†å…¶æ”¹ä¸ºè‡ªå·±æƒ³è¦çš„åå­—ã€‚ç¬”è€…è¿˜æ˜¯æ¨èä½¿ç”¨é»˜è®¤çš„å‘½åæ¡ˆï¼Œå› ä¸ºå¦‚æœæ‰€æœ‰äººéƒ½åšæŒè¿™å¥—æ–¹æ¡ˆï¼Œé‚£ä¹ˆå†™å‡ºæ¥çš„ä»£ç å¤§å®¶éƒ½èƒ½çœ‹å¾—æ‡‚ã€‚</p>

<p>ä¸¾ä¾‹è¯´æ˜ï¼šåº”ç”¨åœºæ™¯ï¼š</p>

<pre><code>//
// .mæ–‡ä»¶
// http://weibo.com/luohanchenyilong/ (å¾®åš@iOSç¨‹åºçŠ­è¢)
// https://github.com/ChenYilong
// æ‰“å¼€ç¬¬14è¡Œå’Œç¬¬17è¡Œä¸­ä»»æ„ä¸€è¡Œï¼Œå°±å¯ç¼–è¯‘æˆåŠŸ

@import Foundation;

@interface CYLObject : NSObject
@property (nonatomic, copy) NSString *title;
@end

@implementation CYLObject {
//    NSString *_title;
}

//@synthesize title = _title;

- (instancetype)init
{
    self = [super init];
    if (self) {
        _title = @"å¾®åš@iOSç¨‹åºçŠ­è¢";
    }
    return self;
}

- (NSString *)title {
    return _title;
}

- (void)setTitle:(NSString *)title {
    _title = [title copy];
}

@end
</code></pre>

<p>ç»“æœç¼–è¯‘å™¨æŠ¥é”™ï¼š
<img src="http://i.imgur.com/fAEGHIo.png" alt="enter image description here" /></p>

<p>å½“ä½ åŒæ—¶é‡å†™äº†setterå’Œgetteræ—¶ï¼Œç³»ç»Ÿå°±ä¸ä¼šç”Ÿæˆivarï¼ˆå®ä¾‹å˜é‡/æˆå‘˜å˜é‡ï¼‰ã€‚è¿™æ—¶å€™æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>

<ol>
<li>è¦ä¹ˆå¦‚ç¬¬14è¡Œï¼šæ‰‹åŠ¨åˆ›å»ºivar</li>
<li>è¦ä¹ˆå¦‚ç¬¬17è¡Œï¼šä½¿ç”¨<code>@synthesize foo = _foo;</code> ï¼Œå…³è”@propertyä¸ivarã€‚</li>
</ol>


<p>æ›´å¤šä¿¡æ¯ï¼Œè¯·æˆ³- ã€‹<a href="http://stackoverflow.com/a/19821816/3395008"> <strong><em>When should I use @synthesize explicitly?</em></strong> </a></p>

<h3>16. objcä¸­å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3>

<p>åœ¨Objective-Cä¸­å‘nilå‘é€æ¶ˆæ¯æ˜¯å®Œå…¨æœ‰æ•ˆçš„â€”â€”åªæ˜¯åœ¨è¿è¡Œæ—¶ä¸ä¼šæœ‰ä»»ä½•ä½œç”¨:</p>

<ol>
<li><p>å¦‚æœä¸€ä¸ªæ–¹æ³•è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0(nil)ã€‚ä¾‹å¦‚ï¼š</p>

<p>Person * motherInlaw = [[aPerson spouse] mother];</p></li>
</ol>


<p> å¦‚æœspouseå¯¹è±¡ä¸ºnilï¼Œé‚£ä¹ˆå‘é€ç»™nilçš„æ¶ˆæ¯motherä¹Ÿå°†è¿”å›nilã€‚
 2. å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºæŒ‡é’ˆç±»å‹ï¼Œå…¶æŒ‡é’ˆå¤§å°ä¸ºå°äºæˆ–è€…ç­‰äºsizeof(void*)ï¼Œfloatï¼Œdoubleï¼Œlong double æˆ–è€…long longçš„æ•´å‹æ ‡é‡ï¼Œå‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0ã€‚
 2. å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºç»“æ„ä½“,å‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0ã€‚ç»“æ„ä½“ä¸­å„ä¸ªå­—æ®µçš„å€¼å°†éƒ½æ˜¯0ã€‚
 2. å¦‚æœæ–¹æ³•çš„è¿”å›å€¼ä¸æ˜¯ä¸Šè¿°æåˆ°çš„å‡ ç§æƒ…å†µï¼Œé‚£ä¹ˆå‘é€ç»™nilçš„æ¶ˆæ¯çš„è¿”å›å€¼å°†æ˜¯æœªå®šä¹‰çš„ã€‚</p>

<p>å…·ä½“åŸå› å¦‚ä¸‹ï¼š</p>

<blockquote><p>objcæ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨è¿è¡Œæ—¶ä¼šè¢«åŠ¨æ€è½¬ä¸ºæ¶ˆæ¯å‘é€ï¼Œå³ï¼šobjc_msgSend(receiver, selector)ã€‚</p></blockquote>

<p>é‚£ä¹ˆï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£è¿™ä¸ªå†…å®¹ï¼Œè¿˜æ˜¯è´´ä¸€ä¸ªobjcçš„æºä»£ç ï¼š</p>

<pre><code>// runtime.hï¼ˆç±»åœ¨runtimeä¸­çš„å®šä¹‰ï¼‰
// http://weibo.com/luohanchenyilong/
// https://github.com/ChenYilong

struct objc_class {
  Class isa OBJC_ISA_AVAILABILITY; //isaæŒ‡é’ˆæŒ‡å‘Meta Classï¼Œå› ä¸ºObjcçš„ç±»çš„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªObjectï¼Œä¸ºäº†å¤„ç†è¿™ä¸ªå…³ç³»ï¼Œruntimeå°±åˆ›é€ äº†Meta Classï¼Œå½“ç»™ç±»å‘é€[NSObject alloc]è¿™æ ·æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¿™ä¸ªæ¶ˆæ¯å‘ç»™äº†Class Object
  #if !__OBJC2__
  Class super_class OBJC2_UNAVAILABLE; // çˆ¶ç±»
  const char *name OBJC2_UNAVAILABLE; // ç±»å
  long version OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0
  long info OBJC2_UNAVAILABLE; // ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†
  long instance_size OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°
  struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; // è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨
  struct objc_method_list **methodLists OBJC2_UNAVAILABLE; // æ–¹æ³•å®šä¹‰çš„é“¾è¡¨
  struct objc_cache *cache OBJC2_UNAVAILABLE; // æ–¹æ³•ç¼“å­˜ï¼Œå¯¹è±¡æ¥åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¼šæ ¹æ®isaæŒ‡é’ˆæŸ¥æ‰¾æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™æ—¶ä¼šåœ¨method Listsä¸­éå†ï¼Œå¦‚æœcacheäº†ï¼Œå¸¸ç”¨çš„æ–¹æ³•è°ƒç”¨æ—¶å°±èƒ½å¤Ÿæé«˜è°ƒç”¨çš„æ•ˆç‡ã€‚
  struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; // åè®®é“¾è¡¨
  #endif
  } OBJC2_UNAVAILABLE;
</code></pre>

<p>objcåœ¨å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œruntimeåº“ä¼šæ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡å®é™…æ‰€å±çš„ç±»ï¼Œç„¶ååœ¨è¯¥ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠå…¶çˆ¶ç±»æ–¹æ³•åˆ—è¡¨ä¸­å¯»æ‰¾æ–¹æ³•è¿è¡Œï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œobjc_msgSendæ–¹æ³•ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€è°“çš„è¿”å›å†…å®¹éƒ½æ˜¯å…·ä½“è°ƒç”¨æ—¶æ‰§è¡Œçš„ã€‚
é‚£ä¹ˆï¼Œå›åˆ°æœ¬é¢˜ï¼Œå¦‚æœå‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œé¦–å…ˆåœ¨å¯»æ‰¾å¯¹è±¡çš„isaæŒ‡é’ˆæ—¶å°±æ˜¯0åœ°å€è¿”å›äº†ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚</p>

<h3>17. objcä¸­å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯[obj foo]å’Œobjc_msgSend()å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3>

<p>å…·ä½“åŸå› åŒä¸Šé¢˜ï¼šè¯¥æ–¹æ³•ç¼–è¯‘ä¹‹åå°±æ˜¯<code>objc_msgSend()</code>å‡½æ•°è°ƒç”¨.å¦‚æœæˆ‘æ²¡æœ‰è®°é”™çš„å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>

<pre><code>((void ()(id, SEL))(void )objc_msgSend)((id)obj, sel_registerName("foo"));
</code></pre>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>

<blockquote><p> [obj foo];åœ¨objcåŠ¨æ€ç¼–è¯‘æ—¶ï¼Œä¼šè¢«è½¬æ„ä¸ºï¼š<code>objc_msgSend(obj, @selector(foo));</code>ã€‚</p></blockquote>

<h3>18. ä»€ä¹ˆæ—¶å€™ä¼šæŠ¥unrecognized selectorçš„å¼‚å¸¸ï¼Ÿ</h3>

<p>ç®€å•æ¥è¯´ï¼š</p>

<blockquote><p>å½“ä½¿ç”¨æŸå¯¹è±¡ä¸Šçš„æŸä¸ªæ–¹æ³•,è€Œè¯¥å¯¹è±¡ä¸Šæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œ
å¯ä»¥é€šè¿‡â€œæ¶ˆæ¯è½¬å‘â€è¿›è¡Œè§£å†³ã€‚</p></blockquote>

<p>ç®€å•çš„æµç¨‹å¦‚ä¸‹ï¼Œåœ¨ä¸Šä¸€é¢˜ä¸­ä¹Ÿæåˆ°è¿‡ï¼š</p>

<blockquote><p>objcæ˜¯åŠ¨æ€è¯­è¨€ï¼Œæ¯ä¸ªæ–¹æ³•åœ¨è¿è¡Œæ—¶ä¼šè¢«åŠ¨æ€è½¬ä¸ºæ¶ˆæ¯å‘é€ï¼Œå³ï¼šobjc_msgSend(receiver, selector)ã€‚</p></blockquote>

<p>objcåœ¨å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œruntimeåº“ä¼šæ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡å®é™…æ‰€å±çš„ç±»ï¼Œç„¶ååœ¨è¯¥ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠå…¶çˆ¶ç±»æ–¹æ³•åˆ—è¡¨ä¸­å¯»æ‰¾æ–¹æ³•è¿è¡Œï¼Œå¦‚æœï¼Œåœ¨æœ€é¡¶å±‚çš„çˆ¶ç±»ä¸­ä¾ç„¶æ‰¾ä¸åˆ°ç›¸åº”çš„æ–¹æ³•æ—¶ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šæŒ‚æ‰å¹¶æŠ›å‡ºå¼‚å¸¸unrecognized selector sent to XXX ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œobjcçš„è¿è¡Œæ—¶ä¼šç»™å‡ºä¸‰æ¬¡æ‹¯æ•‘ç¨‹åºå´©æºƒçš„æœºä¼šï¼š</p>

<ol>
<li>Method resolution</li>
</ol>


<p> objcè¿è¡Œæ—¶ä¼šè°ƒç”¨<code>+resolveInstanceMethod:</code>æˆ–è€… <code>+resolveClassMethod:</code>ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å› YESï¼Œé‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ï¼Œå¦‚æœ resolve æ–¹æ³•è¿”å› NO ï¼Œè¿è¡Œæ—¶å°±ä¼šç§»åˆ°ä¸‹ä¸€æ­¥ï¼Œæ¶ˆæ¯è½¬å‘ï¼ˆMessage Forwardingï¼‰ã€‚</p>

<ol>
<li>Fast forwarding</li>
</ol>


<p> å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†<code>-forwardingTargetForSelector:</code>ï¼ŒRuntime è¿™æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»™ä½ æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡çš„æœºä¼šã€‚
åªè¦è¿™ä¸ªæ–¹æ³•è¿”å›çš„ä¸æ˜¯nilå’Œselfï¼Œæ•´ä¸ªæ¶ˆæ¯å‘é€çš„è¿‡ç¨‹å°±ä¼šè¢«é‡å¯ï¼Œå½“ç„¶å‘é€çš„å¯¹è±¡ä¼šå˜æˆä½ è¿”å›çš„é‚£ä¸ªå¯¹è±¡ã€‚å¦åˆ™ï¼Œå°±ä¼šç»§ç»­Normal Fowardingã€‚
è¿™é‡Œå«Fastï¼Œåªæ˜¯ä¸ºäº†åŒºåˆ«ä¸‹ä¸€æ­¥çš„è½¬å‘æœºåˆ¶ã€‚å› ä¸ºè¿™ä¸€æ­¥ä¸ä¼šåˆ›å»ºä»»ä½•æ–°çš„å¯¹è±¡ï¼Œä½†ä¸‹ä¸€æ­¥è½¬å‘ä¼šåˆ›å»ºä¸€ä¸ªNSInvocationå¯¹è±¡ï¼Œæ‰€ä»¥ç›¸å¯¹æ›´å¿«ç‚¹ã€‚
 3. Normal forwarding</p>

<p> è¿™ä¸€æ­¥æ˜¯Runtimeæœ€åä¸€æ¬¡ç»™ä½ æŒ½æ•‘çš„æœºä¼šã€‚é¦–å…ˆå®ƒä¼šå‘é€<code>-methodSignatureForSelector:</code>æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚å¦‚æœ<code>-methodSignatureForSelector:</code>è¿”å›nilï¼ŒRuntimeåˆ™ä¼šå‘å‡º<code>-doesNotRecognizeSelector:</code>æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†ã€‚å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾åï¼ŒRuntimeå°±ä¼šåˆ›å»ºä¸€ä¸ªNSInvocationå¯¹è±¡å¹¶å‘é€<code>-forwardInvocation:</code>æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡ã€‚</p>

<h3>19. ä¸€ä¸ªobjcå¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜å¸ƒå±€ï¼Ÿï¼ˆè€ƒè™‘æœ‰çˆ¶ç±»çš„æƒ…å†µï¼‰</h3>

<ul>
<li>æ‰€æœ‰çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œè‡ªå·±çš„æˆå‘˜å˜é‡éƒ½ä¼šå­˜æ”¾åœ¨è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„å­˜å‚¨ç©ºé—´ä¸­.</li>
<li><p>æ¯ä¸€ä¸ªå¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆ,æŒ‡å‘ä»–çš„ç±»å¯¹è±¡,ç±»å¯¹è±¡ä¸­å­˜æ”¾ç€æœ¬å¯¹è±¡çš„</p></li>
<li><p>å¯¹è±¡æ–¹æ³•åˆ—è¡¨ï¼ˆå¯¹è±¡èƒ½å¤Ÿæ¥æ”¶çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œä¿å­˜åœ¨å®ƒæ‰€å¯¹åº”çš„ç±»å¯¹è±¡ä¸­ï¼‰</p></li>
<li>æˆå‘˜å˜é‡çš„åˆ—è¡¨,</li>
<li>å±æ€§åˆ—è¡¨,</li>
</ul>


<p> å®ƒå†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆæŒ‡å‘å…ƒå¯¹è±¡(meta class),å…ƒå¯¹è±¡å†…éƒ¨å­˜æ”¾çš„æ˜¯ç±»æ–¹æ³•åˆ—è¡¨,ç±»å¯¹è±¡å†…éƒ¨è¿˜æœ‰ä¸€ä¸ªsuperclassçš„æŒ‡é’ˆ,æŒ‡å‘ä»–çš„çˆ¶ç±»å¯¹è±¡ã€‚</p>

<p> <img src="http://i.imgur.com/7mJlUj1.png" alt="enter image description here" /></p>

<ul>
<li><p>æ ¹å¯¹è±¡å°±æ˜¯NSobjectï¼Œå®ƒçš„superclassæŒ‡é’ˆæŒ‡å‘nil</p></li>
<li><p>ç±»å¯¹è±¡æ—¢ç„¶ç§°ä¸ºå¯¹è±¡ï¼Œé‚£å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå®ä¾‹ã€‚ç±»å¯¹è±¡ä¸­ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆæŒ‡å‘å®ƒçš„å…ƒç±»(meta class)ï¼Œå³ç±»å¯¹è±¡æ˜¯å…ƒç±»çš„å®ä¾‹ã€‚å…ƒç±»å†…éƒ¨å­˜æ”¾çš„æ˜¯ç±»æ–¹æ³•åˆ—è¡¨ï¼Œæ ¹å…ƒç±»çš„isaæŒ‡é’ˆæŒ‡å‘è‡ªå·±ï¼ŒsuperclassæŒ‡é’ˆæŒ‡å‘NSObjectç±»ã€‚</p></li>
</ul>


<p>å¦‚å›¾:
<img src="http://i.imgur.com/w6tzFxz.png" alt="enter image description here" /></p>

<h3>20. ä¸€ä¸ªobjcå¯¹è±¡çš„isaçš„æŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3>

<p>æŒ‡å‘ä»–çš„ç±»å¯¹è±¡,ä»è€Œå¯ä»¥æ‰¾åˆ°å¯¹è±¡ä¸Šçš„æ–¹æ³•</p>

<h3>21. ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ</h3>

<pre><code>@implementation Son : Father
- (id)init
{
    self = [super init];
    if (self) {
        NSLog(@"%@", NSStringFromClass([self class]));
        NSLog(@"%@", NSStringFromClass([super class]));
    }
    return self;
}
@end
</code></pre>

<p><strong>ç­”æ¡ˆï¼š</strong></p>

<p>éƒ½è¾“å‡º Son</p>

<pre><code>NSStringFromClass([self class]) = Son
NSStringFromClass([super class]) = Son
</code></pre>

<p><strong>è§£æƒ‘ï¼š</strong></p>

<p>ï¼ˆä»¥ä¸‹è§£æƒ‘éƒ¨åˆ†æ‘˜è‡ª<a href="http://weibo.com/junbbcom">å¾®åš@Chun_iOS</a>çš„åšæ–‡<a href="http://chun.tips/blog/2014/11/05/bao-gen-wen-di-objective%5Bnil%5Dc-runtime(1">åˆ¨æ ¹é—®åº•Objectiveï¼C Runtimeï¼ˆ1ï¼‰ï¼ Self &amp; Super</a>%5Bnil%5D-self-and-super/)ï¼‰</p>

<p>è¿™ä¸ªé¢˜ç›®ä¸»è¦æ˜¯è€ƒå¯Ÿå…³äºobjcä¸­å¯¹ self å’Œ super çš„ç†è§£ã€‚</p>

<p>self æ˜¯ç±»çš„éšè—å‚æ•°ï¼ŒæŒ‡å‘å½“å‰è°ƒç”¨æ–¹æ³•çš„è¿™ä¸ªç±»çš„å®ä¾‹ã€‚è€Œ super æ˜¯ä¸€ä¸ª Magic Keywordï¼Œ å®ƒæœ¬è´¨æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ ‡ç¤ºç¬¦ï¼Œå’Œ self æ˜¯æŒ‡å‘çš„åŒä¸€ä¸ªæ¶ˆæ¯æ¥å—è€…ã€‚</p>

<p>ä¸Šé¢çš„ä¾‹å­ä¸ç®¡è°ƒç”¨<code>[self class]</code>è¿˜æ˜¯<code>[super class]</code>ï¼Œæ¥å—æ¶ˆæ¯çš„å¯¹è±¡éƒ½æ˜¯å½“å‰ <code>Son ï¼Šxxx</code> è¿™ä¸ªå¯¹è±¡ã€‚è€Œä¸åŒçš„æ˜¯ï¼Œsuperæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè°ƒç”¨ class è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè¦å»çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯æœ¬ç±»é‡Œçš„ã€‚</p>

<p>å½“ä½¿ç”¨ self è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šä»å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»çˆ¶ç±»ä¸­å†æ‰¾ï¼›è€Œå½“ä½¿ç”¨ super æ—¶ï¼Œåˆ™ä»çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ã€‚ç„¶åè°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚</p>

<p>çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿç»§ç»­çœ‹ï¼š</p>

<p>ä½¿ç”¨clangé‡å†™å‘½ä»¤:</p>

<pre><code>$ clang -rewrite-objc test.m
</code></pre>

<p>å‘ç°ä¸Šè¿°ä»£ç è¢«è½¬åŒ–ä¸º:</p>

<pre><code>NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_gm_0jk35cwn1d3326x0061qym280000gn_T_main_a5cecc_mi_0, NSStringFromClass(((Class (*)(id, SEL))(void *)objc_msgSend)((id)self, sel_registerName("class"))));

NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_gm_0jk35cwn1d3326x0061qym280000gn_T_main_a5cecc_mi_1, NSStringFromClass(((Class (*)(__rw_objc_super *, SEL))(void *)objc_msgSendSuper)((__rw_objc_super){ (id)self, (id)class_getSuperclass(objc_getClass("Son")) }, sel_registerName("class"))));
</code></pre>

<p>ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨è°ƒç”¨ [self class] æ—¶ï¼Œä¼šè½¬åŒ–æˆ <code>objc_msgSend</code>å‡½æ•°ã€‚çœ‹ä¸‹å‡½æ•°å®šä¹‰ï¼š</p>

<pre><code>id objc_msgSend(id self, SEL op, ...)
</code></pre>

<p>æˆ‘ä»¬æŠŠ self åšä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»ã€‚</p>

<p>è€Œåœ¨è°ƒç”¨ [super class]æ—¶ï¼Œä¼šè½¬åŒ–æˆ <code>objc_msgSendSuper</code>å‡½æ•°ã€‚çœ‹ä¸‹å‡½æ•°å®šä¹‰:</p>

<pre><code>id objc_msgSendSuper(struct objc_super *super, SEL op, ...)
</code></pre>

<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ <code>objc_super</code> è¿™æ ·ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶å®šä¹‰å¦‚ä¸‹:</p>

<pre><code>struct objc_super {
   __unsafe_unretained id receiver;
   __unsafe_unretained Class super_class;
};
</code></pre>

<p>ç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ receiver, ç±»ä¼¼äºä¸Šé¢çš„ <code>objc_msgSend</code>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°self ã€‚ç¬¬äºŒä¸ªæˆå‘˜æ˜¯è®°å½•å½“å‰ç±»çš„çˆ¶ç±»æ˜¯ä»€ä¹ˆã€‚</p>

<p>æ‰€ä»¥ï¼Œå½“è°ƒç”¨ ï¼»self class] æ—¶ï¼Œå®é™…å…ˆè°ƒç”¨çš„æ˜¯ <code>objc_msgSend</code>å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Sonå½“å‰çš„è¿™ä¸ªå®ä¾‹ï¼Œç„¶ååœ¨ Son è¿™ä¸ªç±»é‡Œé¢å»æ‰¾ - (Class)classè¿™ä¸ªæ–¹æ³•ï¼Œæ²¡æœ‰ï¼Œå»çˆ¶ç±» Fatheré‡Œæ‰¾ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæœ€ååœ¨ NSObjectç±»ä¸­å‘ç°è¿™ä¸ªæ–¹æ³•ã€‚è€Œ - (Class)classçš„å®ç°å°±æ˜¯è¿”å›selfçš„ç±»åˆ«ï¼Œæ•…ä¸Šè¿°è¾“å‡ºç»“æœä¸º Sonã€‚</p>

<p>objc Runtimeå¼€æºä»£ç å¯¹- (Class)classæ–¹æ³•çš„å®ç°:</p>

<pre><code>- (Class)class {
    return object_getClass(self);
}
</code></pre>

<p>è€Œå½“è°ƒç”¨ <code>[super class]</code>æ—¶ï¼Œä¼šè½¬æ¢æˆ<code>objc_msgSendSuperå‡½æ•°</code>ã€‚ç¬¬ä¸€æ­¥å…ˆæ„é€  <code>objc_super</code> ç»“æ„ä½“ï¼Œç»“æ„ä½“ç¬¬ä¸€ä¸ªæˆå‘˜å°±æ˜¯ <code>self</code> ã€‚
ç¬¬äºŒä¸ªæˆå‘˜æ˜¯ <code>(id)class_getSuperclass(objc_getClass(â€œSonâ€))</code> , å®é™…è¯¥å‡½æ•°è¾“å‡ºç»“æœä¸º Fatherã€‚
ç¬¬äºŒæ­¥æ˜¯å» Fatherè¿™ä¸ªç±»é‡Œå»æ‰¾ <code>- (Class)class</code>ï¼Œæ²¡æœ‰ï¼Œç„¶åå»NSObjectç±»å»æ‰¾ï¼Œæ‰¾åˆ°äº†ã€‚æœ€åå†…éƒ¨æ˜¯ä½¿ç”¨ <code>objc_msgSend(objc_super-&gt;receiver, @selector(class))</code>å»è°ƒç”¨ï¼Œ
æ­¤æ—¶å·²ç»å’Œ<code>[self class]</code>è°ƒç”¨ç›¸åŒäº†ï¼Œæ•…ä¸Šè¿°è¾“å‡ºç»“æœä»ç„¶è¿”å› Sonã€‚</p>

<h3>22. runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿï¼ˆåˆ†åˆ«è€ƒè™‘ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ï¼‰</h3>

<p>æ¯ä¸€ä¸ªç±»å¯¹è±¡ä¸­éƒ½ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨,æ–¹æ³•åˆ—è¡¨ä¸­è®°å½•ç€æ–¹æ³•çš„åç§°,æ–¹æ³•å®ç°,ä»¥åŠå‚æ•°ç±»å‹,å…¶å®selectoræœ¬è´¨å°±æ˜¯æ–¹æ³•åç§°,é€šè¿‡è¿™ä¸ªæ–¹æ³•åç§°å°±å¯ä»¥åœ¨æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°.</p>

<h3>23. ä½¿ç”¨runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾ä¹ˆï¼Ÿ</h3>

<ul>
<li>åœ¨ARCä¸‹ä¸éœ€è¦ã€‚</li>
<li><p><del> åœ¨MRCä¸­,å¯¹äºä½¿ç”¨retainæˆ–copyç­–ç•¥çš„éœ€è¦ ã€‚</del></p>åœ¨MRCä¸‹ä¹Ÿä¸éœ€è¦</li>
</ul>


<blockquote><p>æ— è®ºåœ¨MRCä¸‹è¿˜æ˜¯ARCä¸‹å‡ä¸éœ€è¦ã€‚</p></blockquote>

<p><a href="https://web.archive.org/web/20120818164935/http://developer.apple.com/library/ios/#/web/20120820002100/http://developer.apple.com/library/ios/documentation/cocoa/conceptual/objectivec/Chapters/ocAssociativeReferences.html"> <strong><em>2011å¹´ç‰ˆæœ¬çš„Apple API å®˜æ–¹æ–‡æ¡£ - Associative References</em></strong>  </a> ä¸€èŠ‚ä¸­æœ‰ä¸€ä¸ªMRCç¯å¢ƒä¸‹çš„ä¾‹å­ï¼š</p>

<pre><code>// åœ¨MRCä¸‹ï¼Œä½¿ç”¨runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œä¸éœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾
// http://weibo.com/luohanchenyilong/ (å¾®åš@iOSç¨‹åºçŠ­è¢)
// https://github.com/ChenYilong
// æ‘˜è‡ª2011å¹´ç‰ˆæœ¬çš„Apple API å®˜æ–¹æ–‡æ¡£ - Associative References 

static char overviewKey;

NSArray *array =
    [[NSArray alloc] initWithObjects:@"One", @"Two", @"Three", nil];
// For the purposes of illustration, use initWithFormat: to ensure
// the string can be deallocated
NSString *overview =
    [[NSString alloc] initWithFormat:@"%@", @"First three numbers"];

objc_setAssociatedObject (
    array,
    &amp;overviewKey,
    overview,
    OBJC_ASSOCIATION_RETAIN
);

[overview release];
// (1) overview valid
[array release];
// (2) overview invalid
</code></pre>

<p>æ–‡æ¡£æŒ‡å‡º</p>

<blockquote><p>At point 1, the string <code>overview</code> is still valid because the <code>OBJC_ASSOCIATION_RETAIN</code> policy specifies that the array retains the associated object. When the array is deallocated, however (at point 2), <code>overview</code> is released and so in this case also deallocated.</p></blockquote>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>[array release];</code>ä¹‹åï¼Œoverviewå°±ä¼šè¢«releaseé‡Šæ”¾æ‰äº†ã€‚</p>

<p>æ—¢ç„¶ä¼šè¢«é”€æ¯ï¼Œé‚£ä¹ˆå…·ä½“åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹ï¼Ÿ</p>

<blockquote><p>æ ¹æ®<a href="https://developer.apple.com/videos/wwdc/2011/#322-video"> <strong><em>WWDC 2011, Session 322 (ç¬¬36åˆ†22ç§’)</em></strong> </a>ä¸­å‘å¸ƒçš„å†…å­˜é”€æ¯æ—¶é—´è¡¨ï¼Œè¢«å…³è”çš„å¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸå†…è¦æ¯”å¯¹è±¡æœ¬èº«é‡Šæ”¾çš„æ™šå¾ˆå¤šã€‚å®ƒä»¬ä¼šåœ¨è¢« NSObject -dealloc è°ƒç”¨çš„ object_dispose() æ–¹æ³•ä¸­é‡Šæ”¾ã€‚</p></blockquote>

<p>å¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨ï¼Œåˆ†å››ä¸ªæ­¥éª¤ï¼š</p>

<pre><code>// å¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨
// http://weibo.com/luohanchenyilong/ (å¾®åš@iOSç¨‹åºçŠ­è¢)
// https://github.com/ChenYilong
// æ ¹æ® WWDC 2011, Session 322 (36åˆ†22ç§’)ä¸­å‘å¸ƒçš„å†…å­˜é”€æ¯æ—¶é—´è¡¨ 

// 1. è°ƒç”¨ -release ï¼šå¼•ç”¨è®¡æ•°å˜ä¸ºé›¶
//     * å¯¹è±¡æ­£åœ¨è¢«é”€æ¯ï¼Œç”Ÿå‘½å‘¨æœŸå³å°†ç»“æŸ.
//     * ä¸èƒ½å†æœ‰æ–°çš„ __weak å¼±å¼•ç”¨ï¼Œ å¦åˆ™å°†æŒ‡å‘ nil.
//     * è°ƒç”¨ [self dealloc] 
// 2. çˆ¶ç±» è°ƒç”¨ -dealloc
//     * ç»§æ‰¿å…³ç³»ä¸­æœ€åº•å±‚çš„çˆ¶ç±» åœ¨è°ƒç”¨ -dealloc
//     * å¦‚æœæ˜¯ MRC ä»£ç  åˆ™ä¼šæ‰‹åŠ¨é‡Šæ”¾å®ä¾‹å˜é‡ä»¬ï¼ˆiVarsï¼‰
//     * ç»§æ‰¿å…³ç³»ä¸­æ¯ä¸€å±‚çš„çˆ¶ç±» éƒ½åœ¨è°ƒç”¨ -dealloc
// 3. NSObject è°ƒ -dealloc
//     * åªåšä¸€ä»¶äº‹ï¼šè°ƒç”¨ Objective-C runtime ä¸­çš„ object_dispose() æ–¹æ³•
// 4. è°ƒç”¨ object_dispose()
//     * ä¸º C++ çš„å®ä¾‹å˜é‡ä»¬ï¼ˆiVarsï¼‰è°ƒç”¨ destructors 
//     * ä¸º ARC çŠ¶æ€ä¸‹çš„ å®ä¾‹å˜é‡ä»¬ï¼ˆiVarsï¼‰ è°ƒç”¨ -release 
//     * è§£é™¤æ‰€æœ‰ä½¿ç”¨ runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡
//     * è§£é™¤æ‰€æœ‰ __weak å¼•ç”¨
//     * è°ƒç”¨ free()
</code></pre>

<p>ï¼ˆ<a href="http://stackoverflow.com/a/10843510/3395008">å¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨å‚è€ƒé“¾æ¥</a>ï¼‰</p>

<h3>24. objcä¸­çš„ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«å’Œè”ç³»ï¼Ÿ</h3>

<p>ç±»æ–¹æ³•ï¼š</p>

<ol>
<li>ç±»æ–¹æ³•æ˜¯å±äºç±»å¯¹è±¡çš„</li>
<li>ç±»æ–¹æ³•åªèƒ½é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨</li>
<li>ç±»æ–¹æ³•ä¸­çš„selfæ˜¯ç±»å¯¹è±¡</li>
<li>ç±»æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–çš„ç±»æ–¹æ³•</li>
<li>ç±»æ–¹æ³•ä¸­ä¸èƒ½è®¿é—®æˆå‘˜å˜é‡</li>
<li>ç±»æ–¹æ³•ä¸­ä¸å®šç›´æ¥è°ƒç”¨å¯¹è±¡æ–¹æ³•</li>
</ol>


<p>å®ä¾‹æ–¹æ³•ï¼š</p>

<ol>
<li>å®ä¾‹æ–¹æ³•æ˜¯å±äºå®ä¾‹å¯¹è±¡çš„</li>
<li>å®ä¾‹æ–¹æ³•åªèƒ½é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨</li>
<li>å®ä¾‹æ–¹æ³•ä¸­çš„selfæ˜¯å®ä¾‹å¯¹è±¡</li>
<li>å®ä¾‹æ–¹æ³•ä¸­å¯ä»¥è®¿é—®æˆå‘˜å˜é‡</li>
<li>å®ä¾‹æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•</li>
<li>å®ä¾‹æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥è°ƒç”¨ç±»æ–¹æ³•(é€šè¿‡ç±»å)</li>
</ol>


<h2>ä¸‹ä¸€ç¯‡æ–‡ç« å°†å‘å¸ƒåœ¨<a href="https://github.com/ChenYilong/iOSInterviewQuestions">è¿™é‡Œ</a>ï¼Œä¼šå¯¹ä»¥ä¸‹é—®é¢˜è¿›è¡Œæ€»ç»“ï¼Œå¹¶å°†æœ¬ç¯‡æ–‡ç« çš„å‹˜è¯¯ä¸€å¹¶åˆ—å‡ºï¼Œæ¬¢è¿æŒ‡æ­£ï¼è¯·æŒç»­å…³æ³¨<a href="http://weibo.com/luohanchenyilong/">å¾®åš@iOSç¨‹åºçŠ­è¢</a></h2>

<p>@propertyéƒ¨åˆ†ä¸»è¦å‚è€ƒ
<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/EncapsulatingData/EncapsulatingData.html#//apple_ref/doc/uid/TP40011210-CH5-SW2">Appleå®˜æ–¹æ–‡æ¡£ï¼šProperties Encapsulate an Objectâ€™s Values</a>
runtimeéƒ¨åˆ†ä¸»è¦å‚è€ƒ<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html">Appleå®˜æ–¹æ–‡æ¡£ï¼šDeclared Properties</a></p>

<h3>25. <code>_objc_msgForward</code>å‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h3>

<h3>26. runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ</h3>

<h3>27. èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h3>

<h3>28. runloopå’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h3>

<h3>29. runloopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>

<h3>30. ä»¥+ scheduledTimerWithTimeInterval&hellip;çš„æ–¹å¼è§¦å‘çš„timerï¼Œåœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚å®šå›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h3>

<h3>31. çŒœæƒ³runloopå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3>

<h3>32. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ</h3>

<h3>33. ARCé€šè¿‡ä»€ä¹ˆæ–¹å¼å¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜ï¼Ÿ</h3>

<h3>34. ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolçš„å‰æä¸‹ï¼Œä¸€ä¸ªautorealeseå¯¹è±¡åœ¨ä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾ï¼Ÿï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªvcçš„viewDidLoadä¸­åˆ›å»ºï¼‰</h3>

<h3>35. <code>BAD_ACCESS</code>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°ï¼Ÿ</h3>

<h3>36. è‹¹æœæ˜¯å¦‚ä½•å®ç°autoreleasepoolçš„ï¼Ÿ</h3>

<h3>37. ä½¿ç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</h3>

<h3>38. åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡ï¼Ÿ</h3>

<h3>39. ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block apiï¼ˆå¦‚UIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ï¼‰ï¼Œæ˜¯å¦ä¹Ÿè€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿ</h3>

<h3>40. GCDçš„é˜Ÿåˆ—ï¼ˆ<code>dispatch_queue_t</code>ï¼‰åˆ†å“ªä¸¤ç§ç±»å‹ï¼Ÿ</h3>

<h3>41. å¦‚ä½•ç”¨GCDåŒæ­¥è‹¥å¹²ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Ÿï¼ˆå¦‚æ ¹æ®è‹¥å¹²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾ç‰‡ï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆä¸€å¼ æ•´å›¾ï¼‰</h3>

<h3>42. <code>dispatch_barrier_async</code>çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>

<h3>43. è‹¹æœä¸ºä»€ä¹ˆè¦åºŸå¼ƒ<code>dispatch_get_current_queue</code>ï¼Ÿ</h3>

<h3>44. ä»¥ä¸‹ä»£ç è¿è¡Œç»“æœå¦‚ä½•ï¼Ÿ</h3>

<pre><code>- (void)viewDidLoad
{
    [super viewDidLoad];
    NSLog(@"1");
    dispatch_sync(dispatch_get_main_queue(), ^{
        NSLog(@"2");
    });
    NSLog(@"3");
}
</code></pre>

<h3>45. addObserver:forKeyPath:options:context:å„ä¸ªå‚æ•°çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œobserverä¸­éœ€è¦å®ç°å“ªä¸ªæ–¹æ³•æ‰èƒ½è·å¾—KVOå›è°ƒï¼Ÿ</h3>

<h3>46. å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVO</h3>

<h3>47. è‹¥ä¸€ä¸ªç±»æœ‰å®ä¾‹å˜é‡<code>NSString *_foo</code>ï¼Œè°ƒç”¨setValue:forKey:æ—¶ï¼Œå¯ä»¥ä»¥fooè¿˜æ˜¯<code>_foo</code>ä½œä¸ºkeyï¼Ÿ</h3>

<h3>48. KVCçš„keyPathä¸­çš„é›†åˆè¿ç®—ç¬¦å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3>

<h3>49. KVCå’ŒKVOçš„keyPathä¸€å®šæ˜¯å±æ€§ä¹ˆï¼Ÿ</h3>

<h3>50. å¦‚ä½•å…³é—­é»˜è®¤çš„KVOçš„é»˜è®¤å®ç°ï¼Œå¹¶è¿›å…¥è‡ªå®šä¹‰çš„KVOå®ç°ï¼Ÿ</h3>

<h3>51. appleç”¨ä»€ä¹ˆæ–¹å¼å®ç°å¯¹ä¸€ä¸ªå¯¹è±¡çš„KVOï¼Ÿ</h3>

<h3>52. IBOutletè¿å‡ºæ¥çš„è§†å›¾å±æ€§ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¾ç½®æˆweak?</h3>

<h3>53. IBä¸­User Defined Runtime Attributeså¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3>

<h3>54. å¦‚ä½•è°ƒè¯•<code>BAD_ACCESS</code>é”™è¯¯</h3>

<h3>55. lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤ï¼Ÿ</h3>

<hr />

<p>Posted by <a href="http://weibo.com/luohanchenyilong/">å¾®åš@iOSç¨‹åºçŠ­è¢</a><br/>
åŸåˆ›æ–‡ç« ï¼Œç‰ˆæƒå£°æ˜ï¼šè‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²å | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">Creative Commons BY-NC-ND 3.0</a></p>
]]></content>
  </entry>
  
</feed>
